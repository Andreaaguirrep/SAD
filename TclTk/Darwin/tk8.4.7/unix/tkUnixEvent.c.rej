***************
*** 140,145 ****
      if (display == NULL) {
  	return NULL;
      }
      dispPtr = (TkDisplay *) ckalloc(sizeof(TkDisplay));
      memset(dispPtr, 0, sizeof(TkDisplay));
      dispPtr->display = display;
--- 140,166 ----
      if (display == NULL) {
  	return NULL;
      }
+ 
+ #if !defined(__linux__) && !defined(__APPLE__)
+     {
+ #include <netinet/tcp.h>
+ 
+ 	int on = 1;
+ 	int keepidle = 600;
+ 	int keepintvl = 30;
+ 	int keepcnt = 4;
+ 
+ 	setsockopt(ConnectionNumber(display), SOL_SOCKET, SO_KEEPALIVE, 
+ 		   (char *)&on, sizeof(on));
+ 	setsockopt(ConnectionNumber(display), IPPROTO_TCP, TCP_KEEPIDLE, 
+ 		   (char *)&keepidle, sizeof(keepidle));
+ 	setsockopt(ConnectionNumber(display), IPPROTO_TCP, TCP_KEEPINTVL, 
+ 		   (char *)&keepintvl, sizeof(keepintvl));
+ 	setsockopt(ConnectionNumber(display), IPPROTO_TCP, TCP_KEEPCNT, 
+ 		   (char *)&keepcnt, sizeof(keepcnt));
+     }
+ #endif /* !defined(__linux__) && !defined(__APPLE__) */
+ 
      dispPtr = (TkDisplay *) ckalloc(sizeof(TkDisplay));
      memset(dispPtr, 0, sizeof(TkDisplay));
      dispPtr->display = display;
