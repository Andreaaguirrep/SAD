      subroutine tmap(x1,x2,idir)
      use temw, only: rn=>r, ri
      implicit none
      real*8 ,intent(in):: x1(6)
      real*8 ,intent(out):: x2(6)
      integer*4 idir
c      real*8 x(6)

      if(idir >= 0)then
        x2=matmul(ri,x1)
c$$$         x(1) = ri(1,1)*x1(1) + ri(1,2)*x1(2) + ri(1,3)*x1(3)
c$$$     $        + ri(1,4)*x1(4) + ri(1,5)*x1(5) + ri(1,6)*x1(6)
c$$$         x(2) = ri(2,1)*x1(1) + ri(2,2)*x1(2) + ri(2,3)*x1(3)
c$$$     $        + ri(2,4)*x1(4) + ri(2,5)*x1(5) + ri(2,6)*x1(6)
c$$$         x(3) = ri(3,1)*x1(1) + ri(3,2)*x1(2) + ri(3,3)*x1(3)
c$$$     $        + ri(3,4)*x1(4) + ri(3,5)*x1(5) + ri(3,6)*x1(6)
c$$$         x(4) = ri(4,1)*x1(1) + ri(4,2)*x1(2) + ri(4,3)*x1(3)
c$$$     $        + ri(4,4)*x1(4) + ri(4,5)*x1(5) + ri(4,6)*x1(6)
c$$$         x(5) = ri(5,1)*x1(1) + ri(5,2)*x1(2) + ri(5,3)*x1(3)
c$$$     $        + ri(5,4)*x1(4) + ri(5,5)*x1(5) + ri(5,6)*x1(6)
c$$$         x(6) = ri(6,1)*x1(1) + ri(6,2)*x1(2) + ri(6,3)*x1(3)
c$$$     $        + ri(6,4)*x1(4) + ri(6,5)*x1(5) + ri(6,6)*x1(6)
      else
        x2=matmul(rn,x1)
c$$$         x(1) = rn(1,1)*x1(1) + rn(1,2)*x1(2) + rn(1,3)*x1(3)
c$$$     $        + rn(1,4)*x1(4) + rn(1,5)*x1(5) + rn(1,6)*x1(6)
c$$$         x(2) = rn(2,1)*x1(1) + rn(2,2)*x1(2) + rn(2,3)*x1(3)
c$$$     $        + rn(2,4)*x1(4) + rn(2,5)*x1(5) + rn(2,6)*x1(6)
c$$$         x(3) = rn(3,1)*x1(1) + rn(3,2)*x1(2) + rn(3,3)*x1(3)
c$$$     $        + rn(3,4)*x1(4) + rn(3,5)*x1(5) + rn(3,6)*x1(6)
c$$$         x(4) = rn(4,1)*x1(1) + rn(4,2)*x1(2) + rn(4,3)*x1(3)
c$$$     $        + rn(4,4)*x1(4) + rn(4,5)*x1(5) + rn(4,6)*x1(6)
c$$$         x(5) = rn(5,1)*x1(1) + rn(5,2)*x1(2) + rn(5,3)*x1(3)
c$$$     $        + rn(5,4)*x1(4) + rn(5,5)*x1(5) + rn(5,6)*x1(6)
c$$$         x(6) = rn(6,1)*x1(1) + rn(6,2)*x1(2) + rn(6,3)*x1(3)
c$$$     $        + rn(6,4)*x1(4) + rn(6,5)*x1(5) + rn(6,6)*x1(6)
      endif
      return
      end
