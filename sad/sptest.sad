FFS;

MemoryCheck[2]

a=Hold[{1,2,{3,4,5}}];
ReplacePart[a,-1,{{1,2},{1,3,2}}]
a[[1,3,2]]:=Null[]
a
ReplacePart[a,-1,{{1,3},{1,3,2}}]
ReplacePart[a,{4,5,6},{{1,3},{1,3,2}}]
ReplacePart[a,{4,5,6},{{1,3,2},{1,3}}]
Insert[a,{4,5,6},{{1,3},{1,3,2}}]
Timing[Do[ReplacePart[a,{4,5,6},{{1,3},{1,3,2}}],{1e6}]]
Timing[Do[Insert[a,{4,5,6},{{1,3},{1,3,2}}],{1e6}]]
b={4,5,6};
ReplacePart[a,b,{{1,3},{1,3,2}}]
b

a=Hold[{1,{2,3,4},{5,6,{7,8,9}}}];
f[8]:=Null[];
MapAt[f,a,{{1,3,3,2},{1,3,3}}]


end



C=Class[{},{},{a=1},f[x_]:=x+1];
c=C[];
c@a
c@f[3]


a={1,2,3};
(#[[2]]=-3)&[Unevaluated[a]]
{a,a[[2]]=-1;a}
{#,#[[2]]=-2;#}&[Unevaluated[a]]

PrependTo[a,4]
PrependTo[a,5]
PrependTo[a,6]
MemoryCheck[2]

ListPlot[a];Update[];
MemoryCheck[2]

ndim=10000;
a={};
Timing[Do[Do[a={a,i},{i,ndim}];a=Flatten[a],{10}]]
a={};
Timing[Do[Do[AppendTo[a,i],{i,ndim}],{10}]]
a
a={};
Timing[Do[Do[PrependTo[a,i],{i,ndim}],{10}]]
a
a={1,{},3};
Timing[Do[Do[AppendTo[a[[2]],i],{i,ndim}],{10}]]
a[[2]]
a={{},{},{}};
Timing[Do[Do[AppendTo[a[[{2,3}]],{i,i*2}],{i,ndim}],{10}]]
a[[{2,3}]]

Clear[a];

 init[]:=(
   ndim=400;
   b[1]=a0=a=Random[ndim,ndim]);

 init[];

 Timing[Do[Do[a[[i,j]]=a[[i,j]],{i,ndim},{j,i}],{3}]]
 Timing[Do[Do[x=a[[i,j]];a[[i,j]]=a[[j,i]];a[[j,i]]=x,{i,ndim},{j,i}],{3}]]
 MinMax[a-Transpose[a0]]
 Timing[Do[Do[x=b[1][[i,j]];b[1][[i,j]]=b[1][[j,i]];b[1][[j,i]]=x,{i,ndim},{j,i}],{3}]]
 MinMax[b[1]-Transpose[a0]]


end


