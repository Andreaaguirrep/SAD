#!/users/oide/WORK/oldsad/obj/OSF1/sad1.exe *MOMENTUM= 5 GEV; ON ECHO;OFF EMIT CTIME RAD RFSW ;  LINE CELL=( IA0 -IP2 P1 P2 BV   L00 S1  QF LS 4*QFT LS S2 SF L1 B  L1 QD SD L1 B L1  CA1) CELL1=( -IP2 IA1 IA2 IA3 L00 QF1 SF L1 B L1 QD1 SD  L1 B L1 CA1 M1) CELL2=(IP1 CA1 QF2 L1 QD1 L1 B SD L2 QF1 SF L2 SD B L1 QD1 L1 QF2) LIN1 = (IP1 QF1 L1 CA1 L1 QF1); LINE        TESTLINE=(CELL CELL1) ; DRIFT  L1     =(L = 1)        L2  = (L=2)        L00    =(L=0)        LS=(L=0.1) ; BEND   B = (L=1 ANGLE=0.1 E1=0.5 E2=0.5 F1=0.1 FRINGE=3)        B1= (L=5 ANGLE=.1 E1=0.5 E2=0.5)        B2= (L=5 ANGLE=.1 E1=0.5 E2=0.5)        B3= (L=5 ANGLE=.1 E1=0.5 E2=0.5)        BV=(L=0.1 ANGLE=0 K0=0.0001 ROTATE=-90 DEG) ; MULT   QF     =(L = 1 K1 = 0.1549322394 DX=0.0001 DY=0.0001 )        QFT     =(L = 0.1 K1 = -0.001 DX=0.001 DY=0.001 )        QD     =(L = 1 K1 =-0.1549322394 ROTATE=0.001)        QF1     =(L = 1 K1 = 0.1549322394 )        QF2     =(L = 0.5 K1 = 0.1549322394/2 )        QD1     =(L = 1 K1 =-0.1549322394 ) ; SEXT   SF     =(L = 0.001 K2=0.1)        SD     =(L = 0.001 ) ; MAP    P1 =()        P2=() ; SOL    S1=(BOUND=1 GEO=1 DPX=0.02 BZ=0.1)        S2=(BOUND=1); ; MONI   M1=() ; ; DRIFT  L1      =(L =1.6438921179655137 )  L2      =(L =14.238026004444558 ) ; BEND   B       =(L =1    ANGLE = -.1 E1 =.5    E2 =.5    F1 =.1    FRINGE =3 ) ; SEXT   SD      =(L =.001 K2 =3.009685508731555 )        SF      =(L =.001 K2 =-.1879393790936433 ) ; MULT   QF2     =(L =.5   K1 =.22378290007183185 )        QD1     =(L =1    K1 =-.20282112241683073 )        QF1     =(L =1    K1 =.13417654970698867 ) ; CAVI   CA1     =(VOLT =2500000     HARM =10 L=2 ) ; MARK   IP1     =(AX =7.146535306055332e-05   BX =26.274938814232897   AY =.0007666567412719797 BY =315.2999914351739           EX =4.11831079983875e-07 EPX =1.7374825080229967e-06   DP =.005  SIGZ =.0015    EMITX =4e-05   EMITY =4e-05 ) ; MARK   IP2     =(BETAX = 0.703     BETAY = 0.703  EMIX = 4.0E-5   EMIY = 4.0E-5  DP = 0.01 SIGZ = 8E-4 ) IA0     =(BETAX = 0.703     BETAY = 0.703  EMIX = 4.0E-5   EMIY = 4.0E-5  DP = 0.01 SIGZ = 8E-4 OFFSET=0 ) IA1 = (OFFSET=5.4) IA2 = (OFFSET=4.5) IA3 = (OFFSET=3.6) ; CAVI   CA1 = (VOLT=2.5 MV HARM=10) ; DECA  DF=(L=2 K4=1) ; APERT A1=(DX1=0.001 DY1=0.001 DX1=-0.001 DY1=-0.001 JDPX=0.001 JDPY=0.001) ;! EMIT USE=TESTLINE; STACKSIZ=STACKSIZ*10; FFS USE=LIN1;end!LINE MSOL = (PINJ MMAP PEXT);!MARK PINJ=()!  BX=1 AX=2 BY=1 AY=0.5 EMIX=1E-5 EMITY=1E-5 DP=0.01 SIGZ=1E-3 )!     PEXT=();MAP MMAP  =  ();MOMENTUM=0.299792458 GEV;FFS USE=MSOL;    INS;! Definition of Transfer Matrix!          ms={{1,0,0,0,0,0,},{0,1,0,0,0,0},{0,0,1,0,0,0},!              {0,0,0,0,1,0,},{0,0,0,0,1,0,},{0,0,0,0,0,1}};           ms={{0,2,0,0,0,0},{-0.5,0.75,0,0,0,0},{0,0,2,1,2,0},               {0,0,0,0,1,0},{0,0,0,0,1,0},{0,0,0,0,0,1}}; Standardform[$FORM="8.4";PageWidth=80;Print[ms]]; ExternalMap["TRACK",LINE["POSITION","MMAP"],_,x_]:=       {x,ms}; Print[Twiss[{"BX","BY"},"^^^"]]; Print[Twiss[{"AX","AY"},"^^^"]];trackemi[np_,emi_,sige_]:=Module[  {{bx,by}=Twiss[{"BX","BY"},"^^^"],p,siz},  p=GaussRandom[6,np];  siz=Join[Sqrt[emi* {bx,1/bx,by,1/by}],{0,sige}];  p*=siz;  AppendTo[p,Table[1,{np}]];     TrackParticles[{1,p},LINE["POSITION","PEXT"]][[2]]];!    TrackParticles[{1,p},LINE["POSITION","PINJ"]][[2]]];part["X"]={1,2};part["Y"]={3,4};label["X"]={"x(mm)","p`dx`n(10`u-3`n)"};label["Y"]={"y(mm)","p`dy`n(10`u-3`n)"};colors={"purple","blue","green","red"}; plottrack[l_,plane_]:=Module[{p,gy},   p=trackemi[2000,#,0]&/@l;   gy=MapThread[ListPlot[1000*Thread[#[[part[plane]]]],     PointColor->#2,     PointSize->0.3,     FrameLabel->label[plane],     GridLines->{Automatic,Automatic},     DisplayFunction->Identity,     AspectRatio->1]&,     {p, Take[colors, Length[p]]}]]; gx=plottrack[{1e-12,1e-13,1e-14},"X"]; gy=plottrack[{1e-12,1e-13,1e-14},"Y"]; Show[{   Graphics[ Rectangle[{-0.2, 0.1}, {0.4, 0.8}, gx] ],   Graphics[ Rectangle[{0.5, .10}, {1.1, 0.8}, gy] ]}];, Update[];end