#!/users/oide/WORK/oldsad/obj/OSF1/sad1.exe *
MOMENTUM= 5 GEV; ON ECHO;OFF EMIT CTIME RAD RFSW ; 
 LINE CELL=( IA0 -IP2 P1 P2 BV
   L00 S1  QF LS 4*QFT LS S2 SF L1 B  L1 QD SD L1 B L1  CA1)
 CELL1=( -IP2 IA1 IA2 IA3 L00 QF1 SF L1 B L1 QD1 SD  L1 B L1 CA1 M1)
 CELL2=(IP1 CA1 QF2 L1 QD1 L1 B SD L2 QF1 SF L2 SD B L1 QD1 L1 QF2)
 LIN1 = (IP1 QF1 L1 CA1 L1 QF1)
 CELL3 = (IP1 QF1 L1 B L1 P1 QD1 L1 B L1)
;
 LINE        TESTLINE=(CELL3 CELL3)
 ;
 DRIFT  L1     =(L = 1)
        L2  = (L=2)
        L00    =(L=0)
        LS=(L=0.1)
 ;
 BEND   B = (L=1 ANGLE=0.1 E1=0.5 E2=0.5 F1=0.1 FRINGE=3)
        B1= (L=5 ANGLE=.1 E1=0.5 E2=0.5)
        B2= (L=5 ANGLE=.1 E1=0.5 E2=0.5)
        B3= (L=5 ANGLE=.1 E1=0.5 E2=0.5)
        BV=(L=0.1 ANGLE=0 K0=0.0001 ROTATE=-90 DEG)
 ;
 MULT   QF     =(L = 1 K1 = 0.1549322394 DX=0.0001 DY=0.0001 )
        QFT     =(L = 0.1 K1 = -0.001 DX=0.001 DY=0.001 )
        QD     =(L = 1 K1 =-0.1549322394 ROTATE=0.001)
        QF1     =(L = 1 K1 = 0.1549322394 K3=100)
        QF2     =(L = 0.5 K1 = 0.1549322394/2 )
        QD1     =(L = 1 K1 =-0.1549322394 K3=-100)
 ;
 SEXT   SF     =(L = 0.001 K2=0.1)
        SD     =(L = 0.001 )
 ;
 MAP    P1 =()
        P2=()
 ;
 SOL    S1=(BOUND=1 GEO=1 DPX=0.02 BZ=0.1)
        S2=(BOUND=1);
 ;
 MONI   M1=()
 ;

 ;
 DRIFT  L1      =(L =1.6438921179655137 )  L2      =(L =14.238026004444558 )
 ;
 BEND   B       =(L =1    ANGLE = -.1 E1 =.5    E2 =.5    F1 =.1    FRINGE =3 )
 ;
 SEXT   SD      =(L =.001 K2 =3.009685508731555 )
        SF      =(L =.001 K2 =-.1879393790936433 )
 ;
 MULT   QF2     =(L =.5   K1 =.22378290007183185 )
        QD1     =(L =1    K1 =-.20282112241683073 )
        QF1     =(L =1    K1 =.13417654970698867 )
 ;
 CAVI   CA1     =(VOLT =2500000     HARM =10 L=2 )
 ;
 MARK   IP1     =(AX =7.146535306055332e-05   BX =26.274938814232897   AY =.0007666567412719797 BY =315.2999914351739
           EX =4.11831079983875e-07 EPX =1.7374825080229967e-06   DP =.005  SIGZ =.0015    EMITX =4e-05   EMITY =4e-05 )
 ;
 MARK   IP2     =(BETAX = 0.703     BETAY = 0.703  EMIX = 4.0E-5
   EMIY = 4.0E-5  DP = 0.01 SIGZ = 8E-4 )
 IA0     =(BETAX = 0.703     BETAY = 0.703  EMIX = 4.0E-5
   EMIY = 4.0E-5  DP = 0.01 SIGZ = 8E-4 OFFSET=0 )
 IA1 = (OFFSET=5.4)
 IA2 = (OFFSET=4.5)
 IA3 = (OFFSET=3.6)
 ;
 CAVI   CA1 = (VOLT=2.5 MV HARM=10)
 ;
 DECA  DF=(L=2 K4=1)
 ;
 APERT A1=(DX1=0.001 DY1=0.001 DX1=-0.001 DY1=-0.001 JDPX=0.001 JDPY=0.001)
 ;
 FFS USE=TESTLINE;
Print[GetPID[]];
!end

 rfsw cell ring;

 D[f[x],x]
 MemoryCheck[2]

Alternatives[]
!
!  FindRoot
   Clear[a,x];
   D[Sin[x],x]
TracePrint[
   a:=FindRoot[(Print[x];Sin[x]+0.99)==0,{x,Pi,{-0.1,5}}]];
   a
end

   Sin[x]/.a
  a:=FindRoot[(Print[x];Sqrt[Abs[x-2]])==0,{x,0}];
  a
  a:=FindRoot[Sin[x]==ArcSin[x],{x,0.9},AccuracyGoal->1e-30];
  a
  {Sin[x],Cos[y],Sin[y]}/.
     FindRoot[{(Print[{x,y}];Sin[x])==Cos[y],Sin[y]==0.5},{x,0},{y,0}]
  a:=FindRoot[x^2+y^2+0.1==0,{x,0.9},{y,0.1}]
  a
end

!
!    RADLIGHT
  MOMENTUM=1e9;
  tscale=1e-20;
  tw=1e-19;
!  B ANGLE 0
!  B K0 0.1
!  MOMENTUM=3e9;
!  MOMENTUM=1e10;
!  tscale=1e-18;
!  tw=1e-19;
  FindPeak[l_]:=Position[Abs[l],Max[Abs[l]]][[1,1]];
  TRPT ;
  RAD RADLIGHT;
  np=1;
  x=Table[0,{7},{np}];
  Do[x[[7,i]]=1,{i,np}];
  d={1,x};
  r=TrackParticles[d,10][[2,1]];
  MemoryCheck[2]

  f=RadiationField[r,{11,-0.1,0}];
  MemoryCheck[2]

  p=FindPeak[-f[[3]]];
  MemoryCheck[2]

  f[[1]]=f[[1]]-f[[1,p]];
  trange={f[[1,p]]-tw,f[[1,p]]+tw}/tscale;
  MemoryCheck[2]

  ListPlot[Transpose[{f[[1]]/tscale,f[[8]]}],
    PlotJoined->True,PlotRange->{trange,Automatic}];
  Update[];
  MemoryCheck[2]


!  ListPlot[Transpose[{f[1]/tscale,f[4]}],
!    PlotJoined->True,PlotRange->{trange,Automatic}];
!  ListPlot[Transpose[{f[1]/tscale,f[2]}],
!    PlotJoined->True,PlotRange->{trange,Automatic}];
  s=RadiationSpectrum[{f[[1]],f[[3]]},{0.001,1,0.001}*1e-8];
!  ListPlot[Transpose[{s[1],s[2]/scale}],PlotJoined->True]
!  ListPlot[Transpose[{s[1],s[3]/scale}],PlotJoined->True]
!  ListPlot[Transpose[{s[1],(s[2]^2+s[3]^2)/scale^2}],PlotJoined->True]
  ListPlot[Transpose[{s[[1]],(s[[2]]^2+s[[3]]^2)/tscale^2}],PlotJoined->True,
    Scale->Log]
  Update[];

end

With[{
  r=(Rule|RuleDelayed)[Graphics$Options,_]},

  LP[ll_List,opt___]:=Module[
    {d1},
    d1=Length[First[ll]];
    {ld,dr}={Thread[{Range[Length[ll]],ll}],{{1,Length[ll]},MinMax[ll]}};
    g=ld;
    g]];

  d=Random[100];
  h[]:=Module[{},LP[d,DisplayFunction->Identity];
    (* Update[];*)
    $Line=0];

  Do[h[];
    Print[MemoryCheck[2][[{1,2,3,4}]]],
    {10}];

   MemoryCheck[2]
 Print[TclUnicode["`fabcdefghijklmnopqrstuvwxyz234"]];
 Print[TclUnicode["`fABCDEFGHIJKLMNOPQRSTUVWXYZ/"]];

  wk=KBMainFrame["aaa",fr];

 b=Button[fr,Text->"`fabcdefghijklmnopqrstuvwxyz234"];
 b1=Button[fr,Text->"`fABCDEFGHIJKLMNOPQRSTUVWXYZ/"];
 c1=Canvas[fr,Width->800,Height->600];
 Canvas$Widget=c1;
!  b=Button[f,Text->"\\u03b1"];
!  b=Button[f,Text->"abcdef"//FromCharacterCode[{0xce,0xb2,0xce,0xb1}]];
! ListPlot[{{1,2},{3,4}},FrameLabel->{"aaa`fa`nbbb","b"}];

  cal;

  d=Random[100];
  h[]:=(ListPlot[d,DisplayFunction->Identity];
    (* Update[];*)
    $Line=0);

  Do[h[];
    Print[MemoryCheck[2][[{1,2,3,4}]]],
    {10}];

  OpticsPlot[{{"BX","BY"}}];
  Update[];

  FunctionTest=Class[{},{},{t0,a,b,c,d,e,f,g,C,a1,x,a2,b2,x2,
        ndim=4},

    Constructor[]:=(
        C=Literal[Class][{},{},{aa},];
        );

    Test[]:=(
      a1=a=Table[Random[],{ndim},{ndim}];
      Print[
        Fit[a[[,{1,2}]],a2*x2+b2,x2,{a2,0},{b2,0}]])
    ];

  ft=FunctionTest[];
  ft@Test[]


   LINE["NAME","Q*"]
   LINE["K1","QF.1"]=-0.1;
   LINE["K1","Q*"]=0.001*GaussRandom[Length[LINE["POSITION","Q*"]]];;

   f[x_Real]:={x,With[{n=x},{n+1,x}]};
   f[1]
   f[x_Real]:={x,x*2};
   f[1]
   f[x_Real]:={x};
   f[1]
   Clear[f];
   f[x_]:={x,x*2};
   f[1]

   With[{a=1},a+With[{a=2,b=3},a+b]]
   With[{a=2},With[{a=a+1},a]]
   With[{a=2},With[{b=a+1},b]]
   Function[{a},a+Function[{a,b,c},a+b+c][1,2,3]][4]

  C=Class[{},{},{x},];
  c=C[];
  c@x=2;
  c@x
  c=.

  free q*;
  var
  FFS["var"]
  fit nx 0.05 ny 0.07;
  go

  Function[{a,b},Function[a,a+1][a]][1,2]

   OpticsPlot[{{"BX","BY"}}];
   Update[];



a={{1,2},{3,4+I}};
b={-1,I};
a.a
a.b
Det[a]
Det[a.a]
Det[a]^2
Transpose[a]
   a=Random[100,100]+Random[100,100]*I;
   {u,w,v}=SingularValues[a,Inverse->False];
!   Timing[Do[{u,w,v}=SingularValues[a,Inverse->False],{10}]]
   Max[Abs[Conjugate[Transpose[u]].DiagonalMatrix[w].v-a]]
!
!    LinearSolve
   Clear[a,b];
   a=Table[Random[]+Random[]*I,{i,3},{j,3}];
!   b=Table[Random[]+Random[]*I,{i, 2},{j,3}];
!   x=LinearSolve[Re[a],Re[b]];
!   Transpose[Re[a].Transpose[x]]-Re[b]
!   x=LinearSolve[a,b];
!   Transpose[a.Transpose[x]]-b
!   a.Transpose[x]-Transpose[b]
   {e,u}=Eigensystem[a]
   Max[Abs[a.Transpose[u]-Transpose[u].DiagonalMatrix[e]]]
   ra=Re[a];
   {e,u}=Eigensystem[ra]
   Max[Abs[ra.Transpose[u]-Transpose[u].DiagonalMatrix[e]]]
   a={-1.,-1.,-1.,-1.,1.,1.,1.,1.};
   Fourier[a]
   MinMax[Abs[InverseFourier[Fourier[a]]-a]]
   a={-1.,-1.,-1.,-1.,1.,1.,1.,1.,1.};
   Fourier[a]
   MinMax[Abs[InverseFourier[Fourier[a]]-a]]
   a={-1.,-1.,-1.,-1.,-1.,1.,1.,1.,1.,1.};
   Fourier[a]
   MinMax[Abs[InverseFourier[Fourier[a]]-a]]



!
! FitPlot
!
  a=Vector[Range[10]];
  Sin[a]

 Clear[a,b,c,d,e,x];

  w=KBMainFrame["aaa",fr];
  ca=Canvas[fr,Width->700,Height->500,Side->"right"];
  Canvas$Widget=ca;
  xa=Range[-5,5,0.2];
  ya=0*Exp[-(xa^2/2)]+0.3*Table[GaussRandom[],{Length[xa]}];
  dya=Table[0.3,{Length[xa]}];
  data=Thread[{xa,ya,dya}];
  fun=a+b+c+d+e*x;
  f2=Fit[data,Evaluate[fun],x,{a,1},{b,1},{c,1},{d,1},{e,1}];
  $Line=0;MemoryCheck[2]
  pl=FitPlot[data,Evaluate[fun],x,{a,1},{b,1},{c,1},{d,1},{e,1},
    ResultLabel->{1,10},
    FunctionLabel->{1,0.8},
    PlotLabel->"FitPlot Test"];

Update[];

!
!  OpticsPlot
   w=KBMainFrame[DateString[],fr];
   c=Canvas[fr,Width->600,Height->400];
   $DisplayFunction=CanvasDrawer;
   Canvas$Widget=c;
   g=OpticsPlot[{{"BX","BY"},{"EX","EY"},
     {{{15,2},{10,4},{12,4},{18,1}},PointTags->{"aa","bb","cc","dd"},
       FrameLabel->"ABC"}},
     PlotLabel->"OK",
     Names->"Q*",Tags->True,
!     Region->{"QD","QD1"},
     FrameHeight->{0.4,0.6,0}];
   Update[];
   $Line=0;MemoryCheck[2]
   TimeUsed[]
!
!  Spline
  Clear[x,y];
   sp=Spline[{{1,2},{3,5},{4,2},{5,7}}];
   Plot[{sp[x],Derivative[1][sp][x],Derivative[2][sp][x],
     Integrate[sp[y],{y,1,#}]&[x]},{x,1,5}]
   Update[];

!
!   DynamicAperture
  emit;
  EMITX=(EMITY=1e-9)*100;
  SIGE=0.01;
  NPARA=4;

  DynamicApertureSurvey[{{0,100},{0,100},Range[-20,20,2]},1000,Output->6]

!
!
  xx;
  f=OpenShared[1000];
  Shared[f]="3";
  Shared[f]
  Shared[f]={3};
  Shared[f]
  Shared[f]=3;
  Shared[f]
  Shared[f]=a={Random[3,3],{"a","b"},{1,"a",Plus,xx}};
  a1=Shared[f];
  a===a1

$Line=0;MemoryCheck[2]
TimeUsed[]

end



!
!    Tracking, MAP
  Clear[np,x,d];
  NPARA=4;
  np=100;
  x={1,Append[0.001*GaussRandom[6,np],Table[1,{np}]]};
  x4=TrackParticles[x,1]
  NPARA=1;
  x1=TrackParticles[x,1]
  x4===x1
end

 $Line=0;MemoryCheck[2]
 $Line=0;MemoryCheck[2]


!
!  ExternalMap(OPTICS)
ExternalMap["OPTICS",LINE["POSITION","P1"],cod_]:=(
  Print[cod];
  {cod+{0,0.001,0,0,0,0},
    {{1,0,0,0,0,0},
    {0.01,1,0,0,0,0},
    {0,0,1,0,0,0},
    {0,0,0.01,1,0,0},
    {0,0,0,0,1,0},
    {0,0,0,0,0,1}},
    {{-1e-6,0,0,0,0,0},
    {0,-1e-6,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,-2e-6,0},
    {0,0,0,0,0,-2e-6}},
    {{1e-9,1e-10,0,0,0,0},
    {0,1e-9,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0}}
    });
end


!VariableRange[e_,k_,v_]:=Print[{e,k,v}];
! fit nx 0.1 ny 0.15 free q* go

end



!!
!   ListPlot
Tk$Echo=1;

w=KBMainFrame[DateString[],f];
c=Canvas[f,Height->600,Width->800];
Canvas$Widget=c;

  d=-.001;
  nu=0.243;
  a=Table[Exp[d n]*{Cos[2 Pi nu n],Sin[2 Pi nu n]},{n,1,15}];
  g=ListPlot[a,FrameLabel->{"a","b","c","d"}];
  Update[];
 $Line=0;MemoryCheck[2]
 $Line=0;MemoryCheck[2]
end


  ListPlot[a,PlotRange->{{-.5,.5},{-.5,.5}},AspectRatio->1];
  ListPlot[a,PlotJoined->True]]
end


Tk$Echo=1;
w=Window[];

w1=(Hold/@[Definition[w],{2}])[[1]];
w[CGet[Height]]
w2=(Hold/@[Definition[w],{2}])[[1]];

end

A=Class[{},{},{f},

  Constructor[]:=(
    Module[{x},
      f[x_]:=x]);
  ];

a=A[];

?(a@f)

end


C0=Class[{},{},{},g[]:=(Literal[Print][This];"a")];
C=Class[{C0},{},{},f[]:=g[]];
c=C[];
c@f[]
Print[?(c@f)];
c@AllMembers[]
end

f[{a___,x_,b___,y_}]:={a,x,b,y};
f[{a___,x_,b___}]

MatchQ[{a___,b___},{a___,b___,{y_}}]
MatchQ[{{x_},b___},{{x_},b___,{y_}}]
MatchQ[{a___,{x_},b___},{a___,{x_},b___,y}]
MatchQ[{a___,{x_}},{a___,{x_},{y_}}]
MatchQ[{a___,x_,b___},{a___,x_,b___,y}]
MatchQ[{a___,x_,b___},{a___,x_,b___,y_}]


MatchQ[{a___,x_,b___},{a___,x_,b___,{y_}}]
MatchQ[{a___,{x_},b___},{a___,{x_},b___,{y_}}]

MatchQ[f_[a___,g[x_],b___],f_[a___,g[x_],b___,g[y_],`c___]]
MatchQ[f_[a___,Vector[x_],b___],f_[a___,Vector[x_],b___,Vector[y_],`c___]]

f[a_][b_,c_]:={a,b,c};
f[1][2,3]

SetAttributes[f,HoldAll]

f[CompoundExpression[x__]]:=f[{x}];
f[x___]:=f[{x}];
f[{x___}]:=Hold/@Hold[x];
f[a;b;c]

B=Class[{},{},{a=3},
  f[]:="a";
  g[]:="b";
  h[]:={This}];
b=B[]
b@f[]
b@h[]
?(b@AllMembers)

end


(f[x_]=`z_List)^:=Null;
f[x___]:=f$[x]
f["a","b"]

LINE["NAME"]
LINE["NAME","$$$"]

!
!  MessageName
Unprotect[MessageName];
a::b="a"
a::b
Plus@@{1,2,3,4,5}
a={1,2,3,4,5};
Plus@@a
b=a
b
!
!  SwitchCases, WhichCases
  Clear[a,b,c,d,e];
  a={1,"abc",2,3,{3,4,5},b};
  SwitchCases[a,{_String,_Symbol,_List,_}]
  SelectCases[a,{#>2&,Head[#]===List&,1&}]
  Clear[a];
  SwitchCases[{a->b},{(Rule|RuleDelayed)[aa,_],(Rule|RuleDelayed)[a,_]}]

  f[x_]:=x+1;
  f[3]
  f[x_]:=x+2;
  Definition[f]

  f[x_]:=SwitchCases[x,{(Rule|RuleDelayed)[aa,_],(Rule|RuleDelayed)[a,_]}];
  f[{a->b}]

end
!
!   Partition
!  Clear[a];
  a={1,2,3,4,5};
  Partition[a,2]
  Partition[a,3,1]
  b={a,a*2,a*3,a*4,a*5};
  Partition[b,{2,2}]
end
!
!   Thread,MapThread
   Clear[b,c,d,e,f];
   d[c,e]=1;
   f[{b,c},{d,e}]=1;
   Apply[dd,{{b,c},{d,e}}]
   Definition[dd]
   Thread[Apply[dd,{{b,c},{d,e}}]]
   Thread[Apply[dd,{{b,c},{d,e}}]]/.dd->f
   MapThread[f,{{b,c},{d,e}}]
   MapThread[f,{{b,c},{d,e}},{2}]
   a=Table[i*10+j,{i,0,9},{j,0,9}]
   ScanThread[Print,a]
!   Timing[Do[MapThread[f,a],{10000}]]
   MemoryCheck[]
end

!
! Extract
  Clear[a,b,c,d,e];
  a=Range[10];
  Extract[a,{{1},{2}}]
  Extract[a,{{1},{2}},b]
  b=Table[i+j*10,{j,4},{i,5}];
  Extract[b,{{,2}}]
!  Timing[Do[Extract[a,{1},Hold],{1000000}]]
!  Timing[Do[a[[1]],{1000000}]]
!  Timing[Do[HeldPart[a,1],{1000000}]]
end
!
! RefCount Problem
  Clear[a,b,c,d,e,f,g];
  (Length[#]+Length[#])&[{1}]
  (Length[a=#;a=.;#]+Length[Print[#];#])&[Table[Sin[i],{i,10}]]
  (Length[Print[#];#]+Length[Print[#];#])&[Table[Sin[i],{i,10}]]
  (Length[#]+Length[#])&[Table[Sin[i],{i,10}]]
  f[a_,a_]

  Clear[f,a,b,c];
  f[a_+c[b_]]:=Print[{{a},{b}}];
  f[1+c[3]]
  f[{1,2}+c[3]]
end
!
!   Take, Join, Append, Prepend, Reverse
  Clear[f];
  f[1,2]=-1;
  Take[f[1,2,3],2]
  Join[f[1],f[2]]
  Append[f[1],2]
  Prepend[f[2],1]
  Reverse[f[2,1]]
!
!
  Clear[a,b,c,d,e];
  a={};
  MemoryCheck[]
  Do[a=Append[a,i],{i,10000}];
  MemoryCheck[]
end
!
!    Sequence
   Clear[a,b,c,d,e];
   Print[1+[2,3,4],[2,3,4]+1];
   Print[[1,2,3]];
   Print[f[a,[b,c,d],e]];
   a=[1,2,3]
end
!
!   MapAt,FlattenAt,ReplacePart,Insert,Delete
   Insert[{},"a",1]
   Insert[{},"a",{1}]
!
   Clear[a,b,c,f];
   a=Table[i*100+j*10+k,{i,4},{j,3},{k,3}]
   -a
   -Plus@@a
   ReplacePart[a,0,2]
   ReplacePart[a,0,{2,3}]
   ReplacePart[a,0,{{2,3},{1,2}}]
   ReplacePart[a,0,{,2}]
   ReplacePart[a,0,{{,2}}]
   ReplacePart[a,Plus,0]-Plus@@a
   MapAt[Null[0,#]&,a,2]
   MapAt[f,a,2]
   MapAt[f,a,{2,3}]
   MapAt[f,a,{{2,3},{1,2}}]
   FlattenAt[a,2]
   FlattenAt[a,{2,3}]
   FlattenAt[a,{{2,3},{1,2}}]
   Insert[a,0,2]
   Insert[a,0,{2,3}]
   Insert[a,0,{{2,3},{1,2}}]
   Insert[a,0,5]
   Delete[a,2]
   Delete[a,{2,3}]
   Delete[a,{{2,3},{1,2}}]

   aa=a;
   aa[[,2]]
   aa[[,2]]=0;
   aa
 
!
!   Map, Apply, MapAll
  Clear[a,b,c,d,e];
  a:=b/@c;
  {Definition[a]}
  a=b/@[c,d]
  {Definition[a]}
  Clear[a];
  e={1,2,3,{4,5}};
  a//@e
  a//@[e,Heads->True]
!
!   Map, Apply
   Clear[a,b,c,d,e,f,g];
   a={b,c,{d,{e,g}}};
   Level[a,{-2,1}]
   Level[a,{0,Infinity}]
   Apply[f,a,{-2,1}]
   Map[f,a,{0,Infinity}]
   Apply[f,a]
   Apply[f,a,0]
   Apply[f,a,1]
   Apply[f,a,-1]
   Apply[f,a,{1,2}]
   Apply[f,a,{2,1}]
   Apply[f,a,{1,-2}]
   Apply[f,a,{-2,1}]
   Apply[f,a,{-3,-1}]
   Apply[f,a,{-1,-3}]
  MapAll[f,a]
   Map[f,a]
   Map[f,a,0]
   Map[f,a,1]
   Map[f,a,-1]
   Map[f,a,{1,2}]
   Map[f,a,{2,1}]
   Map[f,a,{1,-2}]
   Map[f,a,{-2,1}]
   Map[f,a,{-3,-1}]
   Map[f,a,{-1,-3}]
   Clear[a];
!   a=Range[1,30000];
!   Timing[Map[Sin,a];]
!   Timing[Table[Sin[a[i]],{i,30000}];]
end



!
!   DynamicAperture
 emit;
   EMITX=(EMITY=1e-9)*100;
   SIGE=0.01;
   NPARA=4;
   
   Timing[
     DynamicApertureSurvey[{{0,100},{0,100},Range[-20,20,2]},1000,Output->6]]

end

bxi 10 axi -10 byi 10 ayi 10;free q*;
fit ^^^ $$$ bx 1 go;

EMITX=1e-9;EMITY=1e-10;
DP=1e-3;
BEAM;
draw bx by & ex ey & sizex sizey
end


!
!    Tracking, MAP
  Clear[np,x,d];
  NPARA=4;
  np=1000000;
  x={1,Append[0.001*GaussRandom[6,np],Table[1,{np}]]};
  Timing[x4=TrackParticles[x,1]]
  NPARA=1;
  Timing[x1=TrackParticles[x,1]]
  x4===x1
end

  TrackParticles[x,3.5]
  TrackParticles[x,4]
  TrackParticles[x,1]
  TrackParticles[x,1,1]
  TrackParticles[x,1,1,1]
  x1=  TrackParticles[x,1,1,2];
  x01= TrackParticles[TrackParticles[x,1,1],1,1,1];
  x1-x01
  Timing[x1000=TrackParticles[x,1,1,1000]]
  Timing[Do[x=TrackParticles[x,1],{1000}]]
  x-x1000

end
  np=10000;
  x={1,Append[0.001*GaussRandom[6,np],Table[1,{np}]]};
  Do[x[2,1,i]=1000,{i,1001,9001,1000}];
  d=TrackParticles[x,1];
  p=Position[d[2,7],0]
  track[np_]:=(
    x1=Map[Take[#,np]&,x,{2}];
    TrackParticles[x1,1];);
  Date[]
  Timing[Do[track[Floor[30000/32.8]],{100}]]
  Date[]
  Timing[Do[track[Floor[30000/33.2]],{100}]]
  Date[]
end



!
!  OpticsPlot
!   w=Window[];
!   c=Canvas[w,Width->600,Height->400];
!   $DisplayFunction=CanvasDrawer;
!   Canvas$Widget=c;

 OpticsPlot[{{"BX","BY"},{"EX","EY"}}];
 Update[];

end

   g=OpticsPlot[{{"BX","BY"},{"EX","EY"},
     {{{15,2},{10,4},{12,4},{18,1}},PointTags->{"aa","bb","cc","dd"},
       FrameLabel->"ABC"}},
     PlotLabel->"OK",
     Names->"Q*",Tags->True,
!     Region->{"QD","QD1"},
     FrameHeight->{0.4,0.6,0}];
   TkWait[];
end

   Timing[p3=OpticsPlot[{{"BX","BY"},{"EX","EY"},
     {{{15,2},{10,4}},{{12,3},{18,2}},FrameLabel->"ABC"}},
     Initialize->Frame,
     Names->"Q*",Tags->True,
     Region->{"QD","QD1"},
     FrameHeight->{0.4,0.6,0}];]
   Update[]
end




!
! SavePlot

 SeedRandom[3];
 d=GaussRandom[100,2];
! w=KBMainFrame[DateString[],f];
! c=Canvas[f,Width->400,Height->300];
! Canvas$Widget=c;
 ListPlot[d,FrameLabel->{"bottom","left","top","right"},PlotLabel->"Plot"];
 TkWait[];

end


!
! scope
!

 Module[{x},
   f[x_]:=x;
   Print[?f]];

 ?f

end
!
!
! $Immediate
!
  $Immediate=1;
  a[[b]]

end

!
! ListPlot
!
  Timing[
    ListPlot[GaussRandom[200000,2],FrameLabel->{"`fa","`fb"}];Update[]]
end

!
! RAD
!
NPARA=4;
  fit ex 0 epx 0 free q* l*; go;
  DP=0.01;
  fit nx Twiss["NX","$$$"]/2/Pi 5 ny Twiss["NY","$$$"]/2/Pi 5;
  fix * free s* go;

  rad;fluc;radcod;
  emit;

(*
  z={1,Append[Table[{0},{6}],{1}]};
  B -0.1;
  SeedRandom[3];
  z1=TrackParticles[z,1,1,10];
  B 0.1;cal;
  SeedRandom[3];
  z2=TrackParticles[z,1,1,10];

  Print[{z1,z2}];

end
*)

  np=1000;
  siz={Sqrt[bx0 EMITX],Sqrt[EMITX/bx0],0,0,0,0};
  z={1,Append[GaussRandom[6,np]*siz,Table[1,{np}]]};
  bx0=Twiss["BX","$$$"];
  NPARA=4;

  track[z_]:=Module[{z0,z1,np1,ave,xx,xpx,pxpx,emix},
    z0=TrackParticles[z,1,1,1000];
    flag=z0[[2,-1]];
    z0=SurvivedParticles[z0[[2]]];
    np1=Length[z0[[1]]];
    z1=Take[z0,6];
    ave=(Plus@@[z1,{1}])/np1;
    z1-=ave;
    xpx=Plus@@(z1[[1]]*z1[[2]])/np1;
    xx=Plus@@(z1[[1]]^2)/np1;
    pxpx=Plus@@(z1[[2]]^2)/np1;
    emix=Sqrt[xx*pxpx-xpx^2];
    StandardForm[$FORM="10.5";Print["emitx: ",{np1,emix}]];
    {emix,{1,z0}}];

d=Table[{emix,z}=track[z];
  emix,{50}];

end

!
! RAD
!
  fit ex 0 epx 0 free q* l*; go;
  DP=0.01;
  fit nx Twiss["NX"."$$$"]/2/Pi 5 ny Twiss["NY","$$$"]/2/Pi 5;
  fix * free s* go;


  rad;fluc;radcod;
  emit;
  np=1000;
  siz={Sqrt[bx0 EMITX],Sqrt[EMITX/bx0],0,0,0,0};
  z={1,Append[GaussRandom[6,np]*siz,Table[1,{np}]]};
  bx0=Twiss["BX","$$$"];
  NPARA=4;

  track[z_]:=Module[{z0,z1,np1,ave,xx,xpx,pxpx,emix},
    z0=TrackParticles[z,1,1,1000];
    flag=z0[[2,-1]];
    z0=SurvivedParticles[z0[[2]]];
    np1=Length[z0[[1]]];
    z1=Take[z0,6];
    ave=(Plus@@[z1,{1}])/np1;
    z1-=ave;
    xpx=Plus@@(z1[[1]]*z1[[2]])/np1;
    xx=Plus@@(z1[[1]]^2)/np1;
    pxpx=Plus@@(z1[[2]]^2)/np1;
    emix=Sqrt[xx*pxpx-xpx^2];
    StandardForm[$FORM="10.5";Print["emitx: ",{np1,emix}]];
    {emix,{1,z0}}];

d=Table[{emix,z}=track[z];
  emix,{50}];

end

!
! USE
!

rep 10

  USE EXPAND TESTLINE;
  Print[MemoryCheck[2]];

until

end

!
! Integrate
!
 n=4096;
 d=GaussRandom[n];
 x=Range[n];
 f=Spline[Thread[{x,d}]];
 f[{1,2,3}]
 Derivative[1][f][{1,2,3}]
 Derivative[2][f][{1,2,3}]

 g[k_]:=NIntegrate[Cos[k s]f[s],{s,1,n},InitialPoints->n,AccuracyGoal->1e-3,Spline->True]
 Timing[
   Plot[g[k],{k,0,50}];Update[];]

end


!
!  StringMatchQ, StringPosition, ToUpperCase

  StringMatchQ["qf1a","q{^d}*{^b}"] 
  StringMatchQ["qf1a","q*{^b}"] 
  StringMatchQ["qf1a","q{^d}*{^a}"] 
  StringMatchQ["qf1a","q*{^a}"] 
  StringMatchQ["qa","q{^d}*{^b}"] 
  StringMatchQ["qa","q*{^b}"] 

end

  a="ToLowerCase";
  aa=a//a;
  Timing[Do[ToLowerCase[a],{100000}]]
  Timing[Do[ToLowerCase[aa],{100000}]]
  Timing[Do[a//a//a,{100000}]]
  Timing[Do[StringReplace[a,"cd"->"xxx"],{100000}]]

  StringPosition["abcdeabcdeabc","cde"]
  StringPosition["abcdeabcdeabc","cde",1]
  StringPosition["abcdeabcdeabc",{"abc","cde","abc"}]
  ToUpperCase["ToUpperCase"]
end

!
! FitPlot
!
  w=KBMainFrame["aaa",f];
  ca=Canvas[f,Width->800,Height->400];
  Canvas$Widget=ca;
  xa=Range[-5,5,0.2];
  ya=0*Exp[-(xa^2/2)]+0.3*Table[GaussRandom[],{Length[xa]}];
  dya=Table[0.3,{Length[xa]}];
  data=Thread[{xa,ya,dya}];
  fun=a +b+c+d+0*e*x;

Do[
!  pl=FitPlot[data,Evaluate[fun],x,{a,1},{b,1},{c,-1},{d,0.5},{e,0.1},
  pl=FitPlot[data,Evaluate[fun],x,{a,1},{b,1},{c,1},{d,1},{e,1},
    ResultLabel->{1,10},
    FunctionLabel->{1,0.8},
    PlotLabel->"FitPlot Test"];
  Print[MemoryCheck[1]],{1}];

Update[];
end

!
!
!   Transpose, SingularValues, DiagonalMatrix
   Clear[a,b];
   Print[SingularValues[{{1.,I,1+I},{I,2I,1},{1+I,1+2I,1+I}},Inverse->False]]

   a=Random[100,100]+Random[100,100]*I;
   Timing[Do[{u,w,v}=SingularValues[a,Inverse->False],{10}]]
   Max[Abs[Conjugate[Transpose[u]].DiagonalMatrix[w].v-a]]
end
   a=Table[i*10+j,{i,4},{j,4}];
   {u,w,v}=SingularValues[a,Tolerance->1e-18]
   {u,w,v}=SingularValues[a,Tolerance->1e-18,Inverse->False]
   {u,w,v}=SingularValues[a]
   {u,w,v}=SingularValues[a,Inverse->False]
   u.Transpose[u]
   v.Transpose[v]
   wm=DiagonalMatrix[w];
   Transpose[u].wm.v-a
end
   cov=DiagonalMatrix[w].v;
   Transpose[v].v
   Transpose[cov].cov
   a=Table[i*10+j,{i,5},{j,3}];
   {u,w,v}=SingularValues[a]
   Transpose[u].DiagonalMatrix[1/w].v
   Transpose[a]
   a=Table[Random[],{i,100},{j,100}];
   Timing[SingularValues[a];]
end
  
 f=StringToStream["aaa bbb\nccc ddd\n   "]
 Do[ Print[Read[f]], {5}];

end

 Parallelize[(Print[#];MemoryCheck[])&,4,100,4]
 Parallelize[(Print[#];MemoryCheck[];{aa[]})&,4,100,4]
 Parallelize[(Print[{#,MemoryCheck[]}];Symbol["bb"//#])&,4,100,4]

end


 a=Table[0,{2^29}];
 MemoryCheck[2]
 Clear[a];
 MemoryCheck[2]
end




 z=Table[0,{7},{1}];
z[[7,1]]=1;
z[[2,1]]=0.1;
 z={1,z};
LINE["NAME",Position[Table[TrackParticles[z,k][[2,7,1]],{k,2,LINE["LENGTH"]}],0,1,1][[1,1]]+1]

end




 ins trpt cal;

PBUNCH=1e11;
intra;
emit

(*
d=TouschekTable;
spy=Spline[Thread[{d[[3,1,1]],d[[3,2]]}]];
f[x_,z_]:=Spline[Thread[{d[[3,1,3]],spy[x]}]][z];*)

f[x_,z_]:=TouschekLifetime[x,Infinity,z];
(*Plot[{f[10,z],f[12,z],f[16,z],f[22,z]},{z,4.6,100}];Update[]*);

contrib[x10_,x20_,z10_,z20_,ax_,az_]:=Module[
  {{x1,x2,z1,z2}={x10/ax,x20/ax,z10/az,z20/az},s},
  Which[
    x1+z1>=1,0,
    x2+z2<=1,1,
    s=(x2-x1)*(z2-z1);
    x1+z2>=1,
    If[x2+z1>=1,
      (1-x1-z1)^2/2/s,
      (2-x1-x2-2*z1)*(x2-x1)/2/s],
    x2+z1>=1,
    (2-z2-z1-2*x1)*(z2-z1)/2/s,
    True,
    1-(x2+z2-1)^2/2/s]];

tomomat=Module[{cx=Prepend[TouschekTable[[3,1,1]],0],
  cz=Prepend[TouschekTable[[3,1,3]],0],
  d=TouschekTable[[3,2]],m},
  m=Table[
    contrib[cx[[k-1]],cx[[k]],cz[[l-1]],cz[[l]],cx[[i]],cz[[j]]],
    {i,2,Length[cx]},{j,2,Length[cz]},
    {k,2,Length[cx]},{l,2,Length[cz]}
    ];
  Flatten[Flatten/@[m,{2}],1]
  ];

s=Partition[LinearSolve[tomomat,Flatten[TouschekTable[[3,2]]]],25];
ListDensityPlot[s];Update[];

end




e=Emittance[Emittance->False,Matrix->True];
m=TransferMatrices/.e;
ma=m[[LINE["POSITION","QF"]]];
mb=m[[LINE["POSITION","QD"]]];
mab=mb.SymplecticInverse[ma];
r56ab=mab[[5,6]]

End



 Twiss["BX",LINE["POSITION","QFT"]]
 Twiss["BX",LINE["POSITION","QFT"]+0.2]
 Twiss["BX",LINE["POSITION","QFT"]+0.4]
 Twiss["BX",LINE["POSITION","QFT"]+0.6]
 Twiss["BX",LINE["POSITION","QFT"]+0.8]
 Twiss["BX",LINE["POSITION","QFT"]+1]

end


  {in,out}=BidirectionalPipe["/bin/sh"];
  Write[out,"exec /bin/tcsh -f -c 'ls -tx /ldata'"];
  Close[out];
  ReadString[in]
  ReadString[in]
  ReadString[in]

end

end

 draw bx by & ex ey q*

 $FontSystem

end
!
!   ListPlot
  Head[sc]
  sc=Log;
  Head[sc]
  MemoryCheck[]
  g1=ListPlot[{{1,2},{10,20}},Scale->Log,PlotJoined->True,
    DisplayFunction->Null,FrameLabel->{"",DateString,DateString,""}];
  MemoryCheck[]
  Show[Graphics[Rectangle[{0,0},{0.5,1},g1]]];
  MemoryCheck[]
  g2=ListPlot[{{1,15},{10,3}},Scale->Log,PlotJoined->True,Dashing->"1 0.3",
    DisplayFunction->Null,Plot->False,PlotColor->"Red"];
  MemoryCheck[]
  g3=ListPlot[{{1,2.5},{5,10},{10,12}},Scale->Log,
    DisplayFunction->Null];
  MemoryCheck[]
  Show[g1,g2,g3,FrameLabel->{"X (mm)","Log(Y)"},PlotLabel->"Test Plot"];
  MemoryCheck[]
  Show[g1,g2,g3,FrameLabel->{"X (mm)","Log(Y)"},PlotLabel->"Test Plot",
      AspectRatio->1,PlotSymbol->"1P"];
  MemoryCheck[]
 end
!
! ColumnPlot
  w=Window[];
  c=Canvas[w,Width->400,Height->300];
  Canvas$Widget=c;
  g=ColumnPlot[{1,2,3,5}]
end
  TkWait[];
  g=ColumnPlot[{{1},{2},{3},{5}}]
  TkWait[];
  g=ColumnPlot[{{1,2},{2,-1},{3,4},{5,2}}]
  TkWait[];
  g=ColumnPlot[{{{1,1,2},{2,2,3}},{{1,4,2},{2,2,3}},
    {{1,3,2},{2,2,3}}},Orientation->Horizontal]
  TkWait[];
end

   Clear[a,b,c];
   a={-1.,-1.,-1.,-1.,1.,1.,1.,1.};
   Fourier[a]
   MinMax[Abs[InverseFourier[Fourier[a]]-a]]
   a={-1.,-1.,-1.,-1.,1.,1.,1.,1.,1.};
   Fourier[a]
   MinMax[Abs[InverseFourier[Fourier[a]]-a]]
   a={-1.,-1.,-1.,-1.,-1.,1.,1.,1.,1.,1.};
   Fourier[a]
   MinMax[Abs[InverseFourier[Fourier[a]]-a]]

end

fit IA1 gx 22
free l* go

end

!
!   DownhillSimplex
  f:=Apply[Print[The$Simplex@Status];Function[{x,y,z},((x^2+y^2+z^2)-1)*(x^2+y^2+z^2)+(x+3)/3.],#]&;
  v={{2,2,2},{0.,-2,2},{0.,2.,2.},{-2,2,0}};
  limit=Thread[{{-3,3},{-3,3},{-3,3}}];
  p=Sort[Map[{f[#],#}&,v]]
  DownhillSimplex[p,f,MaxIteration->100,Tolerance->1e-4,VariableRange->limit,TryReflect->2]

end
!
!   DownhillSimplex
  free q* q* l
  fit nx .3 ny .2
  OptimizeOptics[]
end



intra ;Emittance[Output->6]

end
!
 NP=100;
 Do[FFS["meas",If[i>105,6,0]],{i,110}]
 Do[FFS["cal",If[i>105,6,0]],{i,110}]
end
!
!
TRPT;NOCOD;
e=Emittance[Matrix->True]

end

!
!
!  OpticsPlot
!   w=KBMainFrame["aaa",f];
!   c=Canvas[f,Width->600,Height->400];
!   Canvas$Widget=c;

 f=KBMainFrame["aaa",w];
 c=Canvas[w,Width->600,Height->400];
 Canvas$Widget=c;

   dp=0.01;
   emix=1.d-4;

   BeamSizeX[k_]:=Sqrt[Twiss["BX",k]*emix]+Abs[Twiss["EX",k]*dp];

   OpticsPlot[{{"BX","BY"},{"EX","EY"},
     {BeamSizeX,PlotJoined->True,FrameLabel->"AbsSize"}},
     PlotLabel->"Optics Plot",
     InfoLabel->True,
     Names->"Q*"]

   bslist={#,BeamSizeX[#]}&/@Range[LINE["LENGTH"]];
   OpticsPlot[{{"BX","BY"},{"EX","EY"},
     {bslist,PlotJoined->True,FrameLabel->"AbsSize"}},
     PlotLabel->"Optics Plot",
     Names->"Q*"]
   TkWait[];

end

 qd dy 0.01 cal
end
 coup qf qf1 1
 fit nx 0.46
 free qf1
 go
 cal
 var
 rec
 free qf qf1
 go 
 cal
 var

end
!
!
   ToDate[FromDate[Date[]]+0.5119,Tick->0.001]
   ToDate[Floor[FromDate[Date[]]+0.5119],Tick->0.001]
   Date[]
   Date[Tick->0.001]
   FromDate[Date[Tick->0.001]]
   DateString[]
   DateString[Compressed->True]
   DateString[1,2]
   DateString[Tick->0.001,Compressed->True]
   DateString[Date[Tick->0.001],Tick->0.001]
   DateString[FromDate[Date[Tick->0.001]],Tick->0.001,Compressed->True]

end
!
!  ExternalMap(OPTICS)
ExternalMap["EMIT",LINE["POSITION","P1"],cod_]:=(
  Print[cod];
  {cod+{0,0.001,0,0,0,0},
    {{1,0,0,0,0,0},
    {0.01,1,0,0,0,0},
    {0,0,1,0,0,0},
    {0,0,0.01,1,0,0},
    {0,0,0,0,1,0},
    {0,0,0,0,0,1}},
    {{-1e-6,0,0,0,0,0},
    {0,-1e-6,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,-2e-6,0},
    {0,0,0,0,0,-2e-6}},
    {{1e-9,1e-10,0,0,0,0},
    {0,1e-9,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0},
    {0,0,0,0,0,0}}
    });
!ExternalMap["GEO",LINE["POSITION","P1"],geo_,pos_]:=(Print[{geo,pos}];
!  {{geo[[1]]+{1,0,0},geo[[2]]},pos+0.1});
cal
emiout emit

end
!
! LegendreP
LegendreP[3,1,0.5]
Plot[{LegendreP[3,3/2,x],LegendreP[3,5/2,x]},{x,-0.7,0.7}]
end

KBF$ListFiles["/users/oide/KEKB","*",{},True]
end
!
! Union
Clear[a,b,c,d,e,x,y,z];
 a=Random[30000,2];
 Timing[b=Union[Floor[a*100]]]
 Length[b]
 Timing[b=Union[Floor[a*50]]]
 Length[b]
 Timing[b=Union[Floor[a*25]]]
 Length[b]
end
!
!
  w=KBMainFrame["aaa",f];
  c=Canvas[f,Width->600,Height->400];
  Canvas$Widget=c;
  d=Random[10];
  x=FromDate[{2002,6,1,0,0,0}]+86400*30*Range[10];
  ListPlot[Thread[{x,d}],Scale->{Date,Linear}];
Update[];
end

 fbu=Window[];
 brelo = Button[fbu,Text->"ReLoad",Side->"left",Width->8,BD->1,
   Command:>ReloadVc[],PadX->5];

 Do[With[{k},
   tlnb[k] = Entry[fbu,TextVariable:>vctxt[k],Width->10,BD->1,
     Relief->"sunken",PadX->3,HighlightThickness->0]],
   {k,10}];

 ReloadVc[] := (
   vcdata = CaRead["takahash:AUTO_VC:DATA"][1];
   Do[vctxt[k] = ToString[vcdata[[k]]],{k,10}]);

 TkWait[];

end
!
! Shared memory
  n=OpenShared[10000]
  a=Range[1000];
  Shared[n]=a;
  MemoryCheck[1]
  b=Range[262144]
  MemoryCheck[1]
  a===Shared[n]
end

 a={1};
 b={1,"a",a,2,3,Hold[1,{2}]["a",a,]};
 SharedSize[b]
  Do[n=OpenShared[328];Print[n],{10}];
  n=OpenShared[328]
  

  If[Fork[],
    Sleep[1];
    Shared[n]={1,"a",{1},2,3,Hold[1,{2}]["a",{1},]};
    Shared[n]={1,"a",a,2,3,Hold[1,{2}]["a",a,]};
    Print["Write"],
    Do[
      Sleep[0.1];
      Print[Shared[n]],
      {20}]];
      
end



!
! 
  Clear[a,b,c,d,e,f];
  $Line=0;MemoryCheck[]
  a=GaussRandom[100,100];
  b=GaussRandom[100];
  LinearSolve[a,b];
  a=.;b=.;
  $Line=0;MemoryCheck[]
  Do[a=GaussRandom[100,100];
  b=GaussRandom[100];
  LinearSolve[a,b];
  a=.;b=.;,{20}];
  $Line=0;MemoryCheck[]
end

!
!
! FixedPoint
  FixedPoint[Cos,0]
  FixedPoint[Cos,0,20]
  FixedPointList[Cos,0]
end

!
  C=Class[{},{},{EL={1,2}},
    f[a_String:"aa",b_List:EL]:=Print[{a,b}]];
  CC=Class[{C},{},{},];
  c=CC[];
  c@f
?(c@f)
end
  c@f[]
  c@f["bb"]
  c@f[{3,4}]

end
!
!
!
!   FitValue
!    fit sf nx .25
   fit sf sf.2 nx 0.25
   FitValue["SF","SF.2","NX",dp_,goal_,v_,v0_]:=(Print[{v,v0}];If[Abs[v0-(v+goal)]<0.01*2*Pi,Null,v]);
   free q* go
end

   FitValue[loc_,fun_,dp_,v_,v0_]:=(Print[{loc,fun,dp,v,v0}];0.3);
   nx .25 ny .21 cal
   end
!
!
Clear[f,g,h];
f[x_]:=x;
g[x__]:=x;
f[{1}]
g[{1}]
end
!
!
!
 w=Window[];
 c=Canvas[w,Width->600,Height->400];
 Canvas$Widget=c;
 f[x_]:=Table[x*i-1,{i,1,3}];
 Show[Table[Plot[f[x][[i]],{x,0,1}],{i,1,3}]];
Update[];
end

  data={{-2,3,1},{-1,1,0.3},{0,0,0.3},{1,1,0.3},{2,4,0.3}};
  fun=(a x^2+b x+c);
x=1;
pl=  FitPlot[data,Evaluate[fun],x,{a,1},{b,1},{c,-1}];
end



    fun[x_]=I*bbb1*Sqrt[2*Pi/sigmax^2*(1-k^2)]*Exp[-(x-xof)^2/2/sigmax^2*(1-k^2)] * 
   (-Erf[-I*(x-xof)/Sqrt[2*sigmax^2*(1-k^2)]]+Erf[-I*k*(x-xof)/Sqrt[2*sigmax^2*(1-k^2)]]) + bbb2;
   funV[yInd_]:=b1v/sigmaxv*Sqrt[Pi/(1-kv^2)]*Exp[-(yInd-yof)^2/4/sigmaxv^2/(1-kv^2)] * 
     (Erf[(yInd-yof)/kv/2/sigmaxv/Sqrt[1-kv^2]]-Erf[(yInd-yof)/2/sigmaxv/Sqrt[1-kv^2]]) + b2v;
!       funV[yInd_]:=Sqrt[1/(1-kv^2)]*Exp[-1/(1-kv^2)] * Erf[1/Sqrt[1-kv^2]];
    datafile={{-4,1.9},{-3,1.8},{-2,1.5},{-1,1},{0,0},{1,-1},{2,-1.5},{3,-1.8},{4,-1.9}};
  xzero=0;
  b2zero=0.1;
       fit=FitPlot[datafile,fun[x],x,
        {k,0.02,{0.0001,0.5}},
        {xof,xzero,{-100,100}},
        {sigmax,1,{5,80}},
        {bbb1,1,{-100,100}},
        {bbb2,b2zero,{-1000,2000}},D->False];

end

   kvinitial=1;
   yzero=0;
      fitv=FitPlot[datafile,Evaluate[funV[yInd]],yInd,
        {kv,kvinitial,{0.01,0.999}},
        {yof,yzero,{-500,500}},
        {sigmaxv,150,{10,500}},
        {b1v,0.0021,{0.00001,100}},
        {b2v,b2zero,{-20,20}}]
end

!
!    LinearSolve
   Clear[a,b];
   a=Table[Random[]+Random[]*I,{i,3},{j,3}];
   b=Table[Random[]+Random[]*I,{i, 2},{j,3}];
   a.Transpose[LinearSolve[a,b]]-Transpose[b]
end
   Timing[
     Apply[Plus,Abs[Flatten[a.Transpose[LinearSolve[a,b]]-Transpose[b]]]^2]]
   a=Table[Random[]+Random[]*I,{i,100},{j,100}];
   b=Table[Random[]+Random[]*I,{i, 3},{j,100}];
   Timing[Apply[Plus,Abs[Flatten[a.Transpose[LinearSolve[a,b]]-Transpose[b]]]^2]]
   Timing[LinearSolve[a,b];]
   a=Table[Random[],{i,100},{j,100}];
   b=Table[Random[]+Random[]*I,{i,3},{j,100}];
   Timing[Apply[Plus,Abs[Flatten[a.Transpose[LinearSolve[a,b]]-Transpose[b]]]^2]]
   Timing[LinearSolve[a,b];]
   a=Table[Random[],{i,100},{j,100}];
   b=Table[Random[],{i,  3},{j,100}];
   Timing[Apply[Plus,Abs[Flatten[a.Transpose[LinearSolve[a,b]]-Transpose[b]]]^2]]
   Timing[LinearSolve[a,b];]
end
!
!
!D
  f=p5*Sqrt[((Sin[p1]-Exp[-p2]*Sin[p1-p3-2*Pi*x])/(1-2*Exp[-p2]*Cos[p3+2*Pi*x]+
    Exp[-2*p2])+(Sin[p1]-Exp[-p2]*Sin[p1-p3+2*Pi*x])/(1-2*Exp[-p2]*Cos[p3-2*Pi*x]+Exp[-2*p2]))^2+
      ((Cos[p1]-Exp[-p2]*Cos[p1-p3+2*Pi*x])/(1-2*Exp[-p2]*Cos[p3-2*Pi*x]+Exp[-2*p2])-
        (Cos[p1]-Exp[-p2]*Cos[p1-p3-2*Pi*x])/(1-2*Exp[-p2]*Cos[p3+2*Pi*x]+Exp[-2*p2]))^2]+p4;
  Timing[D[f,p1]]
  Timing[D[f,p2]]
  Timing[D[f,p3]]
  Timing[D[f,p4]]
  Timing[D[f,p5]]
end
!
!
D
  $ReduceMath=True;
  Timing[D[fun[x],k]]
end
  Timing[D[fun[x],sigmax]]
  Timing[D$[funV[x],kv]]
  Timing[D[funV[x],kv]]
  Timing[D[funV[x],yof]]
  Timing[D[funV[x],sigmaxv]]
  Timing[D$[fun[x],k]]
  Timing[D[fun[x],bbb1]]
  Timing[D[fun[x],xof]]
  Timing[D[fun[x],bbb2]]
end
!
!
! NIntegrate
  NIntegrate[Sin[x],{x,0,Pi}]
  NIntegrate[Exp[-x^2/2]/Sqrt[2Pi],{x,-10,10}]
  NIntegrate[Exp[I phi],{phi,0,Pi/2}]
  NIntegrate[Log[x],{x,0.0001,1}]
  Timing[Do[NIntegrate[Sin[x],{x,0,Pi}],{10}]]
end
  Timing[Do[NIntegrate[Exp[I phi],{phi,0,Pi/2}],{5}]]
end
!
!
  x=Range[1,10];
  x=Vector[x];
  Plot[Sin[y],{y,0,Pi}]
  f[y_]:=With[{z=y},Sin[z]];
  f[x]
end
 !
 !  Module, generations
   a:=b;
   b:=a;
   a
end
   Clear[a,b,c,d,e,f,g,h];
   b:=d;
   Module[{b},b:a];
   Module[{b},a:b];
end
   g[a_]:=Module[{b},{a,b}/.c:b->a+1];
   h[a_]:=Module[{b},{a,b}/.c:b->c+1];
   SetAttributes[f,HoldAll];
   SetAttributes[g,HoldAll];
end
   f[b]
   {f[b],g[b],h[b],f[1]}
end
!
! Break in Table
   Table[If[i==3,Break[],1],{i,5}]
end
!
!
  Fact[n_]:=(Fact[n]=If[n>1,n*Fact[n-1],1]);
!Fact[n_]:=(Fact[n]=n*Fact[n-1]);
!Fact[1]=1;
!Fact[0]=1;
  Timing[Do[
    s=0;
    Do[s=Fact[i],{i,30}],
    {500}]]
  t0=TimeUsed[];
end

  Do[
    s=0;
    Do[s=Fact[i],{i,30}],
    {500}];
  TimeUsed[]-t0
  if:=If;
  fact[n_]:=if[n>1,n*fact[n-1],1];
!Fact[n_]:=n*Fact[n-1];
!Fact[1]=1;
!Fact[0]=1;
  Timing[Do[
    s=0;
    Do[s=fact[i],{i,30}],
    {500}]]
  t0=TimeUsed[];
end
!
! RExec
!
   RemoteExecute["acsad4","oide","4019054a","ls"]
end

!
!  Pattern Default
  Clear[a,b,c,d,e,f,x,y];
end  

 !
 !
  w=Window[];
  c=Canvas[w,Width->800,Height->600];
  $DisplayFunction=CanvasDrawer;
  Canvas$Widget=c;
  da=Thread[{GaussRandom[1000],Random[1000]}];
  HistoPlot[da,
    PlotStyle->FitPlot,
    PointSymbol->Bar,
    PointSize->5,
    FitParameters:>
      {a Exp[-x^2/2/sigma^2]+b,
        x,
        {a,10},{b,0.5},{sigma,0.5}}
    ];
  Update[];
end

  With[{f[x_]:={x}},{f[1],f[2]}]
end

  f[x___,y_:1,z___]:={{x},{y},{z}};
  f[1,2,3,4,5]
  f[1,2,3,4]
  f[1,2,3]
  f[1,2]
  f[1]
end
  a/.(f[x_:1]|y_):>x+y
  a/.(f[x__:1]|y_):>x+y
  f[x_:1]:={x};
  f[]
  f[]

end


!
!  FindRoot
  a:=FindRoot[(Print[x];Sin[x]+0.99)==0,{x,Pi,{-0.1,5}}];
  Sin[x]/.a
  a:=FindRoot[(Print[x];Sqrt[Abs[x-2]])==0,{x,0}];
  a
  a:=FindRoot[Sin[x]==ArcSin[x],{x,0.9},AccuracyGoal->1e-30];
  a
  {Sin[x],Cos[y],Sin[y]}/.
     FindRoot[{(Print[{x,y}];Sin[x])==Cos[y],Sin[y]==0.5},{x,0},{y,0}]
  a:=FindRoot[x^2+y^2+0.1==0,{x,0.9},{y,0.1}]
  a

!  ff[x_Real]:=(Print[x];x^2);

  ff[x_Real]:=(MOMENTUM=x*1e9;FFS["CALC"];
    (Emittances/.Emittance[])[[1]]);
  FindRoot[ff[z]==1e-8,{z,1,{0.1,10}}]
end


       fun[x_]:=I*bbb1*Sqrt[2*Pi/sigmax^2*(1-k^2)]*Exp[-(x-xof)^2/2/sigmax^2*(1-k^2)] * 
            (-Erf[-I*(x-xof)/Sqrt[2*sigmax^2*(1-k^2)]]+Erf[-I*k*(x-xof)/Sqrt[2*sigmax^2*(1-k^2)]]) + bbb2;
!       fun[x_Real]:=k*x;

    datafile={{-4,1.9},{-3,1.8},{-2,1.5},{-1,1},{0,0},{1,-1},{2,-1.5},{3,-1.8},{4,-1.9}};
  xzero=0;
  b2zero=0.1;
       fit=FitPlot[datafile,Evaluate[fun[x]],x,
        {k,0.02,{0.0001,0.5}},
        {xof,xzero,{-100,100}},
        {sigmax,1,{5,80}},
        {bbb1,1,{-100,100}},
        {bbb2,b2zero,{-1000,2000}},D->False];

   kvinitial=1;
   yzero=0;
        funV[yInd_]:=b1v/sigmaxv*Sqrt[Pi/(1-kv^2)]*Exp[-(yInd-yof)^2/4/sigmaxv^2/(1-kv^2)] * 
            (Erf[(yInd-yof)/kv/2/sigmaxv/Sqrt[1-kv^2]]-Erf[(yInd-yof)/2/sigmaxv/Sqrt[1-kv^2]]) + b2v;
      fitv=FitPlot[datafile,Evaluate[funV[yInd]],yInd,
        {kv,kvinitial,{0.01,0.999}},
        {yof,yzero,{-500,500}},
        {sigmaxv,150,{10,500}},
        {b1v,0.0021,{0.00001,100}},
        {b2v,b2zero,{-20,20}},D->False]
end



!
 f[x_]:=(x^2-4x+3);
 d=Range[10];
 d=Thread[{d,f[d]+GaussRandom[Length[d]]*3}];
 s=PolynomialFit[d,2];
 g1=ListPlot[d,DisplayFunction->Identity];
 g2=Plot[s[[1]].{1,x,x^2},{x,1,10},DisplayFunction->Identity];
 Show[g1,g2];
end

 While[True,
   Print["a"];
   a=0;
   Thread[a]];

end
!
!    RADLIGHT
  MOMENTUM=1e9;
  scale=1e-15;
  tw=1e-16;
  B ANGLE 0
  B K0 0.1
!  MOMENTUM=3e9;
!  MOMENTUM=1e10;
!  scale=1e-18;
!  tw=1e-19;
  FindPeak[l_]:=Position[Abs[l],Max[Abs[l]]][1,1];
  RADLIGHT
  np=1;
  x=Table[0,{7},{np}];
  Do[x[7,i]=1,{i,np}];
!  x[1,1]=0.001;x[3,1]=0.001;
  d={1,x};
  r=TrackParticles[d,10][2,1];
!  f=RadiationField[r,{20,0.1,0}];
  f=RadiationField[r,{7.9918,0.249792,0}];
  p=FindPeak[-f[3]];
  f[1]=f[1]-f[1,p];
  trange={f[1,p]-tw,f[1,p]+tw}/scale;
  ListPlot[Transpose[{f[1]/scale,f[8]}],
    PlotJoined->True,PlotRange->{trange,Automatic}];
end
!  ListPlot[Transpose[{f[1]/scale,f[4]}],
!    PlotJoined->True,PlotRange->{trange,Automatic}];
!  ListPlot[Transpose[{f[1]/scale,f[2]}],
!    PlotJoined->True,PlotRange->{trange,Automatic}];
  s=RadiationSpectrum[{f[1],f[3]},{0.001,1,0.001}*3e-7];
!  ListPlot[Transpose[{s[1],s[2]/scale}],PlotJoined->True]
!  ListPlot[Transpose[{s[1],s[3]/scale}],PlotJoined->True]
!  ListPlot[Transpose[{s[1],(s[2]^2+s[3]^2)/scale^2}],PlotJoined->True]
  ListPlot[Transpose[{s[1],(s[2]^2+s[3]^2)/scale^2}],PlotJoined->True,
    Scale->Log]
end
!
!
!
e0=Emittance[];
sige0=SIGE;
intra;
e=Emittance[Matrix->True];
ee=IntrabeamExcitation/.e;
Plus@@(ee[[,6,6]])/(-(DampingRate/.e)[[3]]*2)/2
SIGE^2-sige0^2

end
 
!
 a={1};
 Timing[Do[a=Join[AppendTo[a,{1,"a"}],{2,"b"}],{10000}]]
 MemoryCheck[]
 Timing[Do[a=Join[AppendTo[a,{1,"a"}],{2,"b"}],{10000}]]
 MemoryCheck[]
end

!
!  Module
!
  Clear[f,g];
  a=1;
  f[]:=Module[{},a+1];
  g[]:=a+1;
  Timing[Do[f[],{1000000}]]
  Timing[Do[g[],{1000000}]]
end

  Clear[f];
  f[x_]:=Module[{x},Print[x]];
  1;
end

  ff[x_]:=Module[{xx},x];Print["OK"]
  fff[x_]:=Module[{},x];
end
!
! $FORM
!
$FORM="7.0";
Print["!",0,"!"];
x=1e-6;
Do[Print["!",x*=10,"!"],{15}];
x=-1e-6;
Do[Print["!",x*=10,"!"],{15}];
x=1.55e-6;
Do[Print["!",x*=10,"!"],{15}];
x=-1.5e-6;
Do[Print["!",x*=10,"!"],{15}];


end

  f=OpenRead["/vdata1/Collision/LumHist/ThisMonth/Lum2001_3_31_13_50_24.dat"];
  While[s=Read[f];s<=>EndOfFile,
    Print[s];];
end


  OpenRead["!ls eee"]
end
!
OpenRead["!rsh acsad2 -l operatio \" rsh abco1 ps -ef|grep mgcenter\""]
end
!
! Read, ToExpression
  l=OpenRead["/users/oide/WORK/oldsad/sad/readtestdata"];
  Read[l,3*Byte]
  Read[l,{Byte*3}]
  Read[l,BinaryInteger]
  Read[l,BinaryReal]
  Read[l,String,ReadNewRecord->True]
  Read[l,{Word,Word,Word,Word}]
  Read[l,{Real,Real,Real,Real,Real,Real},ReadNewRecord->False]
  Read[l,String]
  Read[l,{Real,Real,Real,Real},ReadNewRecord->False]
  Read[l,String]
  Read[l,{Real,Real,String}]
  Read[l,String]
  Read[l]
  Read[l,Character]
  Read[l,String]
  Read[l,Table[Word,{8}]]
  Skip[l,Word,2]
  Read[l,Word,WordSeparators->"!"]//Read[l,Character]
end
  While[s=Read[l,Word,NullWords->True];
    Print[ToString[s,FormatType->InputForm]];s<>"this.",];
  MemoryCheck[]
end

  d=OpenRead["!ls -txl /users/oide/WORK/oldsad"];
  l={};
  While[w=Read[d,Word];w<=>EndOfFile,
    l={l,w}];
  w
end
!
!


  f=OpenRead["/ldata/KEKB/KCG/LER/Optics/Archive/15APR00A.gz"];
  Read[f]
  Get["/ldata/KEKB/KCG/LER/Optics/Archive/15APR00A.gz"]
end
 !
 !
  D[Exp[a x]*Cos[b x],x]
  ReduceExpression[Derivative[1][f][x]]
  g[x_]:=If[x>0,x^2,x^3,x^4];
  D[g[x],x]

end
!
!    Complex number
   I
   1+I
   a=1+I
   b=1-I
   Print[a+b, a-b, a*b, a/b, a^b, -a];
   Timing[Do[a+b;a-b;a*b;a/b;a^b;-a,{10000}]]
   a-Conjugate[Complex[Re[a],-Im[a]]]
!
!   ComplexQ
   ComplexQ[I]
   ComplexQ[{1,I}]
   ComplexQ[{1,{1,I}}]
   ComplexQ[{1,0}]
end

 !
 ! DownhillSimplex (1D)

  f[{x_}]:=(Print[x];x^2+GaussRandom[]-100);
  p0={{f[{10}],{10}},{f[{20}],{20}}};
  p=DownhillSimplex[p0,f,VariableRange->{{1},{30}},
    MinimumSize->{0.1},
    Persistence->0.5];

end
!
!    Return, Break, Continue, Goto, Label
  While[True,
    Sleep[1];
    Print["a"];
    Continue[];
    Print["b"]];
end
  Clear[f,x,a]
  f[x_]:=(If[x>5,Return[big]];x^2);
  Print[f[3],f[10]];
  f[x_]:=If[x==0,Return[],Return[1],Return["a"]];
  f[0] f[1] f["x"]
  Return[5]
  Do[a=i;If[i==10,Return["OK"]],{i,100}]
  Do[a=i;If[i==10,Break[]],{i,100}];Print[a];
  Do[If[i==5,a=i;Continue[]];Print[i],{i,10}];Print[a];
  While[1==1,Break[]]
  (a=1;While[True,If[a>5,Goto[1]];a=a+1];Label[1];Print[a]);
end
 

  Timing[Do[a={};Do[a=Append[a,i],{i,1000}],{100}]]
  Timing[Do[a={};Do[a=Append[a,"a"],{i,1000}],{100}]]
end
  
!
   fn=OpenWrite["sadmath.m"];
   Write[fn,"Print[N[BesselJ[0,1]]];Quit;"];
   Close[fn];
   System["csh -c '/usr/local/bin/math < sadmath.m >! mathsad.m -nonint -batchoutput'"];
   fn=OpenRead["mathsad.m"];
   x=Read[fn]
   Close[fn];
end   
!
!    Depth,Level
  Depth[{{"1",{"2"}},{{"3"},4,{"5"}}}]
  a={1,2,{3,{4,5}}}
  Depth[a]
  Depth[a]
  Depth[ReplacePart[a,{6,7},{3,2,1}]]
  a[[3,2,1]]={6,7};
  Depth[a]
  Level[a,0]
  Level[a,1]
  Level[a,-1]
  Level[a,{-2}]
  Level[a,-2]
  Level[a,{1,2}]
  Level[a,{2,1}]
  Level[a,{1,-2}]
  Level[a,{-2,1}]
  Level[a,{-3,-1}]
  Level[a,{-1,-3}]
  Level[a,{-10,1}]
end
!
! NaN, INF

NaN
INF
Min[]
NaN*0
INF*0
end
!
!
  {in,out}=BidirectionalPipe["/bin/sh"];
  Write[out,"exec /bin/tcsh -f -c 'ls -tx /ldata'"];
  Close[out];
  ReadString[in]
  ReadString[in]
  ReadString[in]
end


 Get["../sad/abort.sad"];
 !
  f[x___]:=(Abort[x];1)
  f[]
  f[-1]
  f[-2]
  f[-3]
end
!
  Plot[{Sin[x],Cos[x]},{x,-Pi,Pi}];
end
 !
 !
   Clear[a,b,c];
   a=Range[5];
   With[{f=Null},
     a=ReplacePart[a,Unevaluated[f[1,2,3]],{3}]]
   ?a
end
 !
 !
   Clear[a,b,c,d,f,x];
   f[a_,b_]:=Module[{a},Print[a];
     g[a_,b_]:=(Print[{a,b}];Module[{a},Print[{a,b}]]);
     g[a,b]];
   f[x,x]
   ?g
end
!
!
  f[1]=aa;
  f[1][1]=bb;
  f[2]=cc;
  Clear[f[1]];
  ?f
end
!
!
  Do[Pause[1e-6],{1000}];

end


!
!
f[x_:0]:=Print[x];
f[x:(_:0)]:=Print[x];
f[]


end

!
!
  Override[{"ab"->1,"ab"->2,Plus->1},a]
  Override[{"a"->1,"a"->2}]
  Override[5,4,3,2,4,1]

end
!
!   Sort,Union,Order,Intersection,Complement
  Clear[a,A,b,c,d,e];
  Sort[{1,2,3,4,5}]
end
  Sort[{_,__,_Sin,_sin,a_,aaa_,a:"a"}]
  Union1[{{a},{1},{1},{a}}]
  Sort[{{a},{1},{1},{a}}]
  Intersection[{c,a,b,a},{a,b,b,c},{d,e,a,b}]
  Complement[{c,a,b,a},{d,e},{c,d,e}]
  Sort[{a,a,b}]
  Sort[{"a",a,A,1,-1,100,Sin,Plus,b[1,2,3,4,5],"abc",{{1,2}},{1},{1,2,3,4,5}}]
  MemoryCheck[]
  Sort[{2,4,7},Greater]
  Union[{1,2,3},{2,3,-1},{a,A,"a"}]
  Order["a","A"]
  Do[n=2^i;a=Table[Random[],{n}];Print[n," ",Timing[Sort[a];]],{i,9,14}]
end
!
!
 $FORM="10.8";
 Print[-0.1234567890]
 Print[-0.0123456789]
 Print[-0.0012345678]
 Print[-0.0001234567]
 Print[ 0.1234567890]
 Print[ 0.0123456789]
 Print[ 0.0012345678]
 Print[ 0.0001234567]

end

 f[]:=(
   a=Module[{},]
   b);
  Get["/users/oide/WORK/oldsad/sad/test.n"];
  Print["?"];
end

  f:=Module[{a,b,c},TracePrint[{a,b,c}]];
  ?f
end

  MapThread[f,{{1,2,3},{4,5,6},{7,8,9}}]
end

!
!
   f[x1_,x2_,x3_]:=x1+x2+x3
   Partition[f@@Range[100],3]
end
!
!
   FromDateString["11/5/1999 10:10:1.2"]
end
!
!
   Fit[{{ {1,2},3},{ {2,1}, 2}, { {1,1}, 0}},
     a x + b y + c, {x,y}, {a,0}, {b,0}, {c,0}]
   Fit[{{ {1,2},3,4},{ {2,1}, 2,2}, { {1,1}, 0,1}},
     a x + b y + c, {x,y}, {a,0}, {b,0}, {c,0}]
end
!
!
  l=Table[i*10+j,{i,5},{j,2}];
  MapAt[If[#==11,11,Null[]]&,l,{,1}]
  l=Range[10];
  m=Range[4,-5,-1];
  MapThread[If[#>#2,1,Null[]]&,{l,m}]
end

 !
 !
  a;aa
  $Line=0;MemoryCheck[1]
  a=Table[{"a","b"},{200}]/."b"->"c";
  a=Table[{"a","b"},{200}]/."b"->"c";
  a=.  
  $Line=0;MemoryCheck[1]
  a=Table[{"a","b"},{200}]/."b"->"c";
  a=Table[{"a","b"},{200}]/."b"->"c";
  a=.  
  $Line=0;MemoryCheck[1]
end

 !
 !  Canvas
    f=KBMainFrame["aaa",w];
    c=Canvas[w,Width->600,Height->400];
    $DisplayFunction=CanvasDrawer;
    Canvas$Widget=c;
    OpticsPlot[{{ {{{11,2},{23,5}},Plot->False,PlotJoined->True},
      {{{11,1},{24,6}}}},{"BX"}},
      PlotRegion->{{0,1},{0,1.2}},
!      FrameHeight->{0.4,0.8},
      InfoLabel->True];
!    OpticsPlot[{{ {{{11,2},{23,5}},Plot->False,PlotJoined->True},
!      {{{11,1},{24,6}}}}},
!      InfoLabel->True,Initialize->Frame];
  TkWait[]
end
!
!  Spline
   sp=Spline[{{1,2},{3,5},{4,2},{5,7}}];
   Plot[{sp[x],Derivative[1][sp][x],Derivative[2][sp][x],
     Integrate[sp[y],{y,1,#}]&[x]},{x,1,5}]
end
!
!
  C=Class[{},{},{a=1,b},];
  f[]:={c@a};
  c=C[];
  g[]:={c@a};

  ?f
  ?g
  f[];
  g[];
  ?f
  ?g

end

  Timing[Do[f[],{1000000}]]
  Timing[Do[g[],{1000000}]]
end
!
!
  Timing[
    Do[
      f=OpenRead["../sad/examples.sad"];
      While[s=ReadString[f];s<=>EndOfFile,];
      Close[f],{20}]
    ]
end

!
!
  LINE["NAME","L1*"]
  LINE["NAME","L1.*"]
  LINE["POSITION","L1.*"]
end
!
!  MemberQ
   a=Table[i*100+j,{i,0,99},{j,0,99}];
   MemberQ[a,b[c],{0,Infinity}]
   Timing[Do[MemberQ[a,b[c],{0,Infinity}],{1000}]]
end

   Timing[Do[MemberQ[a,4901,{0,Infinity}],{1000}]]
end

!
!  D, ReduceExpression
  Clear[f,x,a,b,c];
  e=1+x-x+(3+x+3*x)
  e=e/.ReductionRule
  e=e/.ReductionRule
  e=e/.ReductionRule
  Print[ReduceExpression[1+x-x+(3+x+3*x)]]

  Print[a=ReduceExpression[1+x*(1/x)-x+(3+x+3*x)]];

  Print[D[Sin[3 x],x]];
  Print[D[Sin[x]Cos[x],x]];
  Print[D[x^3 Sin[x],x]];
  Print[D[Sin[y],x]];
  Print[D[Sin[Cos[x]],x]];
  Print[D[{Sin[x]/Cos[x],Cos[x]/Sin[x]},x]];
  Print[D[x y,x]];
  Print[D[Sqrt[x^2],x]];
  Print[D[f[x,x^2],x]];
  Print[D[D[f[x,x^2],x],x]];
  D[aa x^3 Sin[x],x]

  Timing[Do[D[x^3 Sin[x],x],{1000}]]
  MemoryCheck[1]
end
!
!  GaussianCoulomb
  Plot[Re[GaussianCoulomb[x,0,1,1]],{x,-10,10}]
end
!  Plot[{Re[GaussianCoulomb[x,0,1e-4,1e-6]],
!    Im[GaussianCoulomb[0,x/100,1e-4,1e-6]]},{x,-1e-3,1e-3}];

  data=GaussianCoulomb[0,#,1e-4,1e-6]&/@(Range[-10,10]*1e-6)+
    1000*I*GaussRandom[21];
  data=Thread[{Range[-10,10]*1e-6,Im[data]}];
  FitPlot[data,Im[GaussianCoulomb[0,x+dx,sigx,sigy]],x,
    {sigx,1e-4,{0,2e-4}},{sigy,1e-6,{0,2e-6}},
    {dx,0,{-1e-5,1e-5}}];

end

!
!   BeamLine
   Clear[a,b,c,d,e];
   a=BeamLine[b,c,d];
   c=BeamLine[d,e];
   a
   3*a
   a*3
   BeamLine[b,2*a,3*b]
   BeamLine[b,-2*a,-3*b]
   -BeamLine[b,-2*a,-3*b]

   bs=Table[Symbol["bl"//i],{i,1000}];
   b=BeamLine@@bs;
   Timing[Do[b1=b,{1000}]]
   Timing[Do[b1s=bs,{1000}]]
end


   disp end
   BeamLineName[]
   USE BeamLine[IP1,QF,QD]
   BeamLineName[]
   VISIT TESTLINE
   BeamLineName[]
   USE CELL
   BeamLineName[]
   BYE
   BeamLineName[]
   cal
   disp
   ExtractBeamLine[]
   b=ExtractBeamLine[CELL]
   a=Join[ExtractBeamLine[],-ExtractBeamLine[]]

   PrintBeamLine[a]
   PrintBeamLine[a,Format->"MAIN"]
   PrintBeamLine[a,b,Format->"MAIN",Name->{"A","B"}]
   USE TESTLINE; cal;
end
!
! SetPart
  a=b=Table[1,{10},{10}];
  Print[MemoryCheck[]];
  Do[a[j,i]=-1;a[i,j]=0,{i,10},{j,10}];
  Print[MemoryCheck[]];
  a
  b
end

  Clear[a,b,c,d,e,f,g];
  a=Table[i*10+j,{i,3},{j,4}];
  b=a;
  Scan[(#[[1]]=1)&,b];
end
!
!
  Do[
    With[{i},
      (f[i]+1)^:=Print[i]],{i,1024}];
  Print[?f];
  Do[f[i]+1,{i,1024}];
  Print[?f];
end
!
!
  f[1][x_]=1;
  (1+g[1][y_])^:=Print[y];
  ?f
  ?g
  1+g[1][2];
  f[1][2]
end
!
!
  f[x__,y_,x__]:=Print[{x,y}];
  f[1,2,1];
  f[x_,y_,2,x_,y_];
end
!
!
  FromDate[{1999,7,12,13,12,0}]-FromDate[{1990,1,1,0,0,0}]
end

!
!
  l={{1,2,"ANGLE",Undefined,4},{1,2,3,4,5},{1,2,"ANGLE",3,4}};
  {l,l1}=SwitchCases[l,{{__,_Real,_},{__,"ANGLE",_,_}}]
end

!
!
  {{"QF1"}}=0.1
  Element["K1",{"QF1"}]
  Element["K1","QF1"]=0.1
  Element["K1",{"QF1"}]=0.11
end
!
! Part
  Clear[a,b,c,d,e];
  a=Table[i*100+j,{i,100},{j,100}];
  a[[{2,3},{4,5}]]
  a[[{2,3},{4,5}]]=0
  a[[{2,3},{4,5}]]
end

  {{{1,2,3},{4,5,6}},{{7,8,9},{10,11,12}}}[[{1,2},2,3]]
  a[[,2]]
  Timing[Do[a[[,2]],{10000}]]
  Timing[Do[Thread[a][[2]],{10000}]]
end

ToExpression["1.23.45"]

end

! 
!
  rho=120;
  theta=0.003;
  gamma=3.5e9/MASS;
  lambdae=3.8e-13;
  uc=1.5*gamma^2/rho*lambdae;
  np=gamma/100*theta;
  p=uc*np*8/15/Sqrt[3]*3.5e9

end

!
!
   ProductLog[Range[100]]
end
   Plot[{Re[ProductLog[x]],Im[ProductLog[x]]},{x,-10,10}];
end
!
!
  a=1;
  Switch[a,
    1,Null[],
    2,Null[3,4]]
end
!
! StringReplace
  StringReplace["8.0p2","p"->"."]
  StringReplace["abcdefg","cd"->"xxx"]
  StringReplace["abcdecd","cd"->"xxx"]
  StringReplace["abcdecd",{"cd"->"xxx","bc"->"yyy"}]
end

!
!  StringInsert
   StringInsert["abcde","\n",{2,3,4,5}]
   Timing[Do[StringInsert["abcde","\n",{2,3,4,5}],{10000}]]
end
!
!   Fourier, InverseFourier
   Clear[a,b,c];
   a={-1.,-1.,-1.,-1.,1.,1.,1.,1.};
   Fourier[a]
   InverseFourier[Fourier[a]]-a
   a={-1.,-1.,-1.,-1.,1.,1.,1.,1.,1.};
   Fourier[a]
   InverseFourier[Fourier[a]]-a
   a={-1.,-1.,-1.,-1.,-1.,1.,1.,1.,1.,1.};
   Fourier[a]
   InverseFourier[Fourier[a]]-a

   FourierTest:=(
     a=Table[i*1.,{i,2048}];
     Print[Timing[Do[Fourier[a],{1000}]]];
     c=Table[Complex[i*1.,i*1.],{i,2048}];
     Print[Timing[Do[Fourier[c],{1000}]]];
     a=Table[i*1.,{i,2304}];
     Print[Timing[Do[Fourier[a],{1000}]]];
     c=Table[Complex[i*1.,i*1.],{i,2304}];
     Print[Timing[Do[Fourier[c],{1000}]]];
     a=Table[i*1.,{i,1920}];
     Print[Timing[Do[Fourier[a],{1000}]]];
     c=Table[Complex[i*1.,i*1.],{i,1920}];
     Print[Timing[Do[Fourier[c],{1000}]]];
     a=Table[i*1.,{i,2^14}];
     Print[Timing[Do[Fourier[a],{100}]]];
     c=Table[Complex[i*1.,i*1.],{i,2^14}];
     Print[Timing[Do[Fourier[c],{100}]]];
     a=Table[i*1.,{i,5^6}];
     Print[Timing[Do[Fourier[a],{100}]]];
     c=Table[Complex[i*1.,i*1.],{i,5^6}];
     Print[Timing[Do[Fourier[c],{100}]]];
     a=Table[i*1.,{i,2^16}];
     Print[Timing[Do[Fourier[a],{100}]]];
     c=Table[Complex[i*1.,i*1.],{i,2^16}];
     Print[Timing[Do[Fourier[c],{100}]]];
     a=Table[i*1.,{i,3^10}];
     Print[Timing[Do[Fourier[a],{100}]]];
     c=Table[Complex[i*1.,i*1.],{i,3^10}];
     Print[Timing[Do[Fourier[c],{100}]]]);
   Do[FourierTest,{1}];
end
!
!   TransferMatrix,NormalCoordinates
!  Twiss['*','***']
  m=TransferMatrix[1,"$$$"]
end

  m.SymplecticJ[4].Transpose[m]
  r=NormalCoordinates['*]
  r[1].SymplecticJ[6].Transpose[r[1]]
end
!
!
  f[1]=2;f[3]=3;f[_]=0;
  Take[First[Hold@@[Definition[f],{1}]],{2,-2}]
end
!
!
   g[x_]:=(Take[1]);
   f[x_]:=Catch[Do[Check[Throw[x],4],{1}]];
   SetAttributes[f,HoldAll];
  f[g[1]]
end
!
!
  fit qf qf1 nx .25 
  free qf1 go
  end

!
!
! Fit
  w=Window[];
  ca=Canvas[w,Width->600,Height->400];
  $DisplayFunction=CanvasDrawer;
  Canvas$Widget=ca;
  Clear[a,b,c,d,f,g,x];
  xa=Range[-2*Pi,2*Pi,0.4];
  ya=Sin[xa]+0.3*Table[GaussRandom[],{Length[xa]}];
  dya=Table[0.3,{Length[xa]}];
  data=Thread[{xa,ya,dya}];
  fun=(a+b Sin[c x+d]);
  pl=  FitPlot[data,Evaluate[fun],x,{a,1},{b,3,{-5,5}},
  {c,1,{0,5}},{d,0,{-2Pi/3,2Pi/3}}]
  Update[]
end

pl=  FitPlot[data,Evaluate[fun],x,{a,1},{b,3},{c,1.5},{d,0}]
pl=  FitPlot[data,Evaluate[fun],x,{a,1},{b,3},{c,3},{d,Pi}]
pl=  FitPlot[data,Evaluate[fun],x,{a,1},{b,0.5},{c,0.5},{d,Pi}]
end
!
!
  f[Close]:=(f[1];Clear[f];);
  f[End]:=(f[1];f[Close];);
  f[1]=2;
  ?f
  f[End];
  ?f
end

!
!
  a={1,2,3,4,5};
  b={2,3,4,5,6};
  a.b
end
 !
 !  Canvas
    f=KBMainFrame["aaa",w];
    c=Canvas[w,Width->600,Height->400];
    $DisplayFunction=CanvasDrawer;
    Canvas$Widget=c;
    OpticsPlot[{{ {{{11,2},{23,5}},Plot->False,PlotJoined->True},
      {{{11,1},{24,6}}}}},
      InfoLabel->True];
    OpticsPlot[{{ {{{11,2},{23,5}},Plot->False,PlotJoined->True},
      {{{11,1},{24,6}}}}},
      InfoLabel->True,Initialize->Frame];
  TkWait[]
end
!
!
  PageWidth=79;
  f=OpenWrite["/users/oide/WORK/oldsad/sad/aaa"];
  Write[f,{StringFill["a","b",1023]}];
  Close[f];
  Print[Get["/users/oide/WORK/oldsad/sad/aaa"]];
end
!
!
  m1=1e-14;
  lf=Append[Log[10,{1,2,3,4,5,6,7,8,9}],1]
  MatchQ[#,_?((Print[{#,m1}];#+1e-10>=m1)&)]&/@lf
  SwitchCases[lf,{_?((Print[{#,m1}];#+1e-10>=m1)&)}]
  Position[lf,x_?((Print[{#,m1}];#+1e-10>=m1)&),1,1]
  Position[lf,_?((Print[{#,m1}];#+1e-10>=m1)&),1,1]
  Position[lf,_?((Print[{#,m1}];#+1e-10>=m1)&),{1},1]
end
!
!
  f[x_]:=Hold[{First[x],x[[1]]}];
  f[{1,2,3}]
end

end
!
!
   g1=ListPlot[{{1,2},{3,5}},FrameLabel->{"","","a"},DisplayFunction->Identity];
   g2=ListPlot[{{2,1},{4,2}},FrameLabel->{"","","b"},DisplayFunction->Identity];

   Show[{Graphics[Rectangle[{0,0},{1,0.5},g1]],
     Graphics[Rectangle[{0,0.5},{1,1},g2]]}];
end
!
!   IdentityMatrix, Eigensystem
!  IdentityMatrix[3]
   Eigensystem[{{0,1},{-1,0}}]
   a=Table[Random[]+Random[]*I,{10},{10}];
   e=Eigensystem[a];
   Apply[Plus,Abs[Flatten[a.Transpose[e[2]]-Transpose[e[2]].DiagonalMatrix[e[1]]]]^2]
   a=Table[i+j,{i,4},{j,4}];
   Eigensystem[a]   
   a=Table[Random[],{i,100},{j,100}];
   Timing[Eigensystem[a];]
end
!
!
  w=Window[];
  c=Canvas[w,Width->600,Height->400];
  $DisplayFunction=CanvasDrawer;
  Canvas$Widget=c;
  ListPlot[{{1,2},{2,4},{3,0},{4,4}},
    PlotRange->{{0,5},{0.5,3}},PlotJoined->True];
  Update[]
end
!
! IOT
  f=OpenWrite["/users/koiso/LER980910"];
  Write[f,"aaa"];
  Close[f];
end
 !
 !
Union[{{1,2},{1,3},{2,1}}]
Union[{{1,2},{1,3},{2,1}},SameTest->(Order[#1[[1]],#2[[1]]]&)]
end   
!
!
   fit dx 0.005 dpx 0;
   free b.{23} k0 b1 k0
   go
end

!
!  BaseForm
  BaseForm[10000,36]

end
!
!
  Dimensions[{{1},{{2}}}]
end
!
!   Cases, DeleteCases, Scan, Position, Count, MemberQ
  Clear[a,b,c,d,e,f,g];
  a={1,2,3,{4,5},{6,{7,8}}};
  Position[a,x_]
  Position[a,x_,Heads->False]
  Position[a,x_,1,2]
  MemberQ[a,x_]
  Position[a,{4,x_}]
  Position[a,{x__,5}]
  Position[a,{4,5,x_}]
  Position[a,{4,5,x__}]
  Position[a,{4,5,x___}]
  Count[a,x_,1]
  a={1,2,1,2,3};
  Position[a,{x__,y__}]
  Position[a,{x__,x__}]
  Position[a,{x__,x__,3}]
  a=Range[1000];
  Timing[Do[Position[a,999],{100}]]
  Clear[a,b,c,x];
  Cases[{1,x,2},_Real]
  Cases[{1,x,2},_Real->10]
  Module[{c},Cases[{1,a->b,3},(p:(a->c_))->c]]
  DeleteCases[{1,2,3,4,5},6]
  DeleteCases[{1,2,3,4,5},2]
  DeleteCases[{1,a,2,b},_Real]
  DeleteCases[{1,f[2,3],4},f,{2},Heads->True]
  DeleteCases[f[1,2,3,g[2,3]],2]
  DeleteCases[f[1,2,3,g[2,3]],2,Infinity]
  Scan[Print,1+x^2,Infinity];
end
!
!
Level[#,1];
Level[Null,1];
end
!
!
ReleaseHold[Hold[MessageString[(General::wrongtype),"List or composition for #1"]]]
end
!
!
   $FORM="F5.3";
   x=3;
   StandardForm[x//""]
   end
!
!
  OpticsProlog:=Message[999,FFS::interrupt]
   fit nx 3.1 free q* go
end

!
!
 Clear[f];
  f[(x_String:Null)|(x:Null)]:=Print[x];
  f[Null];
  f["a"];
  f[1];
end
!
!   Flatten, Take, Drop, Select
  Clear[ff,g,a];
  a={};Do[a={a,i},{i,10000}];
  a={a,a};
   Length[b=Flatten[a,10000]]
  DeleteCases[b,_Real,1]
  a={1,2,{3,{4,5}}};
  Flatten[a]
  Flatten[a,1]
  Flatten[a,2]
  Print[Flatten[ ff[1,2,{3,4},ff[5,6],g[7,ff[8,9]]]]];
   Print[Take[{1,2,3,4},2]];
   Print[Take[{1,2,3,4},-2]];
   Print[Take[{1,2,3,4},{2,3}]];
   Print[Drop[{1,2,3,4},2]];
   Print[Drop[{1,2,3,4},-2]];
   Print[Drop[{1,2,3,4},{2,3}]];
   Print[Select[{{1,1},{2,-3},{4,5,6}},#[2]<0&]];
end
!
!
  Clear[a,b,c,d,e,f];
  Print[MemoryCheck[]];
  a=Append[{"aa","bb","cc"},"dd"];
  f[x_]:=Module[{b=x[[3]]},x[[1]]="11";b];
  SetAttributes[f,HoldAll];
  Print[{a[[1]],a[[2]],f[a]}];
  Clear[a,b,c,d,e,f];
  Print[MemoryCheck[]];

end
!
!
  a=Range[10000];
  Timing[Do[a[[i]]=i,{i,10000}]]
  Timing[Do[a[[i]]=i+1,{i,10000}]]

  a=ToString/@{1,2,3};
  a={a,a,a}
  Module[{},{a,a[[1]],a[[1,1]]="a",a}]
  MemoryCheck[]
end
!
!
    Timing[Do[Do[i,{i,1000}],{1000}]]
    Timing[Do[Block[{i},Scan[(i=#;i)&,Range[1000]]],{1000}]]
    Timing[Do[Scan[(i)&,Range[1000]],{1000}]]
end
!
!
  a="aaa";
  f[x_]:=(a="bbb";Null[x;Print[a],a=#])&[a];
  SetAttributes[f,HoldAll];
  f[a="eee";f[a="ccc"]]
  a
  MemoryCheck[]


end

!
!
  f[x__:1]:={x};
  f[1,2]
end

!
!
  Clear[a,b,c,d,e,f];
  f[x_]:=Hold[x*2];
  SetAttributes[f,HoldAll];
  (f[#]=2)&/@{1,2,3};
  ?f
  ((#=x_)^:=1)&[aa];
  ?aa

end
!
!
  a=Range[-10,10];
  b=Table[1,{21}];
  BitwiseAnd[a,b]
  BitwiseOr[a,b]
  BitwiseXor[a,b]
  Mod[a,b]
end
!
!
    a={1,2,3+I};
    Timing[Do[a.{2,3,4+I},{100000}]]
end
!
!
table = KEKBDatabase["BT.MAGNET"]
end

!
!
  Date[]
end
!
!
  Do[b[i]=i;b[i,x_]=i,{i,1000}];
  Do[If[b[i]<>i,Return[i]],{i,1000}]
  Do[If[b[i,1]<>i,Return[i]],{i,1000}]
  Do[If[b[i]<>i,Return[i]],{i,1000,1,-1}]
  Do[If[b[i,1]<>i,Return[i]],{i,1000}]
end
!
!   ToDate
  Do[If[ToDate[FromDate[{y,m,1,0,0,0}]]<=>{y,m,1,0,0,0},
    Print[{y,m,1,0,0,0}];Throw[]],{y,1,3000},{m,1,12}];
end
!
!
   Clear[f,g];
   f[x_]:=With[{y=3},x*y];
   f[1]
end
!
System["rsh abco1 source /cont/etc/cshrc.operator';'\
setenv PYTHONPATH "//Environment["PYTHONPATH"]//
"';'python -c \"'\"'from orsad import *;print 1;printor(\""//"BT.MAGNET"//"\")'\"'\""]
end

!
!
   aaa`[b]
   aaa`[aaa`b]
end
!
! Override
   Override[a,a->1,b->2,,b,]
end
!
!  Context
  aaa`c="a"
  bbb`c="b";
  c="x";
  aaa`[c]
  aaa`@c
  aaa`[c,c->c]
  aaa`[c[c],c->c]
  aaa`[c[bbb`[c],c],c->c]
  ToContext["aaa",c]
  ToContext[aaa,c]
  ToContext[aaa`,c]
  ToContext[aaa,]
  ToContext[,aaa`c]

end
!
!
!  Acceleration

  beam={1,Append[1e-3*IdentityMatrix[6],Table[1,{6}]]};
  AccelerateParticles[beam,1e9+n*1e7,{n,100},
    Synchronize:>(Print[{#,#2[[2,{5,6},1]]}]&)]

end
         

!
!
   TclEval["set a 1"]
end
!
! Pattern
  Clear[a,b,c,d,e,f];
  f[a:b__]:=Print[{a,b}];
  f[1,2]
  Clear[f]
  f[b__?((Print[##];True)&)]:=Print[{a,b}];
  f[1,2]
  Clear[f]
  f[b___?((Print[##];True)&),a_,c_]:=Print[{a,b,c}];
  f[1,2]
end
!
!
  Clear[a,b,c,d,e];
  Len=1;
  Unprotect[Len];
  Len=1;
end

!
!
   Clear[a,b,c,d,e,f,g];
   $Line=0;
   Print[MemoryCheck[]];
   Do[f[x_]:=x,{100}];
   Clear[f];
   Print[MemoryCheck[]];
end
!
! OrderLess
  MatchQ[{a*b*c},{aa___*x_}]
  MatchQ[{a*b*c,b*d},{aa__*x_,bb_*x_}]
  {a*b*c,b*d}/.{aa__*x_,bb_*x_}:>Print[{{aa},bb,x}];
  {a*b*c,b*d}/.{aa__*x__,bb_*x_}:>Print[{{aa},bb,x}];
  {a*b*c,b*d}/.{aa__*x_,bb_*x__}:>Print[{{aa},bb,x}];
  {a*b*c,b*d}/.{aa__*x__?((Print[##];1)&),
    bb_*x__?((Print[##];1)&)}:>Print[{{aa},bb,{x}}];
end
!
!
   Clear[a,b,c,d,e];
   a=Table[0,{10}];
   i=1;
   k=1;
   c:=(ToExpression["a[[i]]=Sin[k];\
     Print[{i,MemoryCheck[]}];\
     k++;\
     i=Mod[i,10]+1;\
     After[1,c]"]);
   c;
   TkWait[]
end

!
!
  f=CaOpen["BTpPS:HX03P:K"]
  CaRead[f]
end
!
!
   Clear[a,b,c,d,e,f,g];
   (a=x:"OK")^:=Print[x];
   Print[?a];
   a="OK";
   Print[?a];
   Clear[a,b,x];
   Module[{a},
     (a=x_)^:=Print[x];
     Print[?a];
     a="OK";
     Print[?a]];
end
!
!
  d1:=(Print["d1"];OpticsPlot[{{{{11,2},{13,5}}},{"BX","BY"}}]);
  d2:=(Print["d2"];OpticsPlot[{{{{12,2},{14,5}}},{"EX","EY"}}]);
  f=KBMainFrame["",w];
  c=Canvas[w,Width->600,Height->400];
  $DisplayFunction=CanvasDrawer;
  Canvas$Widget=c;
  After[1,d1];
  After[1.03,d2];
  After[3,d2];
  TkWait[]
end

!
!
  Clear[a,b,c,d,e,f,g];

  Module[{w,f},
    w=Window[];
    f=Frame[w];
    Print[w];
    Print[?TkSymbol];
    TracePrint[DeleteWidget[w]];
    Print[?TkSymbol]];
  ?TkSymbol


end

!
!  ListPlot
   w=Window[];
   c=Canvas[w,Width->500,Height->400];
   $DisplayFunction=CanvasDrawer;
   Canvas$Widget=c;
   OpticsPlot[{{}},
     PlotRange->{{5,10},Automatic}];
   Update[];
end
!
!
! SetEnv
  f[x_]:=Print[{x,Environment[x]}];
  f["HOME"]
  f["AAA"]
  Environment["AAA"]
  SetEnv["AAA","1"]
  Environment["AAA"]
end
!
!
  Clear[a,b,c,d,e,f];
  f[x_]:=Module[{g},
    g[y_]:=Print[y];
    Print[{?g,g[1]}];
    g[1];1];
  ?f
  f[0]
end
!
!  StringJoin
   Clear[a,b,c,d,e,g];

   MemoryCheck[]
   a="a";
   MemoryCheck[]
   Clear[a];
   MemoryCheck[]
   a="a"//"b";
   MemoryCheck[]
   a="a";
   MemoryCheck[]
   b="b";
   MemoryCheck[]
   c=a//b;
   MemoryCheck[]
   c="c"
   MemoryCheck[]

end
!
!
  Clear[f,g,x,y];
  f[x_]:=Module[{y},x];
  g[x_]:=Module[{y},y];
  Print[MemoryCheck[]];
  Timing[Do[f["a"],{100000}]]
  Print[MemoryCheck[]];
  Timing[Do[g["a"],{100000}]]
end
!
!
!  Replace
  Clear[a,b,c,d,e,f,x];
  a/.x_->f[x]
  Module[{x},a/.x_->f[x]]

end
!
! Definition
  MemoryCheck[]
  Scan[(Print[{#,ToExpression["Definition["//#//"]"],MemoryCheck[]}])&,
    Complement[Names["*"],System$Names]]
  MemoryCheck[]
end
  Clear[a,b,c,d,e,f,g];
  f[x_]=Sin[x];
  Do[f[i]=2,{i,3}];
  f[x_,y_]=0;
  (f[1]=1)^:=2
  (f[1]=x_)^:=3
  Print[?f]


  FunctionDefinition[f[2]]
  FunctionDefinition[f[101]]
  f[101]
end
!
!  Insert
  Insert[Hold[{Print[1],Print[2]}],1,{1,1}]
end
!
!
  a=b=2;
  c:=Print["Not OK"];
  Dimensions[Unevaluated[a;b;c]]
  Length[Unevaluated[a;b;c]]
  Length[Hold[a;b;c]]
  Dimensions[Hold[a;b;c]]
end
!
!  Hold
  a=1;
  Protect[a];
  ToExpression[ToString[Hold[a=2]]]
end
!
!
  Clear[a,b,c,d,e,f,g];
  (f[y_]=x_)^:=g;
  (f[y_]:=x_)^:=g;
  (f[a:(AddTag$Above|AddTag$Below|
    AddTag$Closest|AddTag$Enclosed|AddTag$Overlapping|AddTag$All|
      AddTag$WithTag)]=x_)^:=e;
  f[1]=2
  f[AddTag$All]=1
end
!
!  Hex
  0xabcde
  0x2.8
end
!
!  EvenQ, OddQ
  EvenQ[Range[-10,10]/2]
  OddQ[Range[-10,10]/2]
end
!
!
  StringMatchQ["X1X","*X"]
  StringMatchQ["X1X","X*X"]
  StringMatchQ["X1X","*X*"]
  StringMatchQ["X1X1","*X*"]
  StringMatchQ["X1X1","X*X*"]
end
!
!
  LINE["S","IP2"]
  LINE["S","IP2.2"]
end
!
!
  a=Table[0,{10},{1000}];
  Print[MemoryCheck[]];
  a[[3]]=0;
  Print[MemoryCheck[]];
  a[[4]]=0;
  Print[MemoryCheck[]];
end
!
!
   Clear[a,b,c,d,e,f];
   b=a={{1,2,3},{4,5,6}};
   ReplacePart[a,0,{,2}]
   b[[1,{2,3}]]=0;b
   b=a;
   a[[,2]]=0;a
   b=a;
   a[[1,{2,3}]]={-1,-2};a

end   
!
!  RegExp
  $WildCard="regexp";
  StringMatchQ["abcde",".+c*.+"]
  $WildCard="sad";
  StringMatchQ["abcde",".+c*.+"]
  $WildCard="regexp";
  a="abcde";
  Timing[Do[StringMatchQ[a,".+c*.+"],{10000}]]
  $WildCard="sad";
  Timing[Do[StringMatchQ[a,"*c*"],{10000}]]
end
!
!
  a={1,2,3,4,5};
  a[[{2,4}]]=0;
  a
  a[[{2,4}]]={1,2};
  a
  a[[{2,4}]]={1,2,3};
  a
end
!
!  D, ReduceExpression
  Clear[f,x,a,b,c];
  e=1+x-x+(3+x+3*x)
  e=e/.ReductionRule
  e=e/.ReductionRule
  e=e/.ReductionRule
  Print[ReduceExpression[1+x-x+(3+x+3*x)]]

  Print[a=ReduceExpression[1+x*(1/x)-x+(3+x+3*x)]];

  Print[D[Sin[3 x],x]];
  Print[D[Sin[x]Cos[x],x]];
  Print[D[x^3 Sin[x],x]];
  Print[D[Sin[y],x]];
  Print[D[Sin[Cos[x]],x]];
  Print[D[{Sin[x]/Cos[x],Cos[x]/Sin[x]},x]];
  Print[D[x y,x]];
  Print[D[Sqrt[x^2],x]];
  Print[D[f[x,x^2],x]];
  Print[D[D[f[x,x^2],x],x]];
  D[aa x^3 Sin[x],x]

  Timing[Do[D[x^3 Sin[x],x],{100}]]
  MemoryCheck[1]
end
!
! Orderless
  Clear[a,b,c,d,e,f,x,y,z,u,v,w];
  MatchQ[c+a*b*c,z_+x___*z_*y___]
  MatchQ[a*b*c+e*c*d,v___*z_*u___+x___*z_*y___]
  a*b*c+e*c*d/.v___*z_*u___+x___*z_*y___:>Print[{u,v,x,y,z}]
  f+a*c+e*c*d/.w___+v___*z_*u___+x___*z_*y___:>Print[{u,v,w,x,y,z}]
  f+a*c+e*c*d/.v___*z_*u___+x___*z_*y___+w___:>Print[{u,v,w,x,y,z}]
  f*g+a*c+e*c*d/.v___*z_*u___+x___*z_*y___+w___:>Print[{u,v,w,x,y,z}]
  f*g+a*c+e*c*d//.ReductionRule
end
!
!
!  Fit
   strk$nch = 480;
   pd = Map[Exp[-((#-240)/50)^2/2]&,Range[strk$nch]];
   strk$x = Range[strk$nch]/strk$nch + 1;
   fr = Fit[
     Thread[{strk$x,pd}],
     strk$c+strk$a*Exp[-((strk$t-strk$t0)/strk$sgm1)^2/2],
     strk$t,
     {strk$t0,1.5},
     {strk$sgm1,.1},
     {strk$c,0},
     {strk$a,1}
     ];
end

!
! Plot
   Clear[x,y,z,f];
   Plot[Sin[x],{x,-Pi,Pi}];
   x=1;
   Plot[Sin[x],{x,-Pi,Pi}];
end


!   w=Window[];
!   c=Canvas[w,Width->500,Height->400];
!   $DisplayFunction=CanvasDrawer;
!   Canvas$Widget=c;
   Plot[{BesselJ[n,1e-20],BesselJ[n,1e-40],
     BesselJ[n,1e-60],BesselJ[n,1e-80],
     BesselJ[n,1e-100],BesselJ[n,1e-120]},
   {n,0,1}]
!   Plot[{BesselJ[0,x],BesselJ[1,x],BesselJ[2,x],BesselJ[3,x]},{x,0,10}]
   Update[]
end
!
! SetElement
  SetElement["QF"]
  SetElement["QF","QUAD"]
  SetElement["QF","BEND"]
  SetElement["QF","QUAD",{"K1"->0.1,"L"->2,"K1"->0.01}]
end
  SetElement["QF",,{"K1"->0.1}]
  SetElement["QFF",,{"K1"->0.1}]
  SetElement["QFF","QUAD",{"K1"->0.1}]
  SetElement["QFF1"]
  SetElement["QDD","QUAD"]
  SetElement["QDD1","QUOD"]
  SetElement["QF1"]
  SetElement["QF1","QUAD"]
end
!
!   Dispatch
  Clear[a,b,c,d,e,f];
  f[x_]:=x^2;
  f[1]=1;
  ?f
  f[4]
end
!
!
  Clear[a,b,c,d,e,f,g];
  f[b__]:=If[a===b,"OK"];
  ?f
  f[a]
end
!
!
  Clear[a,b,c,d,e,f,g];
  f[x__]:=(a:={x});
  f["a",1]
  a
  Timing[Do[f["a",1],{100000}]]
end
!
! Complex
  Complex[1,0]
end
!
! RotateRight
  a={1,2,3,4,5};
  RotateRight[a,3]
  RotateRight[a]
  RotateRight[{{1,2,3,4},{5,6,7,8}},{1,2}]
  RotateRight[a,-2]
  RotateLeft[a,3]
  RotateLeft[a]
  RotateLeft[{{1,2,3,4},{5,6,7,8}},{1,2}]
  RotateLeft[a,-2]
end

  Clear[a,b,c,d,e]
  With[{x=#[[2]]},#[[1]]:>x[1]]&[a:>b]

end
!
!
!  Pattern with head.
   Clear[a,b,c,d,e,f];
   f[a__Real,b_]:=Print[{{a},{b}}];
   f[1,2]
   f[1,2,"3"]
   f[1,2,"3",4]
end
!
!  Optional argument
  Clear[f,a,b,c];
  f[a_:3]:=Print[{a}];
  f[4]
  f[]
  Clear[f];
  aa={1,2,3};
  f[x_:aa,y_]:=Print[x,",",y];
  f[1,2]
  f[3]
  f[,3]
  f[3,]
  Clear[f,a,b,c,d,e,x,y];
  f[x:b_*c_,y_]:={x,y};
  Definition[f]
  f[d*e,y]
end

!
!  Replace
  Clear[a,b,c,d,e,f];
  a=Alternatives@@Append[Table[b,{1000}],c];
  e=Alternatives@@Append[Table[1,{1000}],2];
  Timing[Do[c/.a->d,{1000}]]
  Timing[Do[f[a],{10000}]]
  Timing[c=0;Do[c=c+1;f[a],{10000}]]
  Timing[Do[f[e],{10000}]]
end
!
!   level, ntfdef
  Clear[a,b,c,d,e];
  Table[0,{10},{10}];
  a:=(j=0;While[Table[0,{10},{10}];j==0,a=1;j=1];Print[2];Print[3]);
  a
  Definition[b];
  b=b;
  c=b;
  Definition[b,c];
  Clear[a,b,c,d,e];
  a={b};
  b=1;
  a
end
!
!
!  If and While
  n=1;While[a={1,2,3,4,5};n<6,a[6-n]=n;Print[a];n=n+1];
  Print[a];
  Select[a,(b=Sin[{1,2,3,4,5}];b[#]=2;Print[b];1)&]
  Print If[2>3,'wrong','right']
  Print If[2>3,'wrong']
  Print If['a','wrong','wrong','Not a number']
  m=2
  n=0;While[n=n+1;n<10,m=m*2]
  print m
end

Timing[Do[
  s=0;
  Do[s+=i,{i,30}],
  {500}]]

Timing[Do[
  s = {};
  Do[
    s = {s,n};
  ,{n,50000}
  ];
  s = Flatten[s];
,{10}
]]

Timing[Do[Depth[Flatten[s,150000]],{10}]]

end
!
! 
  DateString
  DateString
end
!
!
  Clear[f,g];
  f[x__]:={x};
  Timing[Do[f[1,"a",2],{100000}]]
  Clear[f];
  f[x__,y_]:=If[x,y];
  Timing[Do[f[0,1,"a"],{100000}]]
  Timing[Do[ToExpression["f[0,1,\"a\"]"],{100000}]]  
  g:={1,"a",2};
  Timing[Do[g,{100000}]]
  Clear[g];
  g[]:={1,"a",2};
  Timing[Do[g[],{100000}]]
  Clear[g];
  g=1;
  Timing[Do["a"//g,{100000}]]
  g="b";
  Timing[Do["a"//g,{100000}]]
end
!
!
  Clear[a,b,c,d,e,f,x,y,z];
  aa={"a"};
  f[x_]:=Module[{},aa[[1]]=aa[[1]]//"a"];
  $Line=0;
  MemoryCheck[]
  g[f[1],f[1],f[1],f[1]]
  $Line=0;
  MemoryCheck[]
  g[f[1],f[1],f[1],f[1]]
  $Line=0;
  MemoryCheck[]

end
!
!
   w=Window[];
   c=Canvas[w,Width->500,Height->400];
   $DisplayFunction=CanvasDrawer;
   Canvas$Widget=c;
   OpticsPlot[{{{{{1,2},{30,4}},PointTags->"a"},{{1,3},{30,6}}},
     {{4,6},{10,3}}}]
   Update[];
end
!
!
   Clear[a,b,c,d,e,f];
   f[x_]:=(Print[x];If[x==1,
     Print[x];1,
     Print[x];2]);
   TracePrint[f[1]]
   TracePrint[f[0]]
end
!
!  StandardForm
  Clear[a,b,c,d,e];
  c=Pi;
  a:=StandardForm[$FORM="8.5";Print[?$FORM];c//""];
  b:=StandardForm[$FORM="8.5";Print[?$FORM];c//StandardForm[c//""]//c];
  a
  b
  st[c_]:=Module[{f={PageWidth,$FORM}},PageWidth=20000;$FORM="";{c,
    {PageWidth,$FORM}=f;}[[1]]];
  st1[c_]:=Module[{p=PageWidth,f=$FORM},PageWidth=20000;$FORM="";{c,
    PageWidth=p;$FORM=f;}[[1]]];
  st2[c_]:=Module[{p=PageWidth,f=$FORM,r},PageWidth=20000;$FORM="";r=c;
    PageWidth=p;$FORM=f;r];
  st3[c_]:=Module[{p=PageWidth,f=$FORM,r=(PageWidth=20000;$FORM="";c)},
    PageWidth=p;$FORM=f;r];
  st4[c_]:=Block[{PageWidth=20000,$FORM=""},c];
  st5[c_]:=With[{p=PageWidth,f=$FORM,r=(PageWidth=20000;$FORM="";c)},
    PageWidth=p;$FORM=f;r];
  st6[c_]:=Module[{p=PageWidth,f=$FORM},PageWidth=20000;$FORM="";c+
    (PageWidth=p;$FORM=f;Null[])];
  Timing[Do[st[""],{10000}]]
  Timing[Do[st1[""],{10000}]]
  Timing[Do[st2[""],{10000}]]
  Timing[Do[st3[""],{10000}]]
  Timing[Do[st4[""],{10000}]]
  Timing[Do[st5[""],{10000}]]
  Timing[Do[st6[""],{10000}]]
  Timing[Do[StandardForm[""],{10000}]]
end

!
!   DeleteWidget
  w=Window[];
  Py$Echo=1;
  f=Frame[w];
  TracePrint[DeleteWidget[f]];
end
!
!
  a:=$FORM;
  b=Pi;
  Block[{$FORM="10.3"},Print[$FORM];Print[a];ToString[b]]
  $FORM
end
!
!
  w=Window[];
  b=Button[w,Text->,
    Font->"-misc-fixed-medium-r-normal--14-130-75-75-c-140-jisx0208.1983-0"]
  Update[];
  end
!
!
  Clear[a,b,c,d,e,f,g,s,x];
  s="123456789";
  ?StringDrop
  StringDrop["123456789",2]
  StringDrop[s,2]
  ?StringDrop
  StringDrop[s,2]
  {MatchQ[x,3],StringDrop[s,2]}
  {MatchQ[x,3],StringDrop[s,2],StringDrop[s,2]}
  {MatchQ[x,3],StringDrop[s,2]}
end
  


   ?(Switch[x,1,"aa",2,"bb"]//StringDrop[s,2])
   {MatchQ[x,3],StringDrop[s,2]}
   {Which[x>0,"aa",True,"bb"],StringDrop[s,2]}
end
!
!  Table
  Clear[a,b,c,d,e];
  Table[a={i},{i,2}]
  Timing[Do[Table[a={i},{i,2}],{100000}]]
  MemoryCheck[]
end


   OpticsPlot[{{"SIGX","SIGY"},{"SIGXX","SIGYY"},
     {{Thread[{LINE["POSITION"],LINE["S"],Table[10,{LINE["LENGTH"]}]}]},
       {Thread[{LINE["POSITION"],LINE["S"]*2}]},PointSize->{1,0.5}}},
     Tags->True];
   Update[];
   TimeUsed[]
end
   OpticsPlot[{{"SIGX","SIGY"},{"SIGXX","SIGYY"},
     {{Thread[{LINE["POSITION"],LINE["S"],Table[10,{LINE["LENGTH"]}]}]},
       {Thread[{LINE["POSITION"],LINE["S"]*5}]},PointSize->{1,0.5}}},
     Tags->True,Lattice->False,Initialize->Frame];
   Update[];
   TimeUsed[]
end
!
!  Null[]
   Clear[a,b,c,d,e,f];
   {a,b,c}/.b->Null[]
   {a,b,c}/.b:>Null[]
   f[1,Switch[1,_Real,Null[]],2]
end
!
!  StringToStream
  l=StringToStream["This is a\n test 1+\n2"];
  Read[l,{Word,Word,Word,Word,Word},ReadNewRecord->False]
  Read[l,String]
  Read[l,{Word,Expression}]
end
!
!
   a=Pi//"";
   Timing[Do[ToString[a],{10000}]]
   Timing[Do[ToString[a,FormatType->InputForm],{10000}]]
end
!
!
 Do[
   f=OpenRead["!ls"];
   If[Mod[i,100]==0,Print[{i,f,Read[f,String]}]];
   Close[f],
   {i,100000}]
end
!
!  Module
  Clear[f,g,h];
f[] := Module[{g},
  g[] := Print["g"];
  h[] := g[];
  h[];];
  f[]
  f[]
end


!
!   StringTrim
   StringTrim["   aaa  bbb\t   "]
end
!
!  Comment
 1 + (*aaa*) 3
 1 +  (* Comment can be enclosed
      like this *) 2
 ToExpression["(* This is not allowed"]
end
!
!  GetMAIN
  GetMAIN["/users/oide/WORK/oldsad/sad/maintest.sad"];
  USE CELL2;
  cal
end
!
! Vector
  xl=Range[-100,100];
  x=Vector[xl];
!  Vectorize[Plus,x,x]
end
  Timing[Do[Sign[x],{10000}]]
  Timing[Do[Sin[x],{10000}]]
  Timing[Do[x+x,{10000}]]
  Timing[Do[x+1,{10000}]]
  Timing[Do[xl+xl,{10000}]]
  Timing[Do[xl+1,{10000}]]
  Timing[Do[Sin[xl],{10000}]]
  Timing[Do[Sign[xl],{10000}]]
  Timing[Do[Sin/@xl,{10000}]]
  Timing[Do[Sign/@xl,{10000}]]
  y=Vec[xl];
  (Vec[x_]+Vec[y_])^:=Vec[x+y];
  Timing[Do[y+y,{10000}]]
end
!
!  SetList with UpValue
  {AXI,BXI}={0.1,10};
  ins cal;
  disp ^^^
end
!
!
  w = KEKBMainFrame["KEKBMainFrame", f, Title->"KEKB MainFrame"];
  w[AddMenuButton] = {mbedit, Text->"Test"};
  MemoryCheck[];
  medit = Menu[mbedit, Add->{Button[Text->"Cut"]}];
  MemoryCheck[];
end
!
!   Integer id
  Clear[a,i];
  i=0;
  While[a[i]=1;a[i]==1 && i<1000000,a[i]=.;i++];
  Print[i];
  Definition[a]
end
!
!  Expand Times
  Clear[a,b,c];
  a=2;b=4;
  -(7-a/2-b/2)
  Definition[-(7-a/2-b/2)]
  Definition[-(7-a/2+c)]
  Definition[(7-a/2+c)]
  Definition[2*(7-a/2+c)]
  Definition[(a^b^c)^3]
end
!
!  Dispatch
   Clear[a,b,c,d,e,f];
   f[a_]:=0;
   Do[f[i]=i^2,{i,1,10}];
   Do[With[{i},a[f[i]]^=Sqrt[i]],{i,1,10}];
   Print[Definition[f]];
   Print[{f[5],a[f[5]]}];
   f[5]
   f[11]
   f[1,2]=3;
   f["a"]=4
   Definition[f]
   Timing[Do[f[9],{100000}]]
   Timing[Do[f["a"],{100000}]]
   Definition[f]
end
!
!  Literal
   Clear[a,b,c,d,e,f,g];
   a=1;
   Hold[a]/.Literal[a]->2
   Hold[a]/.a->2
end

!
! TagSet
  Clear[a,b,c,d,e,f];
  a/:b=1;
  a/:a=1;
  Definition[a]
  Clear[a];
  a/:a[b,c]=1;
  Definition[a]
  Clear[a];
  c/:a[b,c,d]=1;
  d=1;
  c/:a[b,c,d]=1;
  Definition[c]
  c/:a[b,c,d]=.;
end
!
!
   DP0=0.001;
   cal
   disp a $$$


   ins fit dx 0.001 free ddpi go
   end
!
!
  w=Window[];
  c=Canvas[w,Width->100,Height->100];
  c1=Canvas[w,Width->100,Height->100];
  $DisplayFunction=CanvasDrawer;
  Canvas$Widget=c;
  TracePrint[
  Canvas$Widget=c1];
end
!
!  Bessel
  BesselY[.5,12.2-1e-9]
  BesselY[.5,12.2+1e-9]
  BesselY[0,12.2-1e-9]
  BesselY[0,12.2+1e-9]
end
  BesselJ[0,0]
  BesselJ[0,1]
  BesselJ[1,5I]
  
end
!
!  Day

 Day[]  
 Day[{0,1,1,0,0,0}]

  end
!
!
  a++;
  a
end
!
!  Two "applications"
  p=Fork[];
  If[p==0,
    w1=Window[];
    ApplicationName["child"];
    b1=Button[w1,Text->"wait 1",Command:>c1];
    b11=Button[w1,Text->"return 1",Command:>(Print["Returned 1"];TkReturn["1"])],
    w2=Window[];
    ApplicationName["parent"];
    b2=Button[w2,Text->"wait 2",Command:>c2];
    b21=Button[w2,Text->"return 2",Command:>(Print["Returned 2"];TkReturn["2"])]];

  c1 := Module[{r},While[r=(Print["Waiting 1: "];
    TkWait[]);r<=>"1",Print["c1: ",r];TkReturn[r];Update[]];
    Print["Received 1"]];
  c2 := Module[{r},While[r=(Print["Waiting 2: "];
    TkWait[]);r<=>"2",Print["c2: ",r];TkReturn[r];Update[]];
    Print["Received 2"]];

  Print[ApplicationName[]];
  If[p<>0,TkWait[],Update[]];

  w1[Send]={"parent","puts aaa"};
end


!
!  Constant
  Clear[a,b,c,d,e,f,g];
  Hold[Pi]
  Hold[Sin[Pi]]
  Hold[If[True,"OK"]]
  Hold[If[a===b,"OK"]]
  f[x_,y_,z_]:=Hold[If[x,y+z]];
  f[True,2,3]
  Clear[f];
  f[x__]:=Hold[Length[{x}]];
  f[1,2,3]
  f[a,1,2]
  f[a->v,1,2]
  Clear[f];
  f[x__]:=Hold[And[x]];
  f[1,2,a,2,b]
end
!
!  SetAttributes
   Clear[a,b,c,d,e,f,g];
   f[a_,b_]:=Hold[a,b];
   g[x_]:=x*2;
   SetAttributes[f,HoldAll];
   f[g[1],g[2]]
   SetAttributes[f,HoldFirst];
   f[g[1],g[2]]
   SetAttributes[f,HoldRest];
   f[g[1],g[2]]
   SetAttributes[f,HoldNone];
   f[g[1],g[2]]
end
!
!
!
!
!$Immediate=0;
  Clear[a,f,w];
  w=Window[];
  f[x_]:=ToExpression[x];
  Timing[Do[a="a",{10000}]]
  Timing[Do[a=(PyEval["'a'"];"a"),{10000}]]
  Timing[Do[a=PyEval["sad.ret('a')"],{10000}]]
  Timing[Do[PyEval["a='a'"],{10000}]]
  Timing[Do[PyEval["a='a'"],{10000}]]
  Timing[Do[PyEvalString["a='a'"],{10000}]]
  Timing[Do[f["a='a'"],{10000}]]
  Timing[Do[ToExpression["a='a'"],{10000}]]
end

!
!
  n="Test";
  w=Window[Title->n];
  w1=Window[w,Title->"w1"];
  t="cb";
  v=1;
  cb1=CheckButton[w1,TextVariable:>t,Variable:>v];
  cb2=CheckButton[w1,TextVariable:>t,Variable:>v];
  Update[];
end
!
!
  Py$Echo=1;
  n = 1;
  opt={Title->"title1"};
  title2="title2";
  w = Window[,If[n==1,opt,Title->title2]];
  b = Button[w,Text->"button"];
  TkWait[];
end
!
!
  w=Window[];
  w=Window[];
  DeleteWidget[w1]
  TkWait[];
end
!
! TkWait
  i=0;
  f:=(Print[++i];After[0.01,f];TkWait[]);
  f
end
!
!
  TkSense[10]
end
!
!
  Log[1, 2, 3] + Sin[1, 2]
  General::narg
end
!
! Message

  General::test="This is a test of `1` and `2` with `3`";

  Message[General::test];
  Message[General::test,Sin[1],Message,aaa/bbb]
  MessageString[General::test,Sin[1],Message,aaa/bbb]
        
  Do[Sin[1,2]+Log[1,2,3]+Sin[2,3,4],{10}]

end

!
! 
  On[General::newsym];
  Timing[Do[General::narg,{10000}]]
  Timing[Do[ToExpression["General::narg"],{10000}]]
  Off[General::narg,General::wrongtype];
  Timing[Do[Sin[1,2],{100000}]]
  Timing[Do[Sin[1],{100000}]]
end
!
! Check, On, Off
  Check[Sin[1,2],Print["OK"]]
  Check[Sin[1,2],Print[$MessageList],General::narg]
  Check[Sin[1,2],Print[$MessageList],General::aaa]
  Off[General::narg];
  Sin[1,2]
  Check[Sin[1,2],Print["Checked"]]
  On[General::narg];
  Check[Sin[1,2],Print["Checked"]]

end
!
!  Module, generations
  Clear[a,b,c,d,e,f,g];
  b:=1;
  f[a_]:=Module[{b=2},Print[a]];
  SetAttributes[f,HoldAll];
  f[b]
  Clear[a,b,c,d,e];
  f[a_]:=Module[{b},a+b/.b->c];
  g[a_]:=Module[{b},a+b/.(b:b)->c];
  {f[b],g[b]}
  b:=d;
  f[a_]:=Module[{b},{a,b}/.a:b->a+1];
  g[a_]:=Module[{b},{a,b}/.c:b->a+1];
  h[a_]:=Module[{b},{a,b}/.c:b->c+1];
  SetAttributes[f,HoldAll];
  SetAttributes[g,HoldAll];
  {f[b],g[b],h[b],f[1]}

  Clear[a,b,c,d,e];
  a=b;
  b=c;
  Module[{b=d},{a,b}]
  Module[{b=b},{a,b}]
  Clear[a,b,c,d,e];
  a=b;
  b=a
  a:=b;
  b:=a;
  a
end
!
!  Sort
  Clear[a,b,c,d,e]
  Sort[{a_,a,aa,Plus,t}]
end
!
!  Module
  Clear[a,b,c,d,e];
  a := b;
  Module[{b},
    b = c;
    a + b]
  d[] := b;
  Module[{b},
    b = c;
    d[] + b]
  
end
!
!  Scoping with module
   Clear[a,b,c,d,e];
   c=1;
   a:=Module[{b},c];
   Module[{c=3},a]
   Module[{c=3},a:=Module[{b},c];a]
   Module[{c=3},a:=Module[{b},c];Module[{c=4},a]]
   Timing[Do[Module[{c=3},a:=Module[{b},c];Module[{c=4},a]],{10000}]]
end
!
!  Scoping
   Clear[a,b,c,d,e,f,g,x,y];
   f[x_]:=Module[{d},d=c;{d,x}];
   g[x_]:=Unevaluated[Module[{d},d=c;{d,x}]];
   SetAttributes[f,HoldAll];
   f[d]
   g[d]
   Unevaluated[Module[{d},d=c;{d,x}]]/.x:>d
end
!
!  Scoping with define
   Clear[a,b,c,d,e,f,g,h];
   a=Range[1,5];
   Do[Print[a[[i]]],{i,Length[a]}]
   h[a_]:=a;
   SetAttributes[h,HoldAll];
   f[a_]:=h[Module[{},Do[Print[a[[i]]],{i,Length[a]}]]];
   g[a_]:=Module[{},Do[Print[a[[i]]],{i,Length[a]}]];
   f[a]
   g[a]
end
!
!  Scope again.
  Clear[a];
  aa:=(a=1;Print[a$1]);
  Module[{a},Print[a];a=2;aa]
  a
end
!
!   MapIndexed
   Clear[a,b,c,d,e,f,g];
   a={b,c,{d,{e,g}}};
   MapIndexed[f,a]
   MapIndexed[f,a,0]
   MapIndexed[f,a,1]
   MapIndexed[f,a,-1]
   MapIndexed[f,a,{1,2}]
   MapIndexed[f,a,{2,1}]
   MapIndexed[f,a,{1,-2}]
   MapIndexed[f,a,{-2,1}]
   MapIndexed[f,a,{-3,-1}]
   MapIndexed[f,a,{-1,-3}]
!
!  StringMatchQ, StringPosition, ToUpperCase
  StringMatchQ["qf1","qf*"]
  StringPosition["abcdeabcdeabc","cde"]
  StringPosition["abcdeabcdeabc","cde",1]
  StringPosition["abcdeabcdeabc",{"abc","cde","abc"}]
  ToUpperCase["ToUpperCase"]
end
!
!   ToCharacterCode,FromCharacterCode,ToString,Characters
  ToCharacterCode["Hello!"]
  FromCharacterCode[{72,101,108,108,111,33}]
  FromCharacterCode[65]
  ToString[{1,2,3}]
  ToCharacterCode["\t\n\f\r\\\27\abcde"]
  Characters["A string."]
  StringDrop["abcde",1]
  StringDrop["abcde",3]
  StringDrop["abcde",5]
  StringDrop["abcde",-1]
  StringDrop["abcde",-3]
  StringDrop["abcde",-5]
  StringDrop["abcde",{1,-1}]
end
!
!  OpenRead
  f=OpenRead["!ls -lt *.c"]
  While[s=ReadString[f];Print[s];s<=>EndOfFile,];
  Close[f];
  f=OpenRead["!env"]
  While[s=ReadString[f];Print[s];s<=>EndOfFile,];
  Close[f];
end

!
! Define
  Clear[a,b,c,d,e,f];
  a[b_][c_]:=d
  Definition[a]
end
  
!
!  Define with []
  Clear[a,b,c,d,e,f,g];
  With[{r=a|b},
    Print[r];
    f[r[1]]:=g;
    f[r[label_,com_]]:=g];
  Definition[f]
  With[{r=a+b},
    f[r[label_,com_]]:=g];
  Definition[f]
  end
!
!  TemporaryName

   Table[TemporaryName[],{10}]
end


!
!  Unary minus
   Clear[a,b,c,d,e];
   2^3^2
   3^-2
   3*-2
   Print[-a^b," ",a^-b," ",a^-b^c," ",a-b^c," "];
   Print[-a*b," ",a*-b," ",a*-b*c," ",a-b*c," "];
end
!
!
  lf=Append[Log[10,{1,1.5,2,3,5,7}],1];
  m1=1e-16;
  i1=Position[lf,x_?((#<=m1)&),{1}][[-1,1]]
end

!
! MessageName
  Clear[a,b,c,d,e,f,g];
  Unprotect[MessageName];
  a::b
  a::b = "This is a test message";
  Definition[MessageName]
  a::b
  Print[HoldForm[Sin[1]]];
  Short[Table[0,{1000}]];
  Short[Table[0,{1000}],2];Print["a"];
  Short[Table[0,{1000}],-2];Print["a"];

end

!
!
  Clear[a,b,c,d,e,f];
  (a|b)[c,d]
  (Rule|RuleDelayed)[c,d]
  (Rule|RuleDelayed)[c,_]
  (Rule|RuleDelayed)[Menu,_]
end
!
! MinMax
  MinMax[1,2,{3,{4,5,6}},5]
  Scan[(a=Range[1,#];
    Print[{Timing[Do[Min[a],{10000}]],
      Timing[Do[{Min[a],Max[a]},{10000}]],
      Timing[Do[MinMax[a],{10000}]]}])&,
    {1,10,100,1000,10000}]
end
     
!
! Restrict
  Restrict[10,-2,5]
  Restrict[Range[10],3,6]
  Restrict[{2,Range[10]},3,6]
end

!
!  operation order
  Clear[a,b,c,d,e,f,g];
  2^3^2
  a@@b/@{c}
  d=e=f;{d,e}
  a->b->c
  a->b:>c
  a@b@c

end
!
!  StringFill
  StringFill[""," ",10]
  StringFill["a","bc",10]
  StringFill["abc","de",10]
end
!
!  OpticsPlot
   w=Window[Title->"Test"];
   c=Canvas[w,Width->936,Height->550];
   $DisplayFunction=CanvasDrawer;
   Canvas$Widget=c;
   p3=OpticsPlot[{{"BX","BY"},{"EX","EY"},{"NX","NY"}},
     Region->{"QF","QF1"},
     PlotRegion -> {{0,0.8},{0,1.2}}];
end
  p1=OpticsPlot[{{"BX","BY"},{"EX","EY"},{"NX","NY"}}];
  p2=OpticsPlot[
    {{"BX","BY"},
     {"DX",{{{10,0.001},{20,0.002}},FrameLabel->"DX meas.",
      Unit->Meter}}}];
!  p1=OpticsPlot$1[{"BX","BY"},{1,10}];
!  Show[p1];
end
  p1=ListPlot[OpticsList["BX",1,10,0.1,0],PlotJoined->True,Plot->False];
end
!
!
   w=Window[Title->"Test"];
   c=Canvas[w,Width->936,Height->550];
   $DisplayFunction=CanvasDrawer;
   Canvas$Widget=c;
   OpticsPlot[{{{1,0},{2,1},{10,2}}},Lattice->False]
   TkWait[];
!
!  replacing name of a pattern
  Clear[a,b,c,d,e,f,g,x,y];
  f[x_,y_]:=(g[x_]:=y;g[1]);
  y=x^2+1;
  f[x,y]
end

!
!  After
!   Py$Echo=1;
   PyEval[""];
   w=Window[Title->"after"];
   TracePrint[BindWidget[w,After[3],pr]];
   pr:=(Print[DateString];
     BindWidget[w,After[3],pr]);
   PyWait[];
  MemoryCheck[]
!
!  Canvas
!
!  Py$Echo=-1;
   PyEval[""];
   qname=LINE["NAME","Q*.1"];
!
!  commands
!
!-----plot betas and orbits by OpticsPlot (slow)--------
 plotorbit:=OpticsPlot[{{"BX","BY"},
   {{Thread[{LINE["POSITION",qname],measx}],FrameLabel->"DX meas.",
     Unit->Meter},"DX"},
   {{Thread[{LINE["POSITION",qname],measy}],FrameLabel->"DY meas.",
     Unit->Meter},"DY"}},
   Region->{"QF","$$$"},Names->"Q*"];
!-----simulate measure BPM-----------------------------
 measdata:=(
   measx=GaussRandom[4]*0.001;
   measy=GaussRandom[4]*0.001;
   Scan[FFS["FIT "//#[[1]]//" DX "//#[[2]]]&,Thread[{qname,measx}]];
   Scan[FFS["FIT "//#[[1]]//" DY "//#[[2]]]&,Thread[{qname,measy}]];
   plotorbit);
!-----fit orbit to measured data----------------------
 fitorbit:=(
   Check[FFS["FREE B*.* K0;GO"],];
   plotorbit);
!-----reset correctors to zero------------------------
 resetcorr:=(
   Check[FFS["B*.* K0 0;CAL"],];
   plotorbit);
!-----reject clicked BPMs (imperfect)-----------------
 rejdata:=Module[{ev={Widget,Tag,X,Y}/.$Event,w,tag,x,y},
   {w,tag,x,y}=ev;
   sx=(x-Canvas$Offset[[1]])/Canvas$Scale[[1]];
   m=Catch[Do[If[Abs[LINE["S",qname[i]]-sx]<0.5,Throw[qname[i]]],
     {i,Length[qname]}];""];
   Print[m,x,y];
   If[m<>"",
     r=If[y>300,"DY","DX"];
     FFS["FIT "//m//" REJ "//r];
     ConfigureWidget[w,AddTag$Closest->{"$rej",x,y}];
     ConfigureWidget[w,ItemConfigure->{"$rej",Fill->"red"}]]];
!
!  Defining Widgets
!
   w=Window[Title->"Test"];
   c=Canvas[w,Width->936,Height->550];
   fr=Frame[w,BD->0,BG->"#ffffd0",Relief->"sunken",
     Side->"right",Height->150];
   meas=Button[fr,Text->"MEAS",BG->"yellow",Side->"left"];
   cal=Button[fr,Text->"CAL",BG->"blue",FG->"white",Side->"left"];
   set=Button[fr,Text->"SET",BG->"red",FG->"white",Side->"left"];
   reset=Button[fr,Text->"RESET",BG->"green",Side->"left"];
!
!  Assign commands to buttons
!
   Py$Echo=1;
   meas[Command]:=measdata;
   cal[Command]:=fitorbit;
   reset[Command]:=resetcorr;
   BindWidget[c,"<Button>",rejdata];
   Py$Echo=0;
!
!  Plot betas and orbits by OpticsPlot
!
   $DisplayFunction=CanvasDrawer;
   Canvas$Widget=c;
   Canvas$WindowOffset={0,1.5};
   MemoryCheck[]
   g=Timing[measdata]

   w[Raise];
   AdjustWindowGeometry[w];
   PyWait[]
  MemoryCheck[]
end

!
!  Python Tkinter
!   Py$Echo=-1;
   PyEval[""];
   
   Dialog[mess_,buttons_]:=Module[{w1,b,m,f,wf,r},
     w1=Window[Title->"Dialog",OverrideRedirect->True,
       Geometry->"+400+300"];
     wf=Frame[w1,BorderWidth->3,Relief->"ridge"];
     m=TextLabel[wf,Text->mess,PadX->10,PadY->5];
     f=Frame[wf];
     Scan[With[{x=#},b[x]=Button[f,Text->#,Side->"left",PadX->10,
       Command:>PyReturn[x]]]&,buttons];
     r=PyWait[];
     DeleteWidget[w1];
     r];

   ww=Window[Title->"Test"];
   w=Frame[ww];
   time=DateString;
   a=Button[w,TextVariable:>time];
   b=Button[w,Text->"Dialog"];
   tr=1;
   echo=CheckButton[w,Text->"Echo",Variable:>tr];
   a[Command]:=PyReturn[1];
   b[Command]:=Print[Dialog["Do you really want to do this?",{"OK","Cancel"}]];
   echo[Command]:=(Py$Echo=tr);
   mess=Message[w,Width->100,
     Text->"Try Menu below to see Menu and Cascade."];
   mb=MenuButton[w,Text->"Menu"];
   menu=Menu[mb];
   menu1=Menu[menu,
     Add->{Button[Text->"Abort",Command:>FFS["abort"]]}];
   menu[Add]={Button[Text->"CAL",Command:>FFS["CAL",6]],
     Separator[],
     Cascade[Text->"Cascade",Font->TextFont["Times","bold",14],
       Menu:>menu1],
     Separator[],
     CheckButton[Text->"RFSW",Variable:>rfsw],
     Separator[],
     RadioButton[Text->"HER",Value->1,Variable:>ring],
     RadioButton[Text->"LER",Value->2,Variable:>ring]};
   MemoryCheck[]

   mb[Menu]:=menu;
   sc=Scale[w,From->-3,To->3,TickInterval->2,
     Variable:>scv,Digits->1,Resolution->0.01,BigIncrement->1,
     Orient->"horizontal",Length->200,Label->"Scale"];
   While[PySense[]===Null,time=DateString];
   Print[Py$Result];
   MemoryCheck[]

   a=Button[w,Text->"Return"];
   b=Button[w,TextVariable:>btext]
   btext="CAL";
   b[Command]:=FFS["cal",6];
   a[FG]="blue";
   a
   a[Text]="OK";
   a
   d[1]=Window[Title->"test1"];
   c[1]=Button[d[1],Text->"ccc",TextVariable:>c1text];
   cb1=CheckButton[d[1],Text->"First",Variable:>first]
   cb2=CheckButton[d[1],Text->"Second",Variable:>second]
   fr1=Frame[d[1]];
   tl=TextLabel[fr1,TextVariable:>tltext,Side->"left"];
   ent=Entry[fr1,Width->10,TextVariable:>enttext,Side->"left"];
   rbvar=1;
   rb1=RadioButton[d[1],Text->"abc",Value->1,Variable:>rbvar];
   rb2=RadioButton[d[1],Text->"def",Value->2,Variable:>rbvar];
   fr2=Frame[w];
   vsb=ScrollBar[fr2,Orient->"vertical",Side->"right",Fill->"y"];
   lb=ListBox[fr2,Insert->{"end",Sort[Take[Names["*"],50]]},BG->"white",
     SelectMode->"extended",YScrollCommand:>vsb[Set]];
   vsb[Command]:=lb[YView];
   AdjustWindowGeometry[w];
   
   cb1[Command]:=(tltext="First: ");
   cb2[Command]:=(tltext="Second: ");

   a[Focus$Set];
   BindWidget[a,"<Enter>",Print["OK"]];
   BindWidget[a,"<Key-a>",Print["OK"]];
   BindWidget[a,"<KeyRelease>",Print["OK"]];
   BindWidget[a,"<ButtonRelease>",Print["OK"]];
   BindWidget[a,"<Leave>",Print["OK"]];
   BindWidget[a,"<Motion>",Print["OK"]];
   BindWidget[a,"<Button-2>",Print["OK"]];
   PyMainLoop

end
!
!  String
  "a"=="a"
  "a"=="b"
  "abcdefghi"=="abcdefghi"
  "abcdefghi"=="abcdefghj"
  "abcdefghi"=="abcdefgii"
end
  Timing[Do["a"=="a",{500000}]]
  Timing[Do["aa"=="aa",{500000}]]
  Timing[Do["aaa"=="aaa",{500000}]]
  Timing[Do["aaaa"=="aaaa",{500000}]]
  Timing[Do["aaaaa"=="aaaaa",{500000}]]
  Timing[Do["aaaaaa"=="aaaaaa",{500000}]]
  Timing[Do["aaaaaaa"=="aaaaaaa",{500000}]]
  Timing[Do["aaaaaaaa"=="aaaaaaaa",{500000}]]
  Timing[Do["aaaaaaaaa"=="aaaaaaaaa",{500000}]]
end


!
!    SeedRandom,GaussRandom
  SeedRandom[3];
  GaussRandom[]
  SeedRandom[]
  GaussRandom[]
  SeedRandom[3]
  GaussRandom[]
  GaussRandom[10]
  GaussRandom[2,4]
  Random[3,5]
end
!
!
!  Hold, HeldPart, Unevaluated
  Clear[a,b,c,d,e,f,p,x,y];
!  Cases[Hold[Variable->a,b,c],(p:(Variable->x_))->Hold[p,x],1];
  Length[Unevaluated[x+y]]
  Unevaluated[x]
  Unevaluated[x]/.x->5
  x=1;y=2;
  pri f[""//Unevaluated[x+y]//"..."]
  a=4;
  HeldPart[Hold[a+1],1,2]
  Hold[Variable->a,b,c]
  a=3;
  y=3;
  d=e;
  Evaluate[d]=4;
  Print[d," ",e];
  Print[Through[(f+g)[y,z]]]
  Cases[Hold[Variable->a,b,c],(p:(Variable->x_)),1]
end
!
!  Symbol
   Clear[a,b,c,d,e];
   Symbol["a"]
   SymbolName[a]
   Symbol["a"]=1

end
!
!  PatternTest
  Clear[a,x];
  a:=MatchQ[3,x_?((Print[#];#==3)&)]
  a
end
!
! Operations
  Clear[a,b,c,d,e]
  {List[1,2,3],Function[a+1],Alternatives[a,b,c],
  Sequence[1,2,3],PatternTest[a,b]}
end
!
!   Pattern
   Clear[f,x,y,z];
   f[x_,y_]:=Print["x=",{x}," y=",{y}];
   f[1,2];
   f[1,2,3];
   Clear[f]
   f[x___,y___,y___]:=Print["x=",{x}," y=",{y}];
   f[1,2,3,4,5];
   f[3,1,2,1,2];
   f[1,y___,2];
   f[1,y___,y___];
   f[1,z___,z___];
   f[x___,y__]:=Print["x=",{x}," y=",{y}];
   f[1];
   f[2,1];
   f[2,3,1];
   f[2,3,4,1];
   f[x___,2,3];
   f[x___,y__]=.
   Definition[f]
end
!
!
 f[1]=2
 f[1]
 f[1]=4
 f[1,2]=3
 f[x_]=2
 f[x]^=3
 f[x]
 Definition[f,x]
 Clear[a];
 Module[{a},MemoryCheck[];a=1];
 u=v
 MemoryCheck[1]
 GarbageCollect[];
 MemoryCheck[1]
end
!
!   
   Clear[f];
   f[x___,f[y___],z___]:=Print[{{x},{y},{z}}];
   f[1,f[2,3],4]
end
!
!  Pattern
  Clear[f,g,x,y,z];
  f[x_,y_]:=Definition[x,y_,y];
  g[x_,y_]:=Definition[x,y:_,y];
  f[1,2]
  g[1,2]
end
!
!   Optional argument, Named pattern
  Clear[f,a,b,c,x,y];
  f[x_]=1;
  f[y_]=2;
  f[x_]=3;
  Definition[f]
  f[x:_]=4;
  f[y:_]=5;
  f[x:_]=6;
  Definition[f]
  f[x___,y___]:=Print[{{x},{y}}];
  f[x___,1,2,3];
  f[1,2,3,y___];
  f[x___,y___]:=0;
  Definition[f]
  Clear[f];
  f[x_,y_List,z___]:=Print["A ",{{x},{y},{z}}];
  f[x_,y__,z___]:=Print["B ",{{x},{y},{z}}];
  Definition[f]
  f[1,2,3]
  f[1,{2},3]
end
!
!  Replace in a pattern
  Clear[f,a];
  a=1;
  f[a_]:=Print[p:a->5];
  Definition[f]
  f[2]
end
!
!  Pattern
  Clear[a,b,c,d,e];
  MatchQ[a+b+a,p_+_+p_]
  MatchQ[a+b+a,p_+_+(p:_)]
  MatchQ[a+b+c,p_+_+p_]
  MatchQ[a+b+c,p_+_+(p:_)]
  Table[MatchQ[1+b,p:1+b],{10}]
  e=2;
  MatchQ[2,p:e]
  MatchQ[2,p:2]
end
!
!
   Clear[a,b,c,d,e,f];
  f[a_,d_,c___]:=b;
  f[c_,b[a_],e_]:=c;
  f[c_,b_]:=c;
  Definition[f]
!
! SEED, AXI, etc.
  SEED=33;
  SeedRandom[]
  AXI=-1;
  LINE["AX","^^^"]
  ins cal
end
!
!  WakeFunction
  WakeOptics[elm_:"$$$",opt___]:=Module[
    {def={Orbits->24,OffMomentumOrbits->1},z},
    {no,offm}={Orbits,OffMoemntumOrbits}/.{opt}/.def;
    no=Floor[no/2]*2;
    no1=no+1;
    z=SIGZ*Table[x/.FindRoot[Erf[x/Sqrt[2]]==i/(no/2+1),{x,0}],{i,1,no/2}];
    z=Join[-Reverse[z],z];
    zero=Table[0,{no}];
    InitialOrbits=Thread[{zero,zero,zero,zero,z,zero}];
    r=Cases[FFS["LWAKE TWAKE INS TRPT;FIT "//elm//
      " CAL AX AY BX BY DX DY DPX DPY DDP;CAL"][[4]],{elm,"",__},1];
    r=(#[[3]]->#[[4]])&/@r;
    gr=LINE["GAMMA",1]/LINE["GAMMA",elm];

    dx="DX"/.r;
    dxa=Plus@@dx/no1;
    ax="AX"/.r;
    bx="BX"/.r;
    gx=(1+ax^2)/bx;
    dpx="DPX"/.r;
    dpxa=Plus@@dpx/no1;
    sigxx=Plus@@(bx*EMITX*gr+(dx-dxa)^2)/no1;
    sigpxpx=Plus@@(gx*EMITX*gr+(dpx-dpxa)^2)/no1;
    sigxpx=Plus@@(-ax*EMITX*gr+(dx-dxa)*(dpx-dpxa))/no1;
    emixw=Sqrt[sigxx*sigpxpx-sigxpx^2];
    bxw=sigxx/emixw;
    axw=-sigxpx/emixw;

    dy="DY"/.r;
    dya=Plus@@dy/no1;
    ay="AY"/.r;
    by="BY"/.r;
    gy=(1+ay^2)/by;
    dpy="DPY"/.r;
    dpya=Plus@@dpy/no1;
    sigyy=Plus@@(by*EMITY*gr+(dy-dya)^2)/no1;
    sigpypy=Plus@@(gy*EMITY*gr+(dpy-dpya)^2)/no1;
    sigypy=Plus@@(-ay*EMITY*gr+(dy-dya)*(dpy-dpya))/no1;
    emiyw=Sqrt[sigyy*sigpypy-sigypy^2];
    byw=sigyy/emiyw;
    ayw=-sigypy/emiyw;

    {axw,bxw,emixw,dxa,dpxa,ayw,byw,emiyw,dya,dpya}];

  trpt ins;
  ca* 0;
  SIGZ=0.001;
  InitialOrbits={
    {0,0,0,0,-0.002,0},{0,0,0,0,-0.001,0},
    {0,0,0,0,0.001,0},{0,0,0,0,0.002,0}};
  lwake twake;
  WakeFunction[Longitudinal,"CA1"|"CA1.2"]=
    Thread[Thread[{{0,1},{0.001,0.5},{0.002,0.2},{0.003,0.1},{0.004,0.05}}]*{1,1e12}];
  WakeFunction[Transverse,"CA1"|"CA1.2"]=
    Thread[Thread[
      {{0,0},{0.001,0.1},{0.002,0.2},{0.003,0.3},{0.004,0.4},{0.005,.5}}]*{1,1e16}];

  r=WakeOptics[]
  dxi 0.003 dyi 0.003
  r=WakeOptics[]

end
!
!
!  Gamma Functions & Error Functions
  GammaRegularized[3,5]
  GammaRegularized[3,.1]
  Erf[0.5]
  Erfc[0.5]
  Gamma[3,5]
end
!    array operations
   a={1,2,3,4,5}*2
   Print[a];
   a=ARRAY[2,2];
   a=a+1
   a1=2/a
   a2=(a+2)/3
   ArcTan[a1,a2]
   {a,b,c}={1,2,3};Print[a, b, c];
   a=Table[i*10+j,{i,4},{j,4}];
   Length[a]
   Dimensions[a]
   Print[a[{2,3},{2,3}]];
   Clear[a,b,c,d,e];
   a=b*c+d;
   Print[a[0]];
   a=Table[Exp[I Pi/8 m],{m,0,7}]
   Log[a]/Pi
end

!
!  InitialOrbits
  InitialOrbits={{0,0,0,0,0,0.003},{0,0,0,0,0,-0.003},{0.01,0,0,0,0,0}};
  FitWeight[x___]:=Print["FitWeight: ",{x}];
  FitValue[x___]:=Print["FitValue: ",{x}];
  cal
end
!
! MinMax
  ll=Partition[ll=Table[Random[],{1000}],2];
  Timing[Do[With[{t=Thread[ll]},Thread[{Min/@t,Max/@t}]],{1000}]]
  Timing[Do[Thread[{MapThread[Min,ll],MapThread[Max,ll]}],{1000}]]
end
!
!
   Clear[a,b,c,d,e,f];
   f[a_,b_,c__]:=Print[{a,b,{c}}];
   f[0,1,d[2]]
end
!
!  AppendTo
  Clear[a,b,c,d,e];
   a=b[1,2,3];
  AppendTo[a,4]
   a
  PrependTo[a,0]
end
!
!
  Clear[a,b,c,d,e];
  (a=.)^:=Print["OK"];
  a=2
  a=.
  a
  Clear[a];
  (#=1)&[a]
  a
  Clear[a];
  (b[#]=3)&[a]
  (f[b[a]]^=1)
  Definition[b]
  Clear[b[a]]
  Definition[b]
end  
!Clear[a,b,c,d,e];
!
!  TclWidget
   PyEval[""];
   Py$Echo=1;
   w=Window[Title->"Test"];
   b=Button[w,Text->"abc"];
   b[Update];
   TclWidget[b,"configure",Text->"def"]
   b[Update];
end
!
!
   System["ls -lt>a"];
   f=OpenRead["a"];
   s=ReadString[f];
   s="";
   l={};
   While[(s=ReadString[f])<=>EndOfFile,
     l=Append[l,s[42,-1]]];
   PyEval[""];
   Py$Echo=1;
   w=Window[Title->"Test"];
   fr2=Frame[w];
   vsb=ScrollBar[fr2,Orient->"vertical",Side->"right",Fill->"y"];
   lb=ListBox[fr2,Insert->{"end",l},BG->"white",Width->30,
     SelectMode->"single",YScrollCommand:>vsb[Set]];
   vsb[Command]:=lb[YView];
   AdjustWindowGeometry[w];
!   Py$Echo=1;
   BindWidget[lb,"<Double-Button-1>",Print[
     lb[GetText[lb[Selection][[1]]]]]];
   lb[Focus$Reset];
   PyWait[];

   w=Button[Text->"New w"]
   w[Update]

end
!
!
  Clear[a,b,c,d];
  d=1;
  f:=StandardForm[Module[{d},Print[d]]];
  f
  d
  DateString
  d
end
!
!  ListPlot with ErrorBar
   PyEval[""];
!   Py$Echo=1;
   w=Window[Title->"Test"];
   c=Canvas[w,Width->936,Height->550];
   $DisplayFunction=CanvasDrawer;
   Canvas$Widget=c;
   Canvas$WindowOffset={0,2};
   ListPlot[{{1,2,1},{2,4,2},{3,5,1.5},{4,4,0},{5,1,0.0001}}];
   c[Update];
end
!
!  Override
   Clear[a,b,c,d,e];
   Override[
     {a->1,b->2,c:>4,a->3},b->3,{c->2,d->4},{a->2,b:>3}]
   end
!   While[1,Sleep[0.5];Print[DateString];Sleep[2]];
   Print[DateString];Print[Timing[Pause[0.9]]];
   Print[DateString];
end
!
!  Generations
  Module[{a},Print[{a,Definition[a]}];a$1=2;a$0=3;Print[a]];
end
!
!  OpticsProlog
   OpticsProlog:=(Print["Optics Calculation Begin"]);
   OpticsEpilog:=(Print["Optics Calculation End"];Return[]);
   fit nx .4 free q* go
end
!
!  
   Clear[a,b,c,d,e];
   a=b=c=Table[i,{i,10000}];
   a[[-1]]=0
   c[[-1]]="a"
   Timing[Do[a===b,{1000}]]
   Timing[Do[a===c,{1000}]]
end
!
!

   c[AddTag$Closest]=Flatten[{'QFtag',
     Canvas$Coord[{(LINE["S","QF"]+LINE["S","QF+1"])/2,0}]}];
   BindWidget[c,"<Enter>",Print["OK"],Tag->"QFtag"];
!
!  With
  Clear[a,b,c,d,e,f,x];
  g[y_]:=y^2;
  x=0;
  With[{b[z_]:=g[z]},
    f[x_]:=(Print[x];b[x+1])];
  df=Definition[f]
  x=0;Module[{x=2},{x,df[[1,2,2,1,2]]}]
  Module[{x=3},{x,f[x]}]
  x=0;Module[{x=3},{x,f[x]}]
  Clear[f];
  With[{b:=g},
    f[x_]:=b[x+1]];
  df=Definition[f]
  x=3;Module[{x=2},{x,df[[1,2,2,1,2]]}]
  Module[{x=3},{x,f[x]}]
end
   
!
!  Plus
   Timing[a=0;Do[a=a+i,{i,50000}]]
   Timing[a=0;Do[a=a*i/10000,{i,50000}]]
end
!  ExternalMap["TRACK",LINE["POSITION","P1"],nt_,x_]:=(Print[nt,x];x*2);
!  ExternalMap["TRACK",LINE["POSITION","P1"],nt_,x_]:=Module[{p,p1,wbn},
!    n=n+1;
!    wbn=wb[n];
!    p=x[6];p1=Map[If[#<wbn+hcbd && #>wbn-hcbd,#-cband,#]&,p];
!    Print[p];
!    ReplacePart[x,p1,6]];
  ExternalMap["TRACK",LINE["POSITION","P1"],nt_,x_]:=Module[{},
    xf={xf,x};Print[MemoryCheck[]];x];
  n=0;
  wb[n_]:=wstart-n*(wend-wstart)/nturn;
  wstart=0.1;
  wend=0.0001;
  nturn=10000;
  cband=1e-4;
  xf={};
  Print[MemoryCheck[]];
  Do[d=TrackParticles[d,1],{3}]
  Print[MemoryCheck[]];
  Clear[xf];
  Print[MemoryCheck[]];
  xf={};
  Do[d=TrackParticles[d,1],{3}]
  Clear[xf];
  Print[MemoryCheck[]];
  xf={};
  Do[d=TrackParticles[d,1],{1000}]
  Clear[xf];
  Print[MemoryCheck[]];
end

  np=5;
  x=Table[0,{7},{np}];
  Do[x[7,i]=1,{i,np}];
  sigp=0.01;
  x[6]=Table[GaussRandom[]*sigp,{np}];
  d={1,x};
  TrackParticles[d,1]
end
!
!  Module
  Module[{{a,b}={1,2},c=3,d},Print[{a,b,c,d}]]
end
!
!  With
   Clear[f,x];
   With[{Pi,Sin[1],Cos},f[x_]:=Pi*x+Sin[1]+Cos[x]];
   g[x_]:=Pi*x+Sin[1]+Cos[x];
   Definition[f]
   Timing[Do[f[2],{10000}]]
   Timing[Do[g[2],{10000}]]
   Module[{Cos=aa},{f[2],g[2]}]
   With[{a=1},a+1]
   Clear[f];
   With[{f[x_]:=(Print[x];ToString[x])},f[x+y]]
end
!
!  Table
  Table[Null[],{3}]
  Timing[Table[i*100+j,{i,100},{j,100}]]
  Timing[Sum[i*100+j,{i,100},{j,100}]]
  Timing[Product[i*100+j,{i,100},{j,100}]]
end
!
! $FORM
  $FORM='10.7'
Pi
Pi/1e8
Pi/1e9
Pi/1e10
-Pi
-Pi/1e8
-Pi/1e9
-Pi/1e10
end
!
!  Part, SetPart
  Clear[a,b,c,d,e];
  LINE["K1","QF"]=0.2
  LINE["K1","QF"]
end
  a=Table[i*10+j,{i,5},{j,3}];
  Map[(Print[#[2]];#[[2]]=0)&,a]
  a
  a=Table[i*10+j+c,{i,5},{j,3}];
  Map[(Print[#[2]];#[2]=0)&,a]
  a
end
  a=Table[i,{i,5}];
  b=a;
  a[3]=0;
  Print[{a,b}];
  a=Table[i*10+j,{i,3},{j,4}]
  b=a;
  a[3,3]=0;
  Print[{a,b}];
  (a[3,3]=c_)^=0.1;
  Definition[a]
  a[3,3]=2
  a[3,3]
end
!
!    Set:
   Clear[a,b,c,d]
   a=2.5
   Write[6,a]
   b=0.5;c=0.6
   d=3.2
   Print[a+b,c+d];
   {a,b,c}=1
   {a,b,c}={1,2,3}
   {a,b}={1,2,3}
   {}=1
   {}={1}
   {}={}
end
!
!  Plot
  Clear[x,y,z];
  Plot[Print[x];Cos[x],{x,-Pi,Pi}];
  y=Cos[x];
  Plot[y*x,{x,-Pi,Pi}];
  x=1;
  Plot[y*x,{x,-Pi,Pi}];
  Plot[{Sin[x],Cos[x]},{x,-Pi,Pi}]
end
!
! Set, etc.
  Clear[a,b,c,d,e,f];
  a={1,2,3,4,5};
  a[[2]]=0;
  a[4]=-1;
  a
  Clear[a];
  a[5][6]=-2
  a[5][6]
  Clear[a];
  f[x_]:=(x=1);
  f[a];
  a
  Clear[a]
  (#=1)&[a]
  a
  a={1,2,3,4,5};
  (#[2]=-2;#[[4]]=-4)&[a]
  a
end
 
!
!  Set
   Clear[c];
   c[3]=4;
   c[3]
   (c[1][i_]=x_)^:={i,x};
   c[1][3]=4
   c[2][x_]:={x}
   c[2][10]
end
!
!
   Clear[a,b,c,d,e,f];
   a=Range[1,10];
   Do[a[3]=i,{i,1,5}];
   a
   Do[Range[1,10][3]=i,{i,1,5}];
   Do[{1,2,3,4,5,6,7,8,9,10}[3]=i,{i,1,5}];
end
!
!  Releasing memory
  Clear[a,b,c,d,e,f];
  check[e_,r_]:=If[e<=>r,Print[e," ",MemoryCheck[]];FFS["ABORT"]];
  a="a";
  e:=Module[{},a=a//"b"];
  check[f[e,e,e],f["ab","abb","abbb"]];
  b={"a"};
  e:=Module[{},b[1]=b[1]//"b"];
  check[f[e,e,e],f["ab","abb","abbb"]];
  Clear[b];
  b[1]="a";
  e:=Module[{},b[1]=b[1]//"b"];
  check[f[e,e,e],f["ab","abb","abbb"]];
  Clear[b];
  b={"a"};
  e:=Module[{},b=ReplacePart[b,b[1]//"b",{1}];b[1]];
  check[f[e,e,e],f["ab","abb","abbb"]];
  e:=Module[{aa={"a"}},aa[1]=aa[1]//"b"];
  check[f[e,e,e],f["ab","ab","ab"]];
!
!  Define
  Clear[a,b,c,d,e,f];
  f[1]=2;
  f[2]=3;
  f[3]=4;
  Definition[f]
  f[x_]=5;
  Definition[f]
  f[3]
  Definition[f]
  f[5]
  Definition[f]
  f[1]
  Definition[f]
  f[x__]=6
  f[1,2]
  Definition[f]
end
!
!  ToString
  Print[ToString["\""]]
  Print[ToString["\"",FormatType->InputForm]]
end
!
!  Increment
  Clear[a,b,c];
  a=1;
  a++
  ++a
  1+(++a)
  a={1,2,3}
  a++
  a
end
!
!  ReplaceRepeated
  Clear[a,b,c,d,e]
  {a,b,c}/.{a->b,b->d}
  {a,b,c}//.{a->b,b->d}
end
!
!  Repeated, RepeatedNull
  Clear[a,b,c,d,e,f];
  f[_..,a_,_..]:=Print[a];
  f[1]
  f[1,2]
  f[1,2,3]
  f[1,2,3,4]
  Definition[f]
end
  Clear[f];
  f[a_..]:=Print[a];
  f[1,1,1];
  f[1,2,3]
  Clear[f];
  f[a_..,b_...]:=Print[{a,b}];
  f[1,1,2]
  f[1,2,2]
  f[1,1,1]
  f[]
  f[1]
end
!
!  Apply Const.
  {1,2,3,4}@@3
  {1,2,3,4}/@{2}
end
!
!  Times, etc.
  Clear[a,b,c];
  pri "abc"*a
  pri "abc"*2
end

!
!  AddTo, etc.
  Clear[a,b,c,d,e];
  a=3;
  a+=2
  a
  a/={3,4,5}
  a
end
!
!  Relations
  Clear[a,b,c]
  pri 1<2
  pri 1<{2,3}
  pri {1,2}<{3,1};
  1<2<3
  1<2===2
  pri   1<2<>a
  pri   1<2<=>a
  (1<2<3)+0
  pri a<b<c
  pri 1==2===0
  pri (1==2)===0
end
!
!  FFS$Status
!FFS$Status
!end
!
!    Pure functions
   Clear[a,b,c,d,e,f];
   Print[#+#2&[a,b]]
   (f[a,##]&)@@{b,c,d}
   Print[Function[{x,y},x+y][a,b]]
   a={1.,2.};
   (ArcTan[#,#2]&)@@a
   Timing[Do[(ArcTan[#,#2]&)@@a,{10000}]]
   Function[{x,y},ArcTan[x,y]]@@a
   Timing[Do[Function[{x,y},ArcTan[x,y]]@@a,{10000}]]
   Print[#+#2&[1,2]];
   a={1,2,{3,{4,5}}}
   Sin[#]&/@a
   c=1;(#=#2)&[c,d]
   a={1,2,3,4,5};#[3]&[a]
   MemoryCheck[];
end
!
!  Head, Definition
  Clear[a,b,c,d,e]
  Head[Sin]
  Head[Sin[a]]
  Head[Pi]
  Head[{1,2,3}]
  Head[Plus]
  Head[I]
  Head[a_]
  Head[a+b]
  MatchQ[{1,2,3},a_List]
  Definition[Element]
  Definition[1,Sin,Sin[1],1*2,a*b+c]
end
!
!    Module and Block
   Clear[a,b,c,d,e];
   a=1;Module[{a=2,b,c},Module[{a},Print[a];a=3;b[x_]:=4;(c[x_]=y_)^=0.1];
     Print[a];Definition[b,c]];Print[MemoryCheck[1]];Print[a];Definition[b,c]
   a=-1;b=-2;c=-3;
   Print[Module[{a,b,c=3},a=1;b=2;a+b]];
   Print[Block[{a,b,c=3},a=1;b=2;a+b+c]];
   Print[a,b,c];
   Clear[f];
   f[x_]:=Module[{a,b,c},a];
   f[1]
   f[x_,y_]:=Module[{a,b,c},
     a=Cos[y];
     b=Sin[1];
     c=a+b]
   a=1;b=2;c=3;
   Print[f[1,2],' ',a,' ',b,' ',c];
   mm:=ii^2;
   Print[Module[{ii=aaa},mm+ii]];
   Print[Block[{ii=aaa},mm+ii]];
   Print[Definition[SymplecticJ]];
   SymplecticJ[4]
end
!
!  Replace
  Clear[a,b,c,d,e];
  Print[a/.((b_)->2*b)]
  Print[a/.((p:b_)->2*b)]
end
!
!  ToExpression
  Clear[a,b,c,d,e,f];
  Module[{f=Range[1,5]},
    i=1;While[i<5,
    ToExpression["f[i]:=-1"];
    Print[f];i=i+1]];
end
!
!  Define
  Clear[a,b,c,d,e,f];
  Module[{a=Range[1,10]},
  (a[2]=b_)^:=Print[Sqrt[b]];
  Print[{a[1],a[2],a[2]=a[2],a[1],a[2]}]];
end
!
!
! Upset
   Clear[a,b,c,f];
   b=a;
   Unevaluated[c=b]
   f[x__]:=Hold[x];
   f[Unevaluated[c=b],1]
   Clear[f];
   f[x__,1]:=Hold[x,1];
   f[Unevaluated[c=b],1]
   UpSet[Unevaluated[c=b],1]
   Definition[a,b,c]
end
   (Unevaluated[c=b])^=1;
   Definition[a,b,c]
   Clear[a,b,c];
   b=a;
   (c=b)^=2;
   Definition[a,b,c]
end
   Clear[f,g,h]
   Sin[g]^=1;
   Sin[g]
   Sin[g[f]]
   Sin[g[f]]^=3;
   a=5;
   Sin[g[h,h]]^:=a+1;
   a=3;
   Sin[g[h,h]]
   Definition[g]
   Clear[f,g];
   f[g]=2;
   f[g]^=3;
   f[g]
   Clear[f];
   (f[x_]=y_)^=4;
   f[2]=3
   Clear[f,g];
   Protect[f,g];
   f[g]=2;
   f[g]^=2;
   f[g]
   Unprotect[f,g];
end
!
! Alternatives
Clear[a,b,c,f,x,r];
  {a[2],b[3],c[4],a[5]}/.(f:(a|b))[x_]->r[f,x+10]
end
!
!
! Gamma
  Do[Print[Gamma[i]," ",LogGamma[i]],{i,-10.5,10.5,0.5}];
end
!
!  Fit
   FitFunction:=(Table[0,{1000000}];
     {Twiss["BX","***"]-30,Twiss["BY","***"]-30});
   free q*
   go
end
!
!  RENUMBER
  renum qf.2 disp
end
!
!  Tcl/Tk
!   Get["/users/oide/WORK/oldsad/Packages/Tk.n"];
  OpenTk;
  x=0.1
SAD$Tk$fn=6;
  CreateWindow["trans",OverrideRedirect->True,Position->{100,200},
    Pack[Message[Name->"mess2",Text->"This is a message."]]];
end
  WithdrawWindow["trans"];
  CreateWindow["test",
    Pack[
      Button[Text->"OK",Command->Print["OK"],
      Name->"OK",BackGround->"green"],
      Title[Name->"title",Variable->x],
      Pack[
         Title[Name->"title1",Text->"a"],
         Entry[Name->"entry",Variable->en,Width->7],Side->"left"],
      Side->"top"],
    Pack[Button[Text->"Apply",Command->"apply",Name->"Apply"],
      Frame[Name->"fr",Relief->"ridge",
        BackGround->"red",BorderWidth->4,
        Pack[
        Button[Text->"?",Name->"help1"],
        Button[Text->"Not Apply",Command->Print["Not Apply"],
          Name->"NOAPPLY"]]],Side->"top"],
    Pack[Message[Name->"mess",Text->"This is a test of SAD/Tk/Tk.",
      Width->"5c"]],
    Pack[
      Table[CheckButton[Name->"cb"//ii,Text->"status-"//ii,
        Variable->y[ii]]/.ii->i,{i,1,3}],Side->"right"],
    Pack[RadioButton[Name->"rb",Text->"select",Variable->z,Value->"aaa"],
      Frame[Name->"mbar",Relief->"raised",
        Pack[
          MenuButton[Name->"SAD",Text->"SAD",Underline->0,
            Menu[Button[Text->"GO",Command->(c="GO")],
              Message[Text->"...",Name->"m1"],
              Cascade[Text->"Command",
              Menu[Button[Text->"CAL",Command->(c="cal")]]],
              Separator[],
              CheckButton[Text->"CELL",Variable->cellf],
              RadioButton[Text->"TRACK",Variable->trk,Value->"TRACK"]]],
           Side->"left"]],
      ListBox[Text->{"a","b","c","d","e"},Name->"lb",YScroll->True,
        Variable->lb,BorderWidth->2,SelectMode->"extended"],
      Side->"bottom"]];
  x=DateString;
  BindWidget["test.OK","Enter",Print[$x,$y,$W,$K,$A]];
  BindWidget["test.OK","Any-KeyPress",Print[$x,$y,$W,$K,$A]];
  BindWidget["test.fr.help1","Button-1",RedrawWindow["trans"]];
  BindWidget["test.fr.help1","ButtonRelease-1",WithdrawWindow["trans"]];
  FocusWidget["test.OK"];
!  Write[SAD$Tk$fn,".test.menua post 100 100"];Flush[SAD$Tk$fn];
!  System["sleep 5"];
!  Write[SAD$Tk$fn,".test.menu unpost 100 100"];Flush[SAD$Tk$fn];

  While[c=Read[Tk$SAD$fn,String];c<=>EndOfFile,Print[c];ToExpression[c]];

!!!   bind .test.lb <Shift-ButtonRelease-1> {puts \{\"[join [selection get] "\",\""]\"\}}
end
!
! Element
  Element["K1","AA"]=0.1
  Element["LENGTH"]
  Element[LENGTH]
  Element["NAME"]
  Element["POSITION"]
  Element["TYPE"]
  Element["KEYWORDS"]
  Element["DEFAULT"]
  Element["VALUE"]
  Element["ROTATE"]
  Element["ROTATE","QF"]
  dk 0.01 q*;
  Element["K1","QF"]=0.1
  Element["K1","QF"]
  LINE["K1","QF.*"]
  Element["L","QF"]=2
  Element["L","QF"]
  LINE["L","QF.*"]
  Unprotect[Element];
  Definition[Element]
  MemoryCheck[]
  Element[x___]=.
  Definition[Element]
end
!
!  Components as variable
!
  free QF.1 QF.2
  free Q*
  var
  fix QF.2
  var
  qf.2 0.1
  LINE["K1","QF.2"]
  cal nx ny cal noexp
  reset
  fix *;
  var
  disp qf.2
  free qf.2
  fit nx .55 
  cal noexp
  LINE["K1","QF.1"]
  LINE["K1","QF.2"]
  coup qf.2 qd.2 -1
  var
  fix *;free qf
  var
  free qf.2
  var
  coup qf qf 1
  var
end
!
!  COD correction by GO
  delx 1e-3 q*;
  fit qf dx 0 fit qd dx 0 fit qf.2 dx 0 fit qd.2 dx 0
  fit qf dy 0 fit qd dy 0 fit qf.2 dy 0 fit qd.2 dy 0
  free b*.* k0
  cal noexp
  out 'a' draw dx & dy q* term out tdr 'a'
  maxi 1
  go noexp
  out 'a' draw dx & dy q* term out tdr 'a'
end

  

!
!    Inverse, Det
   a=Table[Random[],{i,100},{j,100}];
   Max[Abs[a.Inverse[a]-IdentityMatrix[100]]]
   a={{1,I},{I,1}};
   Det[a]
   a.Inverse[a]
   a=Table[Random[],{i,100},{j,100}];
   Det[a]
   1-1/Apply[Times,SingularValues[a][2]]/Det[a]
   Timing[Inverse[a];]
   Timing[Det[a];]
   a=a+I*Table[Random[],{i,100},{j,100}];
   Timing[Det[a];]
end
!
!  Obsolete symbol
  Clear[f,g,a,b,c,d,e];
  MemoryCheck[1]
  Module[{a},a];
  MemoryCheck[1]
  Table[i,{i,10}]
  MemoryCheck[1]
  Table[i,{i,10},{i,10}]
  MemoryCheck[1]
  b=a;
  Evaluate[b]=3;
  Definition[a,b]
  b=Module[{a},a];
  Definition[b]
  Evaluate[Module[{d},d]]=1;
  Definition[d]
  e[1]=2;
  Module[{e},e][1]
  Definition[e]
  Module[{e},a={e,e};]
  a[1,1]
  Map[#[1]&,a]
  f[Hold[x_]]:=x[1];
  f[HeldPart[a,1]]  
end
!
!   TableForm
!   a=Table[i*10+j,{i,5},{j,8}];
!   TracePrint[TableForm[a]]
!   TableForm[{1,2,3}]
!end
!
!  Define
  Clear[f,x,a,b,c];
  Timing[Do[f[i*x_]=i,{i,1000}]]
  Timing[Do[f[i x],{i,1000}]]
  Clear[a,f];
  a=Table[0,{1000}];
  Timing[Do[a[i]=i,{i,1000}]]
  Timing[Do[f[i]=i,{i,1000}]]
 Print[{MemoryCheck[1],TimeUsed[]}];
!
!  Evaluate, ReleaseHold
  Clear[a,b,c,d,e];
  a[d]:=e;
  SetAttributes[a,HoldAll];
  c=d;
  a[c]
  a[Evaluate[c]]
  a[a[Evaluate[c]]]
  a[Evaluate[a[Evaluate[c]]]]
  Clear[x,y,z];
  Print[ReleaseHold[Hold[x]+Hold[y+Hold[z]]]];
  f[1]=1;
  Definition[f]
  g[x_]:=Module[{f=x[1]+1},Print[{f,x[1]}]];
  g[f]
  Definition[f]
  f[1]
end
!
!    Throw and Catch
  Clear[f]
  f[x_]:=If[x>5,Throw[big],x^2];
  Print[Catch[f[3]]];
  Print[Catch[f[10]]];
  MemoryCheck[1]
  Catch[Throw[]]
  MemoryCheck[1]
  Catch[Throw[1.5]]
  MemoryCheck[1]
  Throw[1]
  MemoryCheck[1]
end
!
!    Timing, TimeUsed
  TimeUsed[]
  Clear[a,b,c,d,e,f];
  Timing[Do[,{100000}]]
  Timing[Do[1,{100000}]]
  Timing[Do[a,{100000}]]
  Timing[Do[a;1,{100000}]]
  Timing[a=1;Do[a,{100000}]]
  Timing[a=1;Do[Identity[a],{100000}]]  
  f[1]:=1;
  Definition[f]
  Timing[a=1;Do[f[a],{100000}]]  
  Clear[f];f[x_]:=x;
  Timing[b=2;Do[f[b],{100000}]]  
  Timing[Do[a=1,{100000}]]  
  Timing[Do[a=b,{100000}]]  
  Timing[b=1;Do[a=b,{100000}]]  
  Timing[b=1;Do[a=b+1,{100000}]]  
  Timing[Do[a={};Do[a=Append[a,i],{i,100}],{100}]]
  Print[a];
  Timing[Do[a={};Do[a={a,i},{i,100}];Flatten[a],{100}]]
  Timing[Do[Flatten[a],{1000}]]
  a=Flatten[a];
  Timing[Do[Take[a,50],{10000}]]
  Timing[Do[Drop[a,50],{10000}]]
  Timing[Do[Append[a,1],{10000}]]
  MemoryCheck[1]
  GarbageCollect[];
  MemoryCheck[1]
end
! 
! Plot a defined function
  Clear[f,dp];
  f[dp_]:=Module[{},FSHIFT=-dp*2];
  Plot[{dp,f[dp]},{dp,0,2}]
end
!
!   SPLIT
   SPLIT QF 0.05
   MemoryCheck[]
   cal
end
!
! Expression handling
   Clear[a,b,c,d,e];
   Print[-1*(2*a)]
   Print[-(2*a)]
   Print[-(-a)]
   Print[-(-2 a)]
   Print[-(-2 a b)]
   Print[1/(1/a)]
   Print[1/a]
   Print[a*1]
   Print[a*(-1)]
   Print[(a+b)+0]
   Print[2*(-a)]
   Print[-1*(-a)]
end
!
!  BeamMatrix
!
   BeamMatrix[10]
   BeamMatrix[10.3]
   BeamMatrix[11]
end
!
!    built-in functions
   $FORM='M';
   Print[Tan[Pi/4], Cos[1], Sin[1], Tanh[1], Cosh[1], Sinh[1]];
   print Exp[1] Log[(1+1)*2-3] ArcTan[1] ArcTan[1,2] Sqrt[2]
   print ArcSin[1] ArcCos[1] ArcSinh[1] ArcCosh[1] ArcTanh[0.5]
   print Floor[-1.2] Ceiling[1.2] Min[1,2,3] Max[1,2,3] Mod[5,2]
   s='Pi='//Pi//' Speed of Light='//SpeedOfLight
   print 'This is a test... ' 1*2+(3.+.1*5)*2//s
   print s[1] '-' s[2] '-' s[3,100]
   print s
   print s[Index[s,'3.14'],Len[s]-1]
   Random[]
   pri Sin[I] Cos[I] Exp[I] Log[I] Sqrt[I] Abs[I]
end
!
!  Rectangle
  p1=Plot[Sin[x],{x,0,2Pi},DisplayFunction->Null];
  p2=Plot[Cos[x],{x,0,2Pi},DisplayFunction->Null];
  Show[Graphics[{Rectangle[{0,0},{1,0.5},p1],
    Rectangle[{0,0.5},{1,1},p2]}]];
end
!
  Plot[Twiss["BX",s],{s,1.001,10}]
end

!
!  Flags
  ?CELL ,  ?RING , ?ABC
  ?cell
  rep 3 Print["OK"] until ?conv
end
!
!   Identity
  Identity[{1,2,3}]
  Length[Identity[{1,2,3}]]
  a=Identity[{1,2,3}];
  a
  Identity[1,2,3]
end
!
!  Cases
  NetMemory:=Flatten[{#,#[1]-#[2]}&[MemoryCheck[]]];
  Clear[a,b,c,d,e];
  Clear[cases];
  NetMemory
  cases[{1,2,3,4,5},3,1]:=1;
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[_],_,___]:=1;
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[__],_,___]:=1;
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[___],_,___]:=1;
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_,opt___]:=1;
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_,opt___]:={l,l,p,opt};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={l,l,p,opt};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={[l],[l],p,opt};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={{{l},#}&,{l,p,opt}};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={{{l},#}&,{[1,2,3,4,5],p,opt}};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={{{l},#}&,{{[1,2,3,4,5]},p,opt}};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={{{l},#}&,{{l},p,opt}};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
end
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={{{[l]},#}&,{{[l]},p,opt}};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:={{{Unevaluated$[l]},#}&,{{Unevaluated$[l]},p,opt}};
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:=Unevaluated$[Unevaluated$[{Unevaluated$[l]},#]&,Unevaluated$[{Unevaluated$[l]},p,opt]];
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Clear[cases];
  NetMemory
  cases[_[l___],p_->r_,opt___]:={l,l,p,opt};
  cases[_[l___],p_,opt___]:=Map[Apply[{Unevaluated$[l]},#]&,
    Position[{Unevaluated$[l]},p,opt]]
  TracePrint[cases[{1,2,3,4,5},3,1]]
  Timing[Do[cases[{1,2,3,4,5},3,1],{10000}]]
  Timing[Do[a/.a->1,{10000}]]
  Timing[Do[a/.a_->1,{10000}]]
end
  Cases[{1,2,3,4,5},3,1]
  Timing[Do[Position[{1,2,3,4,5},3,1],{10000}]]
  Timing[Do[Position[{Unevaluated$[[1,2,3,4,5]]},3,1],{10000}]]
  Timing[Do[Map[b,Position[{Unevaluated$[[1,2,3,4,5]]},3,1]],{10000}]]
  Timing[Do[Map[b&,Position[{Unevaluated$[[1,2,3,4,5]]},3,1]],{10000}]]
  Timing[Do[Map[{Unevaluated$[[1,2,3,4,5]]}&,Position[{Unevaluated$[[1,2,3,4,5]]},3,1]],{10000}]]
  Timing[Do[Map[Apply[{Unevaluated$[[1,2,3,4,5]]},#]&,Position[{Unevaluated$[[1,2,3,4,5]]},3,1]],{10000}]]
  Timing[Do[Cases[{1,2,3,4,5},3,1],{10000}]]

end
!
!  SameQ
  1===1
  SameQ[1,1]
end
!
!    Dot, Inner
   a={1,2,3,4,5};   b={5,4,3,2,1};
   Print Dot[a,b]
   Print Inner[#-#2&,a,b,#+#2&]
   a={{0,1},{-1,0}};
   Print Dot[a,a] a.a
   a=Table[i*100+j,{i,100},{j,100}];
   b=Table[i*100+j,{i,100},{j,100}];
   Timing[a.b;]
   a=Table[i,{i,100}];
   Timing[Do[2.*a,{10000}]]
   Timing[Do[a.a,{10000}]]
   Timing[Do[Inner[Times,a,a,Plus],{100}];]
end
!
! Part
  Clear[a,b,c];
  {Print[a];1,Print[b];2}[[2]]
  {a,b,c}={1,2,{3,4}};
  Print[{a,b,c}];
end
!
!    Replace
  Clear[a,b,c,f,x];
  Print[1/.x_->f[x]];
  Print[a+b/.b->2];
  Print[a+b/.{a->3,b->4}];
  b=3;
  r1=a->b;
  r2=a->c;
  r=a:>b;
  s:=b;
  b=5;
  a/.r1
  a/.r2
  s
  a/.r
end
!
!  Evaluate
  Clear[f,g,h,a,x];
  Definition[Evaluate];
  f[x_]:=x+1;
  f[1]=0;
  a=1;
  SetAttributes[f,HoldAll];
  f[a]
  f[1]
  TracePrint[f[Evaluate[a]]]
  Clear[f,g,a];
  SetAttributes[f,HoldAll];
  g[1]=0
  f[g[a]]/.a->1
end
!
! Set, Power
Clear[a,b,c];
  a=b=1;
  Definition[a,b];
  2^3^2
end
!
!  Unset
  Clear[a,b,c,d,f]
  c=3;
  c=.;
  c={a,a=.;a,{a,2},a=.;1}
  MemoryCheck[]
  Print[c];
  f[a]=1
  f[b]=2
Definition[f]
  f[a]=.
Definition[f]
end
!
!  FFSFlags
  FFSFlags[]
end

!
!   FFS functions
  Twiss['*',{1,5}]
  betax=Sqrt[Twiss[{'BX','BY'}]]
  Twiss["BX","Q*"]
  types=LINE['TYPE',"Q*"]
  k0s=LINE['ANGLE',"B*"]
  eles=LINE['POSITION','Q*']
  LINE['K1','QF.1']
  LINE['K1','QF.1']=0.2;
  LINE['K1']
  LINE["DIR"]
  LINE["DIR","QF"]=-1
  disp
  LINE["GEO"]
  LINE["GEO","QF*"]
end
!
! Read
   i=OpenRead["/data/mrdata/onepass/DEC895_23_23.adc"];
   Timing[
   b={};While[a=Read[i,Real];a<=>EndOfFile,b={b,a}];
   Length[Flatten[b]]]
   Timing[Length[Flatten[b]]]
   MemoryCheck[]
   Close[i];
   i=OpenRead["/data/mrdata/onepass/DEC895_23_23.adc"];
   Timing[
   b={};While[a=Read[i,Real];a<=>EndOfFile,b=Append[b,a]];
   Length[b]]
end
!
!  Read
  Clear[a,b,c,d,e,f];
  f:=(s=Read[-1,Word,ReadNewRecord->False];Print["arg = ",s];WriteString[6,"More? "];
    s=Read[-1,Word];t=Read[-1,Word,ReadNewRecord->False];Print["arg = ",s," ",t]);
  f abc
def
ghi
end
  
!
!
  a=Table[Random[],{i,100},{j,100}];
  Timing[Do[SingularValues[a],{10}];]
end
!
!
 Table[0,{2},{2}]
 TracePrint[SymplecticJ[2]]
 Table[0,{2},{2}]
!
!
   Clear[f];
   f[x___]:=Module[{def={A->1}},
      Print[A/.{x}/.def]];
   f[A->2]
end
!
!   Switch, Which
  Do[Print[Switch[i,1,"a",2,"b",3,"c",_,"z"]],{i,5}]
  Do[Print[Switch[i,1,"a",2,"b",3,"c"]],{i,5}]
  Do[Print[Which[i==1,"a",i==2,"b",i==3,"c",True,"z"]],{i,5}]
  Do[Print[Which[i==1,"a",i==2,"b",i==3,"c"]],{i,5}]
end
!
!  Map, MapThread
  Clear[a,b,c,d,e,f];
  a=Range[1000];
  f[a_,b_]:=Module[{d},Thread[Apply[d,b]]/.d->a];
  Timing[Do[f[c,{a,a}],{10}]]
  Timing[Do[MapThread[c,{a,a}],{10}]]
  Timing[Do[Map[c,a],{10}]]
  Timing[Do[Map[Sin,a],{1000}]]
  Timing[Do[Map[Identity,a],{1000}]]
end
!
!   Illegal store
  qf0=#QF;
  Element["VALUE","QF"]=0.1
  Element["VALUE","QF"]='a'
  #QF=qf0
  #QF='a'
  Do[i='a';Print[i],{i,2}]
end
!
!   TracePrint,Definition
  Clear[a,b,c,f]
  TracePrint[a=1;b=2];
  f[a_]:=Module[{},a*2;a*4];
  Definition[f]
  TracePrint[f[2]];
  Definition[Sin,Pi,c,SymplecticJ,x_,1.22,"aaa",Function]
end
!
!
   Clear[f,x,y,g];
   f[x_]:=x;
   f[2]
   f[x_]=x;
   f[2]
end
!
!  Definition
   Clear[f,g,h]
   f[1]=3;
   MemoryCheck[]
   g=f;
   Definition[f,g]
   g[1]=4;
   Definition[f,g]
   f=.;
   Definition[f,g]
end
!
! LINE
  dk 0.01 q*;
  LINE["LENGTH"]
  LINE["POSITION"]
  LINE["NAME"]
  LINE["TYPE"]
  LINE["ELEMENT"]
  LINE["DIR"]
  LINE["S"]
  LINE["GEO"]
  LINE["DK"]
  LINE["ROTATE"]
  LINE["ROTATE","QF.*"]
  LINE["K1","QF"]=0.1
  LINE["K1","QF"]
  Element["K1","QF"]
end
!
  Clear[f,g,h]
   f[1]=1;
Print[g->f,g->h]
Definition[f,g]
end
!
!   Complex array
   a=Table[Exp[2 Pi/16 I i],{i,0,15}];
   b=1/a;
   a^2*b^2
   a=Table[Exp[2 Pi/1024 I i],{i,0,1023}];
   b=Table[Re[Exp[2 Pi/1024 I i]],{i,0,1023}];
end
   Timing[Do[a*2,{100}]]
   Timing[Do[a*I,{100}]]
   Timing[Do[a*a,{100}]]
   Timing[Do[b*2,{100}]]
   Timing[Do[b*I,{100}]]
   Timing[Do[b*b,{100}]]
   Timing[Do[a*b,{100}]]
   Timing[Do[b*a,{100}]]
   Timing[Do[a*a,{100}]]
end
!
!   FFS commands
   FFS["fit bx 30 free qf go",6]
   if 1<>1
     FFS["else print \"Not OK\"",6]
   else
     print "OK"
   endif
   free q* q* rotate
   FFS["VAR"]
end
!
!   Thread
  Clear[a,b,c,f];
  Thread[f[{1,2},{3,4}]]
  Thread[f[{1,2,3},4,{5,6,7}]]
  Print[Thread[Log[a==b],Operation["=="]]];
end
!
!
  Clear[a,b,c,d,e,f,g];
  f[a_,b_]:=Module[{c,d},
    {c,d}={Range[100],Range[100]}];
  g[a_,b_]:=Module[{c,d,e={}},
    {c,d}=f[a,b];
    ReplacePart[c,-1,10]];
  MemoryCheck[]
  g[Range[100],Range[100]];
  MemoryCheck[]
end
!
!
  coup qf qd 1
  coup qd qf 1
  attr
  coup qf qf 1
  attr
end
!
! FitWeight
 nx .4 5 cal
 FitWeight["***","NX",dp_,w_]:=(Print[{dp,w}];w*10)
 cal
 end
!
!
  f[x_]:=Print[{x}];
  f["aaa"]
end
!
!  Comment, continuation
a="This is a string \
which continues to the next line\            ! backslash works after removeal of comment.
. A comment is specified by \"!\"\n\         ! The "!" in a quotation is not a comment.
which is placed \"outside\" of a quatation, \
but the rule may not be perfect,\nso you should avoid \
interlacing a comment and a quotation as much as possible.";
Print[a]
a="\
" !   Is this a comment or not?"
end
!
! Date,FromDate,Todate
  Date[]
  FromDate[{2100,3,14,3,24,4}]
  FromDate[{2100,2,14,3,24,4}]
  FromDate[{1600,2,14,3,24,4}]
  ToDate[FromDate[{2100,3,14,3,24,4}]]
  ToDate[FromDate[{2100,2,14,3,24,4}]]
  ToDate[FromDate[{1600,2,14,3,24,4}]]
end
!
!
 rep 2
   use CELL
   cell cal 
   use TESTLINE
   cell cal
 until
 fit nx .25 free qf
 visit CELL
   cell cal
 end
 bye
 cell go
 show var
end
rep 2
  FFS["use CELL;cell cal",6]
  FFS["use TESTLINE;cell cal",6]
until
MemoryCheck[]
a=1
END 
!
!    Defined functions
   Clear[a,f];
   a[3]=-1;a[3,1]=2;
   Print[a[3]+a[3,1]];
   a=3;
   Print[ a];
   a[2]=rrrr;
   Print[a[2]];
   f[x_]:=Sin[x];
   Print[f[1]+f[2]+f[3],' ',Sin[1]+Sin[2]+Sin[3]];
   f[x_,y_]:=Sin[x]+Sin[y];
   Print[f[1]+f[2,3]];
   Print[f[f[1],f[2]],' ',Sin[Sin[1]]+Sin[Sin[2]]];
   f[1]=-1;
   Print[f[f[1],f[2]],' ',Sin[-1]+Sin[Sin[2]]];
   f[x_,y_]:=x*y;
   Print[f[3,4]];
   f[x___]:=Print[x];
   f[1,' ',2];
   f[1,2]
   Clear[f];
   f[x___]:=Print[x];
   f[x_Real,y_Real]:=x+y;
   f[3,4]
   f['a','b']
end
!
!
Clear[f,f];
f[1]=2;
f=3;
Print[f]
f:=f;
f[1]
Print[f]
g:=g;
Print[g]
h:=j;
j:=h;
Print[h]
end
!
!
!
!
!
 if 1==0
   If[1==1,Print["a"]]
 else
   If[1==1,Print["b"]]==2
 endif
 Print["OK"]

end
endif
end

!
  rep 10 Print[\"b\"] if 1<0 Print[\"a\"] endif until
  c="rep 10 Print[\"b\"] if 1<0 Print[\"a\"] endif until"
  exec c
  end
  ins
  free ip2 ax ip2 bx ip2 ay ip2 by
  fit bx 10 by 10 ax 0 ay 0 
  end
!
!
  TYPE B
 LINE["K0","B"]
 LINE["K0","B"]=0.0001;
  initial=Table[0,{27}];
  initial[2]=1;initial[5]=1;initial[20]=0.00;
  CalculateOptics[1,'***',initial,True,2][1,-1]
  cal
end
!
!
  1.1 a
  b=(1.1 a)
  b=(1.1 (-a))
end
!
  VariableRange["QF","ROTATE",v_]:=(Print[v];v<0.01);
  free q* rotate
end
!
!    Emittance
  e=CalculateEmittance[3];
  Map[Dimensions,e]
  f=Emittance[Matrix->True];
  m=OneTurnTransferMatrix/.f
  m.SymplecticInverse[m]
  m.Inverse[m]
  OneTurnExcitation/.f
  LINE["DK"]
  LINE["DK","QF"]
  LINE["DK","QF*"]
end

LINE["NAME","QF.*"]
LINE["K1","QF.*"]
Element["K1","QF"]=0.1
LINE["K1","QF.*"]
LINE["EXPAND"]
LINE["K1","QF.*"]
  end
!
  DP0=0.001;FSHIFT=-1e-8/4.3e-4/0.9987/1.023/3.0273/10.408/1.018;cod emiout cal mat emit
!
  by 8 free q* go
  by * 3 cal
  MatchingAmplitude={{-0.01,1,0}};
  cal
!
!
f[]:=
  Module[{j},
      Table[j=g[i];j,{i,2,10}]
  ];

g[j_]:=Module[{},
  Do[Sin[i],{i,-3,-1}];  ! <---- This makes trouble!
  j
];
f[]
end
!
!
  free qf qd 
  var fix qf var
  free q* b var fix * var
  qf 0.1 free qf var
  q* minmax 10 attr
  reset var rec var
  Print[#QF]
  Element["VALUE","QF"]  
  Element["K1","QF"]  
  dk 0.001 q* dump cal
  fit by 5 bx 30 reset free qf qd go var
  coup qf qd -1 var
  rej bx go var
  reset
  rej total
  coup qf qf 1
  fix *
  fit r1 0.1 bx 21
  free qf rotate qf
  go var 
  free qd rotate
  r2 0.1
  go var
end
  disp
  type
  end
  
end
!
!   Floor, Ceiling, Round
  Print[{Floor[1.5],Floor[-1.5],Ceiling[1.5],Ceiling[-1.5],Round[1.5],Round[-1.5],Ceiling[1],Floor[-1],Round[-1.49999]}]
!
!
   a=Table[i*10+j,{i,3},{j,4}]
   Map[#[1]&,a]
   Map[Part[#,1]&,a]
   Map[(Element["VALUE",#[1]]=#[2])&,Transpose[{{"QF","QD"},{0.1,-0.2}}]]
end 
!
!   ListPlot
  d=-.001;
  nu=0.243;
  a=Table[Exp[d n]*{Cos[2 Pi nu n],Sin[2 Pi nu n]},{n,1,1500}];
  Timing[
  ListPlot[a];
  ListPlot[a,PlotRange->{{-.5,.5},{-.5,.5}},AspectRatio->1];
  ListPlot[a,PlotJoined->True]]
end
!
!    NumberQ, VectorQ, MatrixQ, AtomQ
  Clear[a,b]
  NumberQ[1+2 I]
  VectorQ[{1,2,{3,4}}]
  VectorQ[{1,2,3+4 I}]
  MatrixQ[{{1,"2"},{3,4},{5,6}}]
  MatrixQ[{{1,2},{{3,3},4},{5,6}}]
  AtomQ[1+2 I]
  AtomQ[a+b I]
end
!
!  Reverse
  Reverse[{1,2,3,4,5}]
!
!   MatchQ
  Clear[f,x];
  MatchQ[1,x_]
  MatchQ[f[x],f[x_]]
!
!   Outer
  Clear[A,B]
  Outer[A,{1,2},{3,4},{5,6,7}]
  Outer[A,B[1,2],B[3,4],B[5,6,7]]
end
!
!   Auto map.
  a=Range[1,LINE['LENGTH']];
  Timing[Do[LINE['POSITION',a],{1000}];]
  Timing[Do[LINE['POSITION',1],{40000}];]
end
!
!    Evaluate, Hold, ReleaseHold
  Clear[a,b];
  a=1;b=2;
  c=Hold[a+b,a-b]
  Print[ReleaseHold[c]];
end
!
!   Operations for small number of args.
  Plus[]
  Times[]
  And[]
  Or[]
  Not[]
  Power[]
  Plus[1]
  Times[1]
end
!
!   Sign,Sqrt
  Sign[Range[-5,5]]
  Sign[1+2 I]
  Sqrt[-2]
  Sqrt[Range[-5,5]]
  Sqrt[1+2 I]
end
!
!   Dimensions
  Clear[a,b,c];
  Dimensions[{{1,2},{3,4},{5,6}}]
  Dimensions[{{1,2,3},{3,4},{5,6}}]
  Dimensions[{{1,2},{3,4},{5,6,7}}]
  Dimensions[{{1,2},{3,4},a[5,6]}]
end
!
!   Equal,SameQ
  Clear[a,b,c];
  Print[{1}=={1}];
  Print[{a}=={1}];
  Print[{a}==1];
  Print[{a,b}=={1}];
  Print[{a,b}==1];
  Print[{a,b}=={1,2}];
  Print[{1}==={1}];
  Print[{a}==={1}];
  Print[{a}===1];
  Print[{a,b}==={1}];
  Print[{a,b}===1];
  Print[{a,b}==={1,2}];
end  
!
!   Optics
  m=NormalCoordinates[1][1];
  m.SymplecticInverse[m]
  initial=Table[0,{27}];
  initial[2]=1;initial[5]=1;initial[20]=0.001;
  CalculateOptics[1,'***',initial,True,2]
!
!   Operation
   Clear[a1,a2,a3,a4,a5];
   Timing[Do[a=Operation["{"][a1,a2,a3,a4,a5,a6],{10000}]]
   Timing[Do[a={a1,a2,a3,a4,a5,a6},{10000}]]
   Timing[Do[a=Operation["+"][a1,a2,a3,a4,a5,a6],{10000}]]
end
!
!    SetDelayed
   aa:=bb+cc;
   Print[aa];
   bb=2;
   cc=3;
   Print[aa, ' ', bb+cc];
   cc=4;
   Print[aa];
   aa:=1-bbb;
   Print[aa*aa+aa];
!
!   MapAt,FlattenAt,ReplacePart,Insert,Delete
   Clear[a,b,c,f];
   a=Table[i*100+j*10+k,{i,4},{j,3},{k,3}]
   MapAt[f,a,2]
   MapAt[f,a,{2,3}]
   MapAt[f,a,{{2,3},{1,2}}]
   FlattenAt[a,2]
   FlattenAt[a,{2,3}]
   FlattenAt[a,{{2,3},{1,2}}]
   ReplacePart[a,0,2]
   ReplacePart[a,0,{2,3}]
   ReplacePart[a,0,{{2,3},{1,2}}]
   Insert[a,0,2]
   Insert[a,0,{2,3}]
   Insert[a,0,{{2,3},{1,2}}]
   Delete[a,2]
   Delete[a,{2,3}]
   Delete[a,{{2,3},{1,2}}]
end
!
!   SetAttributes;
  Clear[f];
  f[x___]:=Write[6,x];
  f[$FORM='10.6';Sin[1],Print[$FORM];$FORM='';Cos[1]];
  SetAttributes[f,{{0,1},{0,1}}]
  f[$FORM='10.6';Sin[1],Print[$FORM];$FORM='';Cos[1]];
  Write[6,$FORM='10.6';Sin[1],Print[$FORM];$FORM='';Cos[1]];
end
!
!
   Print[{1,1}];
   Print[({1,2} ; 3)];
!
 norfsw  cell
  cal
  disp qf.2+1;
end
!
!    Table and Do
   a=Table[Table[i,{i,1,10,2}]*i,{i,-1,-10,-2}]
   a=Table[i,{i,10}]
   s=0;i=1;rep 10 s=s+a[i];i=i+1;until
   print s;
   s=0;Table[s=s+a[i],{i,10}];
   Print[s];
   a=Table[i*10+j,{i,1,3},{j,1,4}]
   Do[a[i,j]=i*100+j*10,{i,3},{j,4}]
   Print[a];
   a=Table[Sin[i],{i,10}]
!
!   Sum, Product, Range
   Sum[i,{i,10}]
   Clear[a]; pri Product[a+i,{i,3}]
!   Timing[Do[Sum[i,{i,1000}],{100}]]
!   Timing[Do[Product[i,{i,1000}],{100}]]
   Range[10,1,-1]
   Range[10]
!
!  Join, Append, Prepend
  Print Join[{1},{1,2,3},{4,5,6}]
  Print Append[{1,2,3,4,5},6]
  Print Prepend[{1,2,3,4,5},0]
!
!  Clear, Protect, Unprotect
  a=1;b={2,3};c=aaaaa;
  Print a b c
  Clear[a,b,c]
  Print a b c
  Clear[sin]
  a=1
  Protect[a]
  Clear[a]
  Unprotect[a]
  Clear[a]
!
!   WriteString
  WriteString[6,"abcde"];  WriteString[6,"fghij"]
!
!    Get
  Get["~/OLDSAD/src/init.n"]
!
!    OpenWrite, OpenAppend, Close, Flush
   f=OpenWrite["test.dat"];
   Write[f,"This is test-OpenWrite."];
end
   Flush[f];
end
   Write[f,"This is test-Flush."];
   Close[f];
end
   f=OpenAppend["test.dat"];
   Write[f,"This is test-Append."];
   Close[f];
end
!
!    Speed
   stat rep 10000 a=1; until; stat
   stat rep 10000 until; stat
   Timing[ Do[a=1.,{100000}]]
   Timing[ Do[Sin[i],{i,100000}]]
   Timing[ Do[1.,{i,100000}] ]
   Timing[ Do[#+1.&[i],{i,100000}] ]
   t qf
   #qf=0.1+#qf*.99
   #qf #qf/2
   cal out 'a' draw bx &by &ex q* term out
  fit l1 nym 80
  fit qf.1+0 qd bxm 100 bym 100;
  rej *;
  fn= '~/OLDSAD/sad/test1.ffs';
  in fn
  rep 3 in fn    
  until
  dk u 1e-3 qf*
   print n=Element['LENGTH'];
   i=1;
   rep n
    print Element['NAME',i] ' ' Element['VALUE',i];
    i=i+1;
  until
  i=0;
  REP 4
  i=i+1;
  IF i==1
    print 'i=1'
  ELSEIF i==2
    print 'i=2'
  ELSEIF i==3
    print 'i=3'
  ELSE
    print 'i<>1,2,3'
  ENDIF
UNTIL
 momentum=30E9
 print momentum
   qf* min -1 qd* min -1
   nx +.1;
   nx +.1,1
   nx * 3 show
    1+(2
  +3)*4
  1+(2
    ]*3
    1+(2;
  +3)*4
    1+/2
    1+(2])*3
    max[1,2,'a']
    1+'a'
    ---3
    1=3
    sin(1)
    'a'='abc'
   a=.1
   cell nx -(-a)+.01*(2+1-1E0)-3E-4*(5-5); ny .05+a ; show free q*
   rep 3  go until ?conv;
   title='TEST'//' of title'
   case ='  A '//'    GGGG '
   out 11 draw bx by & ex ey q* term out
end
! EMIT USE=TESTLINE; 
!FFS USE=TESTLINE;
!   RESULTSOFTRACKING[nt_,x_]:=Print[{nt,x}];
!quit
!EMIT USE=TESTLINE;
!TRACK USE=TESTLINE NPART=2 NX=(1) NY=(0) NZ=(1)
!  TURNS=3;
!stop
!OFF SMEAR;
!TRACK USE=TESTLINE NPART=2 NX=(1) NY=(0) NZ=(1)
!  TURNS=300;
!stop;
  stop
!PLOT PTYPE=4 NPART=1 SPAN=1024 TURNS=1;
OFF RFSW RAD RADCOD;ON EMIOUT;
EMIT USE=TESTLINE;
TRACK USE=TESTLINE NPART=2 NX=(1) NY=(0) NZ=(1)
  TURNS=100;
FFS USE=TESTLINE;
print resultsoftracking
end
! in '/users/kikuchim/sad/WLDATAC'
!  meas out '/users/oide/a.td' x-px end
! cal delc 0 1e-3 1e-3 * dump cal disp o
  trpt
  cal fix 
  end
  ste bv*
  fit ip2 ddy 0 ddx 0
  fit ddy 1e-4 bump dump
  end
  ring cell
  nx .25 ny .25 free q* go
  save
  norfsw emit
  nxr 1 3 1
  nyr 1 3 1
  nzr 1 3 1
  np 100
  turns 100
  survey init
  dapert
  ny 0.05 
  repeat 10
    nx .05
    repeat 10
     go
     if ?conv
       track
       survey
     else
       reset
       survey skip
     endif
     nx + .05
    until
    ny + .05
  until
  survey result
end
  dapert
  track
 end
setenv TERM dumb;setenv COLUMNS 80
